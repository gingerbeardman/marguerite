function PLAY_KOIKOI(){_f_gamemode=_F_GAMEMODE_KOIKOI;_f_players=2;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_MUSHI(){_f_gamemode=_F_GAMEMODE_MUSHI;_f_players=2;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_HANAAWASE(){_f_gamemode=_F_GAMEMODE_HANAAWASE;_f_players=3;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_88(){_f_gamemode=_F_GAMEMODE_88;_f_players=3;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_2_88(){_f_gamemode=_F_GAMEMODE_88;_f_players=2;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_SUDAOSHI(){_f_gamemode=_F_GAMEMODE_SUDAOSHI;_f_players=3;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_2_600KEN(){_f_gamemode=_F_GAMEMODE_600KEN;_f_players=2;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_3_600KEN(){_f_gamemode=_F_GAMEMODE_600KEN;_f_players=3;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_HACHI(){_f_gamemode=_F_GAMEMODE_HACHI;_f_players=2;_f_kabu_mode=0;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_OICHOKABU(){_f_gamemode=_F_GAMEMODE_OICHOKABU;_f_players=3;_f_kabu_mode=1;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function PLAY_KYOKABU(){_f_gamemode=_F_GAMEMODE_KYOKABU;_f_players=3;_f_kabu_mode=1;setMenuItem('MENUBAR_RESTART', -8, 5, 'お品書きに戻る', 'QUIT_GAME()', 0);_f_h5_next=setTimeout('GAME_START(); ', 10);}function GAME_START(){var i, j;_f_toggle_sprite_disp(1);graph_noSprite=_f_rule_sel['UI_noSprite'] || 0;_f_max_kyokusu=12;_f_600ken_norm=256;if(_f_gamemode==_F_GAMEMODE_HACHI){ _f_600ken_norm=2; _f_max_kyokusu=0; }else if(_f_gamemode==_F_GAMEMODE_600KEN){ _f_600ken_norm=3; _f_max_kyokusu=0; }else if(_f_rule_sel['UI_game_kyokusu']) _f_max_kyokusu=6;_f_fuda_used=0;i=-1; while((j=k=_f_fuda_used_table[++i])!=0){if(((j &= 0xf0)==0x60 || j==0x70) && _f_gamemode==_F_GAMEMODE_MUSHI) continue;if(((j &= 0xf0)==0xb0 || j==0xc0) && _f_kabu_mode) continue;_f_yamafuda[_f_fuda_used++]=k;}_f_cushion_color();removeAllOfTextArea();_f_game_ctr=0;i=-1; while(++i<3){_f[i].total_result=0;j=_f[i].result.length;while(--j>=0) _f[i].result[j]=0;}if(!(_f_seatName[1]=_f_rule_sel['UI_right_name'])) _f_seatName[1]='真希';if(!(_f_seatName[2]=_f_rule_sel['UI_left_name'])) _f_seatName[2]='ユイカ';_f_oya=Math.floor(Math.random()*3);if(_f_kabu_mode){_f_players=3;if(_f_rule_sel['OCK_fudaType']==1){_f_fuda_used=0;k=0; while((k+=0x10)<0xb0){j=4; while(--j>=0) _f_yamafuda[_f_fuda_used++]=k | 8;}_f_yamafuda[1]=0xb0 | 8;}i=40; while(--i>=0) _f_oichokabu_yamafuda[i]=_f_yamafuda[i];}_f_torefuda_mark=_f_rule_sel['UI_torefuda_mark'];_f_fudaBack=0; if(!_f_rule_sel['UI_fudaBack']<1) _f_fudaBack=1;_f_h5_next=setTimeout('NEW_GAME(); ', 10);}function NEW_GAME(){var i, j;_f_oya=Math.floor(Math.random()*_f_players);_f_kyokusu_ctr=0;_f_600ken_4ko_flag=-1;_f_600ken_victor=-1;_f_600ken_ichikoro_flag=-1;_f_600ken_te4_flag=0;_f_600ken_new=1;_f_600ken_4ko_flag2=-1;_f_600ken_victor2=-1;_f_600ken_ichikoro_flag2=-1;_f_8_prev_winner=-1;i=3;j=0;if(_f_gamemode==_F_GAMEMODE_88 || _f_gamemode==_F_GAMEMODE_SUDAOSHI){j=60;_f_88_ba_rate=0;_f_88_ba_rate_next=0;}if(_f_kabu_mode){j=50;_f_oichokabu_oyaTotalPoint=0;}while(--i>=0){_f[i].score=j;_f[i].score_before_game=j;_f[i].point_600ken=0;_f[i].current_point_600ken=0;}_f_init_balance();if(_f_kabu_mode){}_f_h5_next=setTimeout('DEOYAGIME(); ', 10);}function DEOYAGIME(){var i,j,k,l,m;_f_status_disp('出親を決めます。');if(_f_kabu_mode){i=40; while(--i>=0) _f_yamafuda[i]=_f_oichokabu_yamafuda[i];}m=3; while(--m>=0){i=8; while(--i>=0) _f[m].tefuda[i]=0;}m=10; while(--m>=0){i=_f_fuda_used;while(--i>=0){j=Math.floor(Math.random()*_f_fuda_used);l=_f_yamafuda[i]; _f_yamafuda[i]=_f_yamafuda[j]; _f_yamafuda[j]=l ^ 0x100;j=Math.floor(Math.random()*_f_fuda_used);k=Math.floor(Math.random()*_f_fuda_used);l=_f_yamafuda[k]; _f_yamafuda[k]=_f_yamafuda[j]; _f_yamafuda[j]=l ^ 0x100;}}if(_f_kabu_mode){i=40; while(--i>=0) _f_oichokabu_yamafuda[i]=_f_yamafuda[i];_f_oichokabu_oyaOpen=1;}_f_yamafuda_remain=_f_fuda_used;_f_oya=0;_f_karioya=_f_seki=-1;removeAllOfTextArea();_f_playfield();_f_i=13;_f_k=0;_f_status='';_f_h5_next=setTimeout('DEOYAGIME_2(); ', 10);}function DEOYAGIME_2(){var i;if(++_f_seki>=_f_players){_f_h5_next=setTimeout('DEOYAGIME_END(); ', 10);return;}_f_j=_f_yamafuda[--_f_yamafuda_remain] | 0x200;if(!_f_kabu_mode){_f[_f_seki].tefuda[3]=_f_j;_f_from_yamafuda_to_tefuda(_f_seki, 0, 0);_f_yamafuda_disp();}else {_f[_f_seki].tefuda[0]=_f_j & 0xff;if(_f_oya!=_f_seki){_f_oichokabu_animation_makifuda(_f_seki, _f_j);}else {_f_oichokabu_animation_oyatefuda(0);}_f_yamafuda_disp(-1);}if((i=(_f_j >> 4) & 15)<_f_i){_f_i=i; _f_karioya=_f_seki;}_f_h5_next=setTimeout('WAIT_MOVIE("DEOYAGIME_4"); ', 10);}function DEOYAGIME_4(){var i;AUDIO_OUTPUT('kirifuda'+(++_h5_sound_ctr & 3), false);_f_tefuda_disp(_f_seki);_f_h5_next=setTimeout('DEOYAGIME_2(); ', 240);}function DEOYAGIME_END(){var i, j;_f_oya=_f_karioya;_f_mini_console_disp();if(_f_gamemode!=_F_GAMEMODE_600KEN) _f_command=_f_nagare_judge();i='CPUが出親です。';if(!_f_oya) i='あなたが出親です。';else if(_f_players!=2) i=_f_seatName[_f_oya]+'が出親です。';_f_status_disp(i);j=0;i=_f_oya; do {_f[i].oyako=_f_oyako_str[j++];if(++i>=_f_players) i=0;} while(j<_f_players);inputKey=-1;if(_f_kabu_mode)_f_oichokabu_oyaOpen=0;else _f_playfield();_f_h5_next=setTimeout('WAIT_MINICONSOLE("IKKYOKU"); ', 10);}function IKKYOKU(){var i,j,k,l,m;if(_f_kabu_mode){i=40; while(--i>=0) _f_yamafuda[i]=_f_oichokabu_yamafuda[i];}m=10; while(--m>=0){i=_f_fuda_used;while(--i>=0){j=Math.floor(Math.random()*_f_fuda_used);l=_f_yamafuda[i]; _f_yamafuda[i]=_f_yamafuda[j]; _f_yamafuda[j]=l ^ 0x100;j=Math.floor(Math.random()*_f_fuda_used);k=Math.floor(Math.random()*_f_fuda_used);l=_f_yamafuda[k]; _f_yamafuda[k]=_f_yamafuda[j]; _f_yamafuda[j]=l ^ 0x100;}}if(_f_kabu_mode){i=40; while(--i>=0) _f_oichokabu_yamafuda[i]=_f_yamafuda[i];}else {k=_f_fuda_used;i=8; while(--i>=0) _f_kubarifuda[i]=0;j=6; if(_f_gamemode==_F_GAMEMODE_MUSHI || (_f_gamemode==_F_GAMEMODE_600KEN && _f_players==2) || (_f_gamemode==_F_GAMEMODE_KOIKOI && _f_rule_sel['KK_bafuda'])) j=8;while(--j>=0) _f_kubarifuda[j]=_f_yamafuda[--k];i=_f_players; while(--i>=0){j=8; while(--j>=0) _f[i].kubarifuda[j]=0;j=8; if(_f_players==3 || _f_gamemode==_F_GAMEMODE_88 || _f_gamemode==_F_GAMEMODE_HACHI) --j;while(--j>=0) _f[i].kubarifuda[j]=_f_yamafuda[--k];}if(_f_gamemode==_F_GAMEMODE_MUSHI) _f_suffle_2();else if(_f_gamemode==_F_GAMEMODE_KOIKOI) _f_suffle_1();}_f_h5_next=setTimeout('IKKYOKU_2(); ', 10);}function _f_suffle_1(){var s, nf=[0, 0], i, j, k, l, m, n;var vt=[0x0001, 0x0100, 0x0010, 0x1000];try {s=2; while(--s>-1){l=8; while(--l>-1){if(!(n=_f[s].kubarifuda[l] & 0xff)) continue;if(n==0xc2) n=0xc0;k=-1; j=0; m=10; while(--m>-1){if(!(i=_f_kubarifuda[m] & 0xff)) continue;if((i ^ n) & 0xf0) continue;if(i==0xc2) i=0xc0;i &= 0x0f;if(k<i) k=i;++j;}if(j<1) continue;nf[s] += vt[n & 0x0f];if(j>2){m=10; while(--m>-1){if(!(i=_f_kubarifuda[m] & 0xff)) continue;if((i ^ n) & 0xf0) continue;if(i==0xc2) i=0xc0;nf[s] += vt[i & 0x0f];}continue;}nf[s] += vt[k & 0x0f];}}if(nf[0]-1<nf[1]){if(_f[0].score>_f[1].score || (!_f_max_kyokusu && _f_kyokusu_ctr>3) || _f_kyokusu_ctr > Math.floor(_f_max_kyokusu*0.7)){return;}i=8; while(--i>=0){j=_f[0].kubarifuda[i]; _f[0].kubarifuda[i]=_f[1].kubarifuda[i]; _f[1].kubarifuda[i]=j;}return;}if(_f[0].score>_f[1].score || (!_f_max_kyokusu && _f_kyokusu_ctr>3) || _f_kyokusu_ctr > Math.floor(_f_max_kyokusu*0.7)){i=8; while(--i>=0){j=_f[0].kubarifuda[i]; _f[0].kubarifuda[i]=_f[1].kubarifuda[i]; _f[1].kubarifuda[i]=j;}}} catch(e){ console.log(e); }}function _f_suffle_2(){var s, nf=[0, 0], af=[0, 0], bf=new Array(13), i,j, k, l, f, os=new Array(3), fj=kr=0, fj2=kr2=0;i=13; while(--i>=0) bf[i]=0;i=8; while(--i>=0){j=(_f_kubarifuda[i] >> 4) & 15;if((_f_kubarifuda[i] & 0xff)==0x22){ bf[2]++; continue; }if((_f_kubarifuda[i] & 0x0f)==3) bf[j]++;if(j==4) fj++;if(j==12) kr++;}s=2; while(--s>=0){f=os[0]=os[1]=os[2]=0;fj2=fj; kr2=kr;i=8; while(--i>=0){k=_f[s].kubarifuda[i] & 0xff;l=k >> 4;if(l==4) fj2++;if(l==12) kr2++;if((k & 0x0f)==3){if(l==11){ af[s]++; }if(l==1) os[0]++;if(l==2) os[2]++;nf[s]+=20; continue;}if(k==0xb0){f++;if(bf[1]+bf[3]+bf[8]+bf[12]) nf[s]+=20;continue;}if(k==0xb1 || k==0xb2) af[s]++;if(l==2){if(k==0x22 || bf[2]) os[1]++;continue;}if(!bf[l]) continue;nf[s]+=20;}i=0;if(os[0]) ++i;if(os[1]) ++i;if(os[2]) ++i;if(f) ++i;if(i>2){nf[s]+=25; if(i>3) f=0;}if((i=fj2+f)>=4){nf[s]+=10; if(i>4) f=0;}if((i=kr2+f)>=4){nf[s]+=10; if(i>4) f=0;}}if(af[0]>af[1]) nf[0]+=35;else if(af[1]>af[0]) nf[1]+=35;if(nf[0]-1<nf[1]){if(_f[0].score>_f[1].score || (!_f_max_kyokusu && _f_kyokusu_ctr>3) || _f_kyokusu_ctr > Math.floor(_f_max_kyokusu*0.7)){return;}i=8; while(--i>=0){j=_f[0].kubarifuda[i]; _f[0].kubarifuda[i]=_f[1].kubarifuda[i]; _f[1].kubarifuda[i]=j;}return;}if(_f[0].score>_f[1].score || (!_f_max_kyokusu && _f_kyokusu_ctr>3) || _f_kyokusu_ctr > Math.floor(_f_max_kyokusu*0.7)){i=8; while(--i>=0){j=_f[0].kubarifuda[i]; _f[0].kubarifuda[i]=_f[1].kubarifuda[i]; _f[1].kubarifuda[i]=j;}}}function IKKYOKU_2(){var i,j,k,l,m;if(_f_rule_sel['UI_fudaBack']<0) _f_fudaBack=(_f_fudaBack+1) & 1;_f_600ken_new=0;_f_cushion_color();removeAllOfTextArea();i=8; while(--i>=0) _f_te_torefuda[i]=0;_f_yamafuda_remain=_f_fuda_used;i=_f_players;while(--i>=0){_f[i].open=0;j=8; while(--j>=0) _f[i].tefuda[j]=0;_f[i].torifuda01_ctr=_f[i].torifuda05_ctr=_f[i].torifuda10_ctr=_f[i].torifuda20_ctr=0;j=24; while(--j>=0)_f[i].torifuda01[j]=_f[i].torifuda05[j]=_f[i].torifuda10[j]=_f[i].torifuda20[j]=0;_f[i].torifuda_dekiyaku=0;_f[i].torifuda_total=0;_f[i].balance_payback=0;_f[i].balance=0;_f[i].balance_total=0;_f[i].score_after_balance=_f[i].score_before_game=_f[i].score;_f[i].sambon[0]=_f[i].sambon[1]=-1;_f[i].nukeyaku='';_f[i].goko_flag=0;_f[i].shiko_flag=0;_f[i].inoshikacho_flag=0;_f[i].akatan_flag=0;_f[i].aotan_flag=0;_f[i].nanatan_flag=0;_f[i].sambon_flag=0;_f[i].tatesambon_flag=0;_f[i].aka_flag=0;_f[i].tan_ichi_flag=0;_f[i].toichi_flag=0;_f[i].karasu_flag=0;_f[i].pikaichi_flag=0;_f[i].kuttsuki_flag=0;_f[i].teshi_flag=0;_f[i].haneken_flag=0;_f[i].ichinishi_flag=0;_f[i].shiso_flag=0;_f[i].koikoi_monsu=0;_f[i].payback_name_ctr=0;_f[i].payback_point_total=0;_f[i].yaku_name_ctr=0;_f[i].yaku_point_total=0;j=14; while(--j>=0){_f[i].yaku_name[j]=_f[i].payback_name[j]='';_f[i].yaku_point[j]=_f[i].payback_point[j]=0;}}i=24; while(--i>=0)_f_bafuda[i]=_f_awase_bafuda[i]=_f_torifuda_flag[i]=_f_torefuda_flag[i]=_f_torefuda_table[i]=0;j=0;i=_f_oya; do {_f[i].oyako=_f_oyako_str[j++];if(++i>=_f_players) i=0;} while(j<_f_players);_f_teyaku_flag=0;_f_fuda_buff=0;_f_pos_buff=0;_f_awasefuda_buff=0;_f_open_mode=_f_openmode;_f_koikoi_flag=-1;_f_88_ba_rate=_f_88_ba_rate_next;_f_88_ba_rate_next=0;if(_f_88_ba_rate>1) _f_88_ba_rate_next=-1;_f_yakunagare_flag=0;_f_88_hatto_akatan=-1;_f_88_hatto_aotan=-1;_f_88_hatto_inoshikacho=-1;_f_88_hatto_shiko=-1;_f_oichokabu_limit=_f_oichokabu_domae;_f_oichokabu_betted_total=0;if(_f_gamemode==_F_GAMEMODE_600KEN){_f_600ken_4ko_flag2=_f_600ken_4ko_flag;_f_600ken_victor2=_f_600ken_victor;_f_600ken_ichikoro_flag2=_f_600ken_ichikoro_flag;_f_600ken_te4_flag2=_f_600ken_te4_flag;i=_f_players; while(--i>=0){_f[i].score_before_game=_f[i].current_point_600ken=_f[i].point_600ken;_f_600ken_current_point_disp(i);}}_f_playfield();_f_i=-1;_f_status='';if(_f_gamemode==_F_GAMEMODE_OICHOKABU || _f_gamemode==_F_GAMEMODE_KYOKABU){_f_h5_next=setTimeout('OCK_START(); ', 10);return;}_f_h5_next=setTimeout('FUDAKUBARI(); ', 10);}function FUDAKUBARI(){var i,j,k,l,m;if(++_f_i>=2){_f_h5_next=setTimeout('FUDAKUBARI_END(); ', 10);return;}_f_seki=_f_oya;_f_h5_next=setTimeout('FUDAKUBARI_2(); ', 10);}function FUDAKUBARI_2(){var i,j,k,l,m;i=-1; k=4; l=0;if(_f_i){l=4;if(_f_players==3 || _f_gamemode==_F_GAMEMODE_88 || _f_gamemode==_F_GAMEMODE_HACHI) k=3;}while(++i<k){j=_f[_f_seki].tefuda[l]=_f[_f_seki].kubarifuda[l]; --_f_yamafuda_remain;_f_from_yamafuda_to_tefuda(_f_seki, l, i & 3);l++;}_f_yamafuda_disp();_f_h5_next=setTimeout('WAIT_MOVIE("FUDAKUBARI_2_3"); ', 10);}function FUDAKUBARI_2_3(){var i,j,k,l,m;AUDIO_OUTPUT('kirifuda'+(++_h5_sound_ctr & 3), false);_f_tefuda_disp(_f_seki);_f_h5_next=setTimeout('FUDAKUBARI_2_3_H5(); ', 160);}function FUDAKUBARI_2_3_H5(){var i,j,k,l,m;if(++_f_seki>=_f_players) _f_seki=0;if(_f_seki!=_f_oya){_f_h5_next=setTimeout('FUDAKUBARI_2(); ', 10);return;}_f_h5_next=setTimeout('FUDAKUBARI_BAFUDA(); ', 10);}function FUDAKUBARI_BAFUDA(){var i,j,k,l,m;i=-1; k=3; l=0;if(_f_gamemode==_F_GAMEMODE_MUSHI || (_f_gamemode==_F_GAMEMODE_600KEN && _f_players==2) || (_f_gamemode==_F_GAMEMODE_KOIKOI && _f_rule_sel['KK_bafuda'])) k=4;if(_f_i) l=k;while(++i<k){j=_f_bafuda[l]=_f_kubarifuda[l]; --_f_yamafuda_remain;_f_from_yamafuda_to_bafuda_for_kubarifuda(i, j, i);l++;}_f_yamafuda_disp();_f_h5_next=setTimeout('WAIT_MOVIE("FUDAKUBARI_BAFUDA_2_3"); ', 10);}function FUDAKUBARI_BAFUDA_2_3(){var i,j,k,l,m;AUDIO_OUTPUT('kirifuda'+(++_h5_sound_ctr & 3), false);_f_bafuda_disp();_f_h5_next=setTimeout('FUDAKUBARI(); ', 160);}function FUDAKUBARI_END(){var i,j,k,l,m;i=_f_players;while(--i>=0){j=8;while(--j>=0) _f[i].tefuda[j] &= 0xff;_f_tefuda_disp(i);}_f_seki=_f_oya;_f_i=0;_f_j=-1;_f_init_balance();if(_f_gamemode==_F_GAMEMODE_88){i=_f_bafuda.length;j=k=0;while(--i>=0){if((l=_f_bafuda[i] & 0xff)==0x13 || l==0x33 || l==0x83) ++j;if(l==0xb3 || l==0xc3) ++k;}_f_88_ba_rate_next=1;if(k){_f_88_ba_rate=4;if(k>1) _f_88_ba_rate_next=4;}else if(j){if(_f_88_ba_rate<4) _f_88_ba_rate=2;if(j>1) _f_88_ba_rate_next=2;}if(j || k) _f_playfield();}_f_h5_next=setTimeout('TEYAKU(); ', 10);}function TEYAKU(){var i,j,k,l,m;if(!_f_teyaku_judge(_f_seki)){_f_h5_next=setTimeout('TEYAKU_2(); ', 10);return;}f=new Array(0, 0, 0, 0, 0, 0, 0, 0);i=j=-1;while(++i<8){if(!(_f[_f_seki].tefuda[i] & 0x200)) continue;f[++j]=_f[_f_seki].tefuda[i];_f[_f_seki].tefuda[i]=0;}i=-1;while(++i<8){if(_f[_f_seki].tefuda[i]) continue;j=i;while(++i<8){if(_f[_f_seki].tefuda[i]) break;}if(i>=8) break;_f[_f_seki].tefuda[j]=_f[_f_seki].tefuda[i];_f[_f_seki].tefuda[i]=0;i=j;}i=-1;while(++i<6){if(f[i+1] && f[i]>f[i+1]){j=f[i]; f[i]=f[i+1]; f[i+1]=j;i=-1;}}i=-1; j=-1;while(++i<8){if(!_f[_f_seki].tefuda[i]) break;}while(++j<8){if(f[j]) _f[_f_seki].tefuda[i++]=f[j] | 0x400;}_f_tefuda_disp(_f_seki);if(_f_gamemode==_F_GAMEMODE_600KEN && _f_600ken_te4_flag){_f_status_disp('手四のため、配り直しです。');_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_600KEN(); ', 10);return;}_f_i++;AUDIO_OUTPUT('teyaku'+_f_seki, false);_f_h5_next=setTimeout('TEYAKU_1_2(); ', 800);}function TEYAKU_1_2(){var i,j,k,l,m;if(_f_gamemode==_F_GAMEMODE_KOIKOI){i=_f_players;while(--i>=0){_f[i].open=1;_f_tefuda_disp(i);}i='Jingle_CPUWin2';if(_f_seki==0) i='Jingle_PlayerWin';AUDIO_OUTPUT(i, false);_f_j=_f_seki;_f_h5_next=setTimeout('TEYAKU_3(); ', 10);return;}_f_h5_next=setTimeout('TEYAKU_2(); ', 10);}function TEYAKU_2(){var i,j,k,l,m;if(++_f_seki>=_f_players) _f_seki=0;if(_f_seki!=_f_oya){_f_h5_next=setTimeout('TEYAKU(); ', 10);return;}else if(!_f_i){_f_h5_next=setTimeout('TEYAKU_END(); ', 10);return;}_f_h5_next=setTimeout('TEYAKU_3(); ', 10);}function TEYAKU_3(){var i,j,k,l,m;if(_f_players==2 && _f_gamemode!=_F_GAMEMODE_600KEN) _f_yaku_disp(-1, _f_seki, '');else {_f_seki=_f_players;while(--_f_seki>=0){if(!_f[_f_seki].yaku_name_ctr) continue;i=_f_seki;if(_f_i<2) i=-1;_f_yaku_disp(i, _f_seki, '');}}inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("TEYAKU_4"); ', 10);}function TEYAKU_4(){var i,j,k,l,m;if(_f_gamemode==_F_GAMEMODE_KOIKOI){_f_oya=_f_seki=_f_j;_f_h5_next=setTimeout('IKKYOKU_END(); ', 10);return;}if(_f_gamemode==_F_GAMEMODE_600KEN){i=_f_players; while(--i>=0) _f_600ken_current_point_disp(i);_f_h5_next=setTimeout('TEYAKU_END(); ', 10);return;}if(_f_players==2){_f_h5_next=setTimeout('TEYAKU_END(); ', 10);return;}_f_balance_disp(0);inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("TEYAKU_END"); ', 10);}function TEYAKU_END(){var i,j,k,l,m;_f_console_erase();_f_balance_erase();i=_f_players;if(_f_gamemode==_F_GAMEMODE_600KEN){_f_init_balance();_f_playfield();_f_seki=_f_oya;while(--i>=0){j=8;while(--j>=0) _f[i].tefuda[j] &= 0x2ff;_f_tefuda_disp(i);}}else {while(--i>=0){_f[i].score=_f[i].score_after_balance;if(_f_players!=2) _f_score_disp(i, '#fff');j=8;while(--j>=0) _f[i].tefuda[j] &= 0x2ff;_f_tefuda_disp(i);}_f_init_balance();if(_f_players==3){i=3; while(--i>=0) _f_score_disp(i, '#fff');}else _f_playfield();_f_seki=_f_oya;}_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA(); ', 10);}function HAIFUDAGO_BAFUDA(){var i,j,k,l,m;_f_bafuda_disp();i=16; while(--i>=0) _f_month[i]=0;i=_f_bafuda.length;while(--i>=0){if((j=_f_bafuda[i] & 0xff)<1 || (_f_gamemode==_F_GAMEMODE_MUSHI && j==0xb0)) continue;_f_month[j >> 4]++;}_f_i=0;if(_f_gamemode==_F_GAMEMODE_HACHI){_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_END(); ', 10);return;}_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_2(); ', 10);}function HAIFUDAGO_BAFUDA_2(){var i,j,k,l,m;if(++_f_i>12){_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_END(); ', 10);return;}if(_f_month[_f_i]==4 || (_f_gamemode==_F_GAMEMODE_MUSHI && _f_i==11 && _f_month[11]==3)){if(_f_gamemode==_F_GAMEMODE_600KEN){_f_status_disp('場四のため、配り直しです。');_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_600KEN(); ', 10);return;}_f_j=-1;_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_3(); ', 10);return;}_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_2(); ', 10);}function HAIFUDAGO_BAFUDA_3(){var i,j,k,l,m;if(++_f_j>=_f_bafuda.length){_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_2(); ', 10);return;}if(((i=_f_bafuda[_f_j] & 0xff) >> 4)==_f_i && (_f_gamemode!=_F_GAMEMODE_MUSHI || i!=0xb0)){j=_f_torifuda_set(_f_oya, i);i=_f_bafuda[_f_j]; _f_bafuda[_f_j]=0;_f_bafuda_disp();_f_from_bafuda_to_torifuda(_f_oya, j, _f_j, i, 0);_f_h5_next=setTimeout('WAIT_MOVIE("HAIFUDAGO_BAFUDA_5"); ', 10);return;}_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_3(); ', 10);}function HAIFUDAGO_BAFUDA_5(){var i,j,k,l,m;AUDIO_OUTPUT('mekurifuda'+(++_h5_sound_ctr & 3), false);_f_torifuda_disp(_f_oya);_f_hatto_check();_f_h5_next=setTimeout('HAIFUDAGO_BAFUDA_3(); ', 10);}function HAIFUDAGO_BAFUDA_END(){var i,j,k,l,m;_f_h5_next=setTimeout('PROCCESS(); ', 10);}function HAIFUDAGO_BAFUDA_600KEN(){var i,j,k,l,m;_f_open_mode=1;i=_f_players; while(--i>0){_f_tefuda_disp(i);}inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("IKKYOKU"); ', 10);}function PROCCESS(){var i,j,k,l,m;if(_f_gamemode==_F_GAMEMODE_HANAAWASE || _f_gamemode==_F_GAMEMODE_KOREAN){if(_f_yamafuda_remain<1){_f_h5_next=setTimeout('NAGARE(); ', 10);return;}}else {i=8;while(--i>=0){if(_f[0].tefuda[i] & 0xff) break;if(_f[1].tefuda[i] & 0xff) break;if(_f_players==2) continue;if(_f[2].tefuda[i] & 0xff) break;}if(i<0){_f_h5_next=setTimeout('NAGARE(); ', 10);return;}}_f_h5_next=setTimeout('KIRIFUDA_SELECT(); ', 10);}function KIRIFUDA_SELECT(){var i,j,k,l,m;_f_pos_buff=0;_f_awasefuda_buff=0;i=8; while(--i>=0){if(_f[_f_seki].tefuda[i] & 0xff) break;}if(i<0){_f_status_disp(_f_status+_f_seatName[_f_seki]+'は手札が無いので、山札のみめくります。');_f_h5_next=setTimeout('MEKURIFUDA(); ', 40);return;}if(_f_seki){_f_pos_buff=_f_think_for_kirifuda();_f_h5_next=setTimeout('KIRIFUDA(); ', 10);return;}inputKey=-1;_f_status_disp(_f_status+'切り札を選んで下さい。');i=-1; while(++i<8){_f_te_torefuda[i]=i+1;if(!(j=_f[0].tefuda[i] & 0xff)){ _f_te_torefuda[i]=0; continue; }l=0;if(_f_gamemode==_F_GAMEMODE_HACHI){j >>= 4;k=_f_bafuda.length; while(--k>=0){if(!_f_bafuda[k]) continue;l=(_f_bafuda[k] >> 4) & 0x0f;if((l=(l+j) % 10)==3 || l==8) break;}if(k>-1) _f_te_torefuda[i]+=1000;continue;}if(_f_gamemode==_F_GAMEMODE_MUSHI){if(j==0xb0){k=_f_bafuda.length; while(--k>=0){if(!_f_bafuda[k]) continue;if((_f_bafuda[k] & 0xf0) != 0xb0) break;}if(k>-1) _f_te_torefuda[i]+=2000;continue;}if((j & 0xf0)==0xb0){k=_f_bafuda.length; while(--k>=0){if(!(_f_bafuda[k] & 0x0f)) continue;if((_f_bafuda[k] & 0xf0) == 0xb0) break;}if(k>-1) _f_te_torefuda[i]+=1000;continue;}}if(j==0xb3 && _f_gamemode==_F_GAMEMODE_600KEN){k=_f_bafuda.length; while(--k>=0){if(!_f_bafuda[k]) continue;if(_f_bafuda[k] & 0x0f) l=2000;}}j &= 0xf0;k=_f_bafuda.length; while(--k>=0){if(!_f_bafuda[k]) continue;if((_f_bafuda[k] & 0xf0) == j) break;}if(k>-1) l=1000;_f_te_torefuda[i]+=l;}_f_tefuda_disp(0);_h5_makeHandClickable();_f_h5_next=setTimeout('KIRIFUDA_SELECT_2(); ', 10);}function KIRIFUDA_SELECT_2(){var i,j,k,l,m;i=Math.random();if((i=inputKey)>0 && i<9 && (_f[0].tefuda[i-1] & 0xff)){_f_status_erase();_f_pos_buff=i-1;i=8; while(--i>=0) _f_te_torefuda[i]=0;_f_tefuda_disp(0);_h5_makeHandUnclickable();_f_h5_next=setTimeout('KIRIFUDA(); ', 10);return;}_f_h5_next=setTimeout('KIRIFUDA_SELECT_2(); ', 10);}function KIRIFUDA(){var i,j,k,l,m;_f_fuda_buff=_f[_f_seki].tefuda[_f_pos_buff] &  0xff;_f[_f_seki].tefuda[_f_pos_buff]=0;_f_hatto_check();_f_hatto_yaburi_check(_f_fuda_buff);i=_f_torifuda_flag.length; while(--i>=0) _f_torifuda_flag[i]=_f_awase_bafuda[i]=_f_torefuda_flag[i]=0;i=_f_torefuda_table.length; while(--i>=0) _f_torefuda_table[i]=0;if(_f_gamemode==_F_GAMEMODE_HACHI){j=(_f_fuda_buff & 0xf0) >> 4;i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i]) continue;k=(((_f_bafuda[i] & 0xf0) >> 4)+j) % 10;if(k==3 || k==8) _f_torefuda_flag[i]++;}k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){j=_f_normalize_code(_f_bafuda[i] & 0xff);l=k;while(--l>=0){ if(_f_normalize_code(_f_torefuda_table[l])==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(!_f_bafuda[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}else if(k==1){var m=_f_normalize_code(_f_torefuda_table[0]);i=-1; while(++i<_f_bafuda.length){if(_f_normalize_code(_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=1;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}}else {i=16; while(--i>=0) _f_month[i]=0;i=_f_bafuda.length; while(--i>=0){if((j=_f_bafuda[i] & 0xff)>1 && (_f_gamemode!=_F_GAMEMODE_MUSHI || j!=0xb0)) _f_month[j >> 4]++;}j=_f_fuda_buff >> 4;if(_f_month[j]==3 || (_f_month[11]==2 && _f_gamemode==_F_GAMEMODE_MUSHI && j==11 && _f_fuda_buff!=0xb0)){i=-1; k=-1; while(++i<_f_bafuda.length){if(((_f_bafuda[i] >> 4) & 15)!=j || (_f_gamemode==_F_GAMEMODE_MUSHI && (_f_bafuda[i] & 0xff)==0xb0)) continue;if(k<0){ _f_awase_bafuda[i]=_f_fuda_buff; k=i; }_f_torifuda_flag[i]=1;}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, k, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}else {if(_f_gamemode==_F_GAMEMODE_600KEN && _f_fuda_buff==0xb3){i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i]) continue;if((_f_bafuda[i] & 0xf0) == 0xb0){ _f_torefuda_flag[i]++; continue; }if((_f_bafuda[i] & 0x0f) && _f_month[_f_bafuda[i] >> 4]<3){ _f_torefuda_flag[i]++; }}k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){j=_f_bafuda[i] & 0xff;l=k;while(--l>=0){ if(_f_torefuda_table[l]==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(!_f_bafuda[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}else if(k==1){var m=_f_torefuda_table[0];i=-1; while(++i<_f_bafuda.length){if((_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=1;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}}else if(_f_gamemode==_F_GAMEMODE_MUSHI && _f_fuda_buff==0xb0){i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i]) continue;if((_f_bafuda[i] & 0xf0) != 0xb0) _f_torefuda_flag[i]++;}j=0; k=0; i=13; l=-1;while(--i>0){if(i==11) continue;if(_f_month[i]==3){ ++j; l=i; continue; }if(_f_month[i]) ++k;}if(j==1 && k==0){i=-1; k=-1;while(++i<_f_bafuda.length){if(((_f_bafuda[i] >> 4) & 15)!=l) continue;if(k<0){ _f_awase_bafuda[i]=_f_fuda_buff; k=i; }_f_torifuda_flag[i]=1;}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, k, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}else {k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){j=_f_normalize_code(_f_bafuda[i] & 0xff);l=k;while(--l>=0){ if(_f_normalize_code(_f_torefuda_table[l])==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(!_f_bafuda[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}else if(k==1){var m=_f_normalize_code(_f_torefuda_table[0]);i=-1; while(++i<_f_bafuda.length){if(_f_normalize_code(_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=1;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}}}else {if(_f_gamemode==_F_GAMEMODE_MUSHI && (_f_fuda_buff & 0xf0)==0xb0){i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i]) continue;if(((j=_f_bafuda[i]) & 0xf0)==0xb0 && (j & 0xff)!=0xb0) _f_torefuda_flag[i]++;}}else {j=_f_fuda_buff & 0xf0;i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i]) continue;if((_f_bafuda[i] & 0xf0)==j) _f_torefuda_flag[i]++;}}k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){j=_f_normalize_code(_f_bafuda[i] & 0xff);l=k;while(--l>=0){ if(_f_normalize_code(_f_torefuda_table[l])==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(!_f_bafuda[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}else if(k==1){var m=_f_normalize_code(_f_torefuda_table[0]);i=-1; while(++i<_f_bafuda.length){if(_f_normalize_code(_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=1;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);return;}}}}_f_h5_next=setTimeout('KIRIFUDA_H5_1(); ', 10);}function KIRIFUDA_H5_1(){if(_f_awasefuda_buff>0){_f_h5_next=setTimeout('KIRIFUDA_3(); ', 10);return;}_f_bafuda_disp(1);_h5_makeBafudaClickable();inputKey=-1;_f_status_disp('合せ札を選んで下さい。');_f_h5_next=setTimeout('KIRIFUDA_AWASEERABI(); ', 10);}function KIRIFUDA_AWASEERABI(){var i,j,k,l,m;i=Math.random();if((_f_i=inputKey-100)>=0 && _f_torefuda_flag[_f_i]){_f_awasefuda_buff=_f_bafuda[_f_i];_h5_makeBafudaUnclickable();_f_bafuda_disp(0);_f_status_erase();inputKey=0;_f_h5_next=setTimeout('KIRIFUDA_3(); ', 10);return;}inputKey=0;_f_h5_next=setTimeout('KIRIFUDA_AWASEERABI(); ', 10);}function KIRIFUDA_3(){var i,j,k,l,m;k=-1; _f_awasefuda_buff &= 0xff;if(_f_gamemode==_F_GAMEMODE_MUSHI && (_f_fuda_buff & 0xff)==0xb0){i=_f_bafuda.length; k=0;while(--i>=0){if((_f_bafuda[i] ^ _f_awasefuda_buff) & 0xf0) continue;++k;}if(k==3){i=_f_bafuda.length; k=-1;while(--i>=0){if((_f_bafuda[i] ^ _f_awasefuda_buff) & 0xf0) continue;_f_torifuda_flag[i]=1;}_f_awase_bafuda[_f_i]=_f_fuda_buff;_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, _f_i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);}}if(k!=3){_f_awase_bafuda[_f_i]=_f_fuda_buff;_f_torifuda_flag[_f_i]=1;_f_tefuda_disp(_f_seki);_f_from_tefuda_to_bafuda(_f_seki, _f_pos_buff, _f_i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("KIRIFUDA_END"); ', 10);}}function KIRIFUDA_END(){_f_bafuda_disp();AUDIO_OUTPUT('kirifuda'+(++_h5_sound_ctr & 3), false);_f_h5_next=setTimeout('MEKURIFUDA(); ', 40);}function MEKURIFUDA(){_f_fuda_buff=_f_yamafuda[--_f_yamafuda_remain];_f_yamafuda_disp(_f_fuda_buff);_f_h5_next=setTimeout('MEKURIFUDA_AWASE(); ', 10);}function MEKURIFUDA_AWASE(){var i,j,k,l,m;_f_fuda_buff &= 0xff;_f_awasefuda_buff=-1;i=_f_torefuda_flag.length; while(--i>=0) _f_torefuda_flag[i]=0;i=_f_torefuda_table.length; while(--i>=0) _f_torefuda_table[i]=0;i=-1;if(_f_gamemode==_F_GAMEMODE_HACHI){l=0; j=(_f_fuda_buff >> 4) & 0x0f;i=_f_bafuda.length; while(--i>=0){_f_torefuda_flag[i]=0;if(!_f_bafuda[i] || _f_torifuda_flag[i]) continue;k=(j+((_f_bafuda[i] >> 4) & 0x0f)) % 10;if(k==3 || k==8) _f_torefuda_flag[i]++;}k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){if(_f_torifuda_flag[i]) continue;j=_f_normalize_code(_f_bafuda[i] & 0xff);l=k;while(--l>=0){ if(_f_normalize_code(_f_torefuda_table[l])==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(!_f_bafuda[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else if(k==1){var m=_f_normalize_code(_f_torefuda_table[0]);i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(_f_normalize_code(_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=2;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}}else {if(_f_gamemode==_F_GAMEMODE_MUSHI){j=k=-1; l=0;i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i] || _f_torifuda_flag[i]) continue;if((_f_bafuda[i] & 0xff)==0xb0) j=i;else if((_f_bafuda[i] & 0xf0)==0xb0) k=i;else if(!((_f_bafuda[i] ^ _f_fuda_buff) & 0xf0)) ++l;}if(j>-1 && ((_f_fuda_buff & 0xf0)!=0xb0 || !_f_yamafuda_remain)){_f_torifuda_flag[j]=2;_f_awase_bafuda[j]=_f_fuda_buff;_f_yamafuda_disp(0);if(l==3){i=_f_bafuda.length; while(--i>=0){if(!((_f_bafuda[i] ^ _f_fuda_buff) & 0xf0)) _f_torifuda_flag[i]=2;}}_f_from_yamafuda_to_bafuda_after_select(j, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else if(_f_yamafuda_remain<1 && _f_fuda_buff==0xb0){i=_f_bafuda.length; while(--i>=0){if(_f_torifuda_flag[i]) continue;if(_f_bafuda[i]) break;}if(i<0){i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(!_f_bafuda[i] && !_f_torifuda_flag[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else {_f_torifuda_flag[i]=2;_f_awase_bafuda[i]=_f_fuda_buff;_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}}else i=-1;}if(i<0){i=16; while(--i>=0) _f_month[i]=0;i=_f_bafuda.length; while(--i>=0){if(_f_torifuda_flag[i]) continue;if((j=_f_bafuda[i] & 0xff)>1 && (_f_gamemode!=_F_GAMEMODE_MUSHI || j!=0xb0)) _f_month[j >> 4]++;}j=_f_fuda_buff >> 4;if(_f_month[j]==3 || (_f_month[11]==2 && _f_gamemode==_F_GAMEMODE_MUSHI && j==11 && _f_fuda_buff!=0xb0)){i=-1; k=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(((_f_bafuda[i] >> 4) & 15)!=j || (_f_gamemode==_F_GAMEMODE_MUSHI && (_f_bafuda[i] & 0xff)==0xb0)) continue;if(k<0){ _f_awase_bafuda[i]=_f_fuda_buff; k=i; }_f_torifuda_flag[i]=2;}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(k, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else {if(_f_gamemode==_F_GAMEMODE_600KEN && _f_fuda_buff==0xb3){i=_f_bafuda.length; while(--i>=0){if(_f_torifuda_flag[i]) continue;if(!(_f_bafuda[i] & 0xff)) continue;if((_f_bafuda[i] & 0xf0) == 0xb0){ _f_torefuda_flag[i]++; continue; }if((_f_bafuda[i] & 0x0f) && _f_month[(_f_bafuda[i] >> 4) & 0x0f]<3) _f_torefuda_flag[i]++;}k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){if(!_f_bafuda[i] || _f_torifuda_flag[i]) continue;j=_f_bafuda[i] & 0xff;l=k;while(--l>=0){ if(_f_torefuda_table[l]==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(!_f_bafuda[i] && !_f_torifuda_flag[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else if(k==1){var m=_f_torefuda_table[0];i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if((_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=2;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}}else if(_f_gamemode==_F_GAMEMODE_MUSHI && _f_fuda_buff==0xb0){i=_f_bafuda.length; while(--i>=0){if(_f_torifuda_flag[i]) continue;if(!(_f_bafuda[i] & 0xff)) continue;if((_f_bafuda[i] & 0xf0) != 0xb0) _f_torefuda_flag[i]++;}j=0; k=0; i=13; l=-1;while(--i>0){if(i==11) continue;if(_f_month[i]==3){ ++j; l=i; continue; }if(_f_month[i]) ++k;}if(j==1 && k==0){i=-1; k=-1;while(++i<_f_bafuda.length){if(((_f_bafuda[i] >> 4) & 15)!=l) continue;if(_f_torifuda_flag[i]) continue;if(k<0){ _f_awase_bafuda[i]=_f_fuda_buff; k=i; }_f_torifuda_flag[i]=2;}_f_j=1;_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(k, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else {k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){if(!_f_bafuda[i] || _f_torifuda_flag[i]) continue;j=_f_normalize_code(_f_bafuda[i] & 0xff);l=k;while(--l>=0){ if(_f_normalize_code(_f_torefuda_table[l])==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(!_f_bafuda[i] && !_f_torifuda_flag[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else if(k==1){var m=_f_normalize_code(_f_torefuda_table[0]);i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(_f_normalize_code(_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=2;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}}}else {if(_f_gamemode==_F_GAMEMODE_MUSHI && (_f_fuda_buff & 0xf0)==0xb0){i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i] || _f_torifuda_flag[i]) continue;if(((j=_f_bafuda[i]) & 0xf0)==0xb0 && (j & 0xff)!=0xb0) _f_torefuda_flag[i]++;}}else {j=_f_fuda_buff & 0xf0;i=_f_bafuda.length; while(--i>=0){if(!_f_bafuda[i] || _f_torifuda_flag[i]) continue;if(_f_gamemode==_F_GAMEMODE_600KEN && (_f_fuda_buff & 0x0f) && (_f_bafuda[i] & 0xff)==0xb3){_f_torefuda_flag[i]++; continue;}if((_f_bafuda[i] & 0xf0)==j) _f_torefuda_flag[i]++;}}k=0; i=_f_bafuda.length; while(--i>=0){if(_f_torefuda_flag[i]){if(_f_torifuda_flag[i]) continue;j=_f_normalize_code(_f_bafuda[i] & 0xff);l=k;while(--l>=0){ if(_f_normalize_code(_f_torefuda_table[l])==j) break; }if(l<0){ _f_torefuda_table[k++]=_f_bafuda[i] & 0xff; }}}if(k==0){i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(!_f_bafuda[i]){_f_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}else if(k==1){var m=_f_normalize_code(_f_torefuda_table[0]);i=-1; while(++i<_f_bafuda.length){if(_f_torifuda_flag[i]) continue;if(_f_normalize_code(_f_bafuda[i] & 0xff)==m){_f_torifuda_flag[i]=2;_f_awase_bafuda[i]=_f_fuda_buff;break;}}_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);return;}}}}}_f_h5_next=setTimeout('MEKURIFUDA_AWASE_H5(); ', 10);}function MEKURIFUDA_AWASE_H5(){_f_yamafuda_disp(_f_fuda_buff);if(_f_seki!=0){_f_i=_f_think_for_mekurifuda();_f_awasefuda_buff=_f_bafuda[_f_i];_f_h5_next=setTimeout('MEKURIFUDA_AWASE_3(); ', 10);return;}_f_bafuda_disp(1);_h5_makeBafudaClickable();inputKey=-1;_f_status_disp('合せ札を選んで下さい。');_f_h5_next=setTimeout('MEKURIFUDA_AWASEERABI(); ', 10);}function MEKURIFUDA_AWASEERABI(){var i,j,k,l,m;i=Math.random();if((_f_i=inputKey-100)>=0 && _f_torefuda_flag[_f_i]){_f_awasefuda_buff=_f_bafuda[_f_i];_h5_makeBafudaUnclickable();_f_bafuda_disp(0);_f_status_erase();inputKey=0;_f_h5_next=setTimeout('MEKURIFUDA_AWASE_3(); ', 10);return;}inputKey=0;_f_h5_next=setTimeout('MEKURIFUDA_AWASEERABI(); ', 10);}function MEKURIFUDA_AWASE_3(){var i,j,k,l,m;k=-1; _f_awasefuda_buff &= 0xff;if(_f_gamemode==_F_GAMEMODE_MUSHI && (_f_fuda_buff & 0xff)==0xb0){i=_f_bafuda.length; k=0;while(--i>=0){if((_f_bafuda[i] ^ _f_awasefuda_buff) & 0xf0) continue;++k;}if(k==3){i=_f_bafuda.length; k=-1;while(--i>=0){if((_f_bafuda[i] ^ _f_awasefuda_buff) & 0xf0) continue;_f_torifuda_flag[i]=2;}_f_awase_bafuda[_f_i]=_f_fuda_buff;_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(_f_i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);}}if(k!=3){_f_awase_bafuda[_f_i]=_f_fuda_buff;_f_torifuda_flag[_f_i]=2;_f_yamafuda_disp(0);_f_from_yamafuda_to_bafuda_after_select(_f_i, _f_fuda_buff);_f_h5_next=setTimeout('WAIT_MOVIE("MEKURIFUDA_AWASE_END"); ', 10);}}function MEKURIFUDA_AWASE_END(){var i,j,k,l,m;_f_bafuda_disp();AUDIO_OUTPUT('kirifuda'+(++_h5_sound_ctr & 3), false);if(_f_gamemode==_F_GAMEMODE_600KEN){_f[_f_seki].current_point_600ken=_f[_f_seki].point_600ken+_f[_f_seki].koikoi_monsu+_f[_f_seki].torifuda05_ctr*10+_f[_f_seki].torifuda10_ctr*10+_f[_f_seki].torifuda20_ctr*50;if(_f_600ken_victor<0 && _f[_f_seki].current_point_600ken>599) _f_600ken_victor=_f_seki;_f_600ken_current_point_disp(_f_seki);}_f_h5_next=setTimeout('FUDATORI(); ', 30);}function FUDATORI(){_f_i=0;_f_h5_next=setTimeout('FUDATORI_2(); ', 10);}function FUDATORI_2(){if(++_f_i>2){_f_h5_next=setTimeout('FUDATORI_END(); ', 30);return;}_f_j=-1;_f_h5_next=setTimeout('FUDATORI_3(); ', 30);}function FUDATORI_3(){var i, j, k;var kr_obj=new Object();if(++_f_j>=_f_bafuda.length){_f_h5_next=setTimeout('FUDATORI_2(); ', 10);return;}if(_f_torifuda_flag[_f_j]==_f_i){k=1; var fj=_f_j;if(_f_awase_bafuda[_f_j]!=0){if((_f_awase_bafuda[_f_j] & 0x0f)>3){kr_toCardDataObj(_f_awase_bafuda[_f_j], kr_obj);i=kr_obj.cards[kr_obj.num-1];j=_f_torifuda_set(_f_seki, i);_f_awase_bafuda[_f_j]=kr_fromCardDataObj(kr_obj.num-1, kr_obj.cards);--_f_j;}else {i=_f_awase_bafuda[_f_j];j=_f_torifuda_set(_f_seki, i);_f_awase_bafuda[_f_j]=0;--_f_j;}}else {if((_f_bafuda[_f_j] & 0x0f)>3){kr_toCardDataObj(_f_bafuda[_f_j], kr_obj);i=kr_obj.cards[kr_obj.num-1];j=_f_torifuda_set(_f_seki, i);_f_bafuda[_f_j]=kr_fromCardDataObj(kr_obj.num-1, kr_obj.cards);--_f_j;}else {i=_f_bafuda[_f_j];j=_f_torifuda_set(_f_seki, i);_f_bafuda[_f_j]=0;_f_torifuda_flag[_f_j]=0;}k=0;}_f_bafuda_disp();_f_from_bafuda_to_torifuda(_f_seki, j, fj, i, k);_f_h5_next=setTimeout('WAIT_MOVIE("FUDATORI_5"); ', 10);return;}_f_h5_next=setTimeout('FUDATORI_3(); ', 10);}function FUDATORI_5(){var i, j, k;AUDIO_OUTPUT('mekurifuda'+(++_h5_sound_ctr & 3), false);_f_torifuda_disp(_f_seki);_f_hatto_check();if(_f_gamemode==_F_GAMEMODE_600KEN){_f[_f_seki].current_point_600ken=_f[_f_seki].point_600ken+_f[_f_seki].koikoi_monsu+_f[_f_seki].torifuda05_ctr*10+_f[_f_seki].torifuda10_ctr*10+_f[_f_seki].torifuda20_ctr*50;if(_f_600ken_victor<0 && _f[_f_seki].current_point_600ken>599) _f_600ken_victor=_f_seki;_f_600ken_current_point_disp(_f_seki);}_f_h5_next=setTimeout('FUDATORI_3(); ', 10);}function FUDATORI_END(){var i, j, k;i=-1; while(++i<8){if(_f[_f_seki].tefuda[i] & 0xff) continue;j=i;while(++j<9){if(_f[_f_seki].tefuda[j] & 0xff) break;}if(j>=9) continue;_f[_f_seki].tefuda[i]=_f[_f_seki].tefuda[j];_f[_f_seki].tefuda[j]=0;}_f_tefuda_disp(_f_seki);_f_h5_next=setTimeout('DEKIYAKU(); ', 30);}function DEKIYAKU(){var i, j, k;_f_status='';if(_f_gamemode!=_F_GAMEMODE_KOIKOI && _f_gamemode!=_F_GAMEMODE_88 && _f_gamemode!=_F_GAMEMODE_600KEN){_f_h5_next=setTimeout('PROCCESS_NEXT(); ', 10);return;}else if(_f_gamemode==_F_GAMEMODE_600KEN){var vvv=_f_600ken_victor;_f_dekiyaku_judge(_f_seki);_f_torifuda_disp(_f_seki);_f_600ken_current_point_disp(_f_seki);if(_f_600ken_victor>-1 && vvv>-1 && _f_600ken_victor!=vvv){_f_600ken_current_point_disp(vvv);}_f_h5_next=setTimeout('PROCCESS_NEXT(); ', 10);return;}else if(_f_dekiyaku_judge(_f_seki)<=_f[_f_seki].koikoi_monsu){_f_h5_next=setTimeout('PROCCESS_NEXT(); ', 10);return;}else {_f_torifuda_disp(_f_seki);_f_command=-1; i=8;while(--i>=0){if(_f[_f_seki].tefuda[i] & 0xff) break;}if(i<0){i='CPUの上がりです。';if(_f_seki==0) i='あなたの上がりです。';else if(_f_players==3) i=_f_seatName[_f_seki]+'の上がりです。';_f_status_disp(i);_f_command=12;_f_h5_next=setTimeout('DEKIYAKU_4(); ', 560);return;}else if(_f_koikoi_flag>-1 && _f_koikoi_flag!=_f_seki){i='CPUの上がりです。';if(_f_seki==0) i='あなたの上がりです。';else if(_f_players==3) i=_f_seatName[_f_seki]+'の上がりです。';_f_status_disp(i);_f_command=12;_f_h5_next=setTimeout('DEKIYAKU_4(); ', 560);return;}else {if(_f_seki){_f_command=_f_think_for_koikoi() ? 11 : 12;if(_f_command==12){i='CPUの上がりです。';if(_f_seki==0) i='あなたの上がりです。';else if(_f_players==3) i=_f_seatName[_f_seki]+'の上がりです。';_f_status_disp(i);}_f_h5_next=setTimeout('DEKIYAKU_4(); ', 560);return;}else {i='「こいこい」しますか？';if(_f_gamemode==_F_GAMEMODE_88){ i='「下げ」ますか？'; }_f_status_disp('出来役が出来ました。\n'+i);_f_console_disp();}}}_f_h5_next=setTimeout('DEKIYAKU_3(); ', 10);}function DEKIYAKU_3(){var i, j, k;i=Math.random();if((i=inputKey)==11 || i==12){_f_command=i;_f_console_erase();if(i==12){_f_status_disp('あなたの上がりです。');f_h5_next=setTimeout('DEKIYAKU_4(); ', 160);return;}else {_f_status_erase();f_h5_next=setTimeout('DEKIYAKU_4(); ', 10);return;}}_f_h5_next=setTimeout('DEKIYAKU_3(); ', 10);}function DEKIYAKU_4(){var i, j, k;if(_f_command==12){AUDIO_OUTPUT('agari'+_f_seki, false);_f_h5_next=setTimeout('END_BY_DEKIYAKU(); ', 10);return;}else {if(_f_gamemode==_F_GAMEMODE_88){i=3;while(--i>=0){_f[i].score=_f[i].score_after_balance;}_f_init_balance();if(_f_players==2) _f_playfield();else {i=3; while(--i>=0) _f_score_disp(i, 0xffffff);}_f[_f_seki].torifuda_dekiyaku=0;i='あなた';if(_f_seki){i='CPU';if(_f_players>2) i=_f_seatName[_f_command];}_f_status=i+'は下げしました。\n\n';i='sage';}else {_f[_f_seki].koikoi_monsu=_f[_f_seki].torifuda_dekiyaku;i='koikoi';}_f_koikoi_flag=_f_seki;_f_status='CPUはこいこいしました。\n\n';AUDIO_OUTPUT(i+_f_seki, false);}_f_h5_next=setTimeout('PROCCESS_NEXT(); ', 10);}function PROCCESS_NEXT(){if(++_f_seki>=_f_players) _f_seki=0;_f_h5_next=setTimeout('PROCCESS(); ', 10);}function END_BY_DEKIYAKU(){var i, j;_f_open_mode=1;i=_f_players; while(--i>0){_f_tefuda_disp(i);}i='Jingle_CPUWin2';if(_f_seki==0) i='Jingle_PlayerWin';else if(_f_koikoi_flag==0) i='Jingle_PlayerLose';AUDIO_OUTPUT(i, false);inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("END_BY_DEKIYAKU_3"); ', 10);}function END_BY_DEKIYAKU_3(){var i, j, k;i=_f_players; j=0;while(--i>=0){if(_f[i].yaku_name_ctr>0 || _f[i].payback_name_ctr>0 || _f[i].torifuda_total>0) ++j;}i=_f_players;while(--i>=0){if(_f[i].yaku_name_ctr<1 && _f[i].payback_name_ctr<1 && _f[i].torifuda_total<1) continue;k=i; if(j<2) k=-1;_f_torifuda_disp(i);_f_yaku_disp(k, i, '');}inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("END_BY_DEKIYAKU_5"); ', 10);}function END_BY_DEKIYAKU_5(){var i, j, k;_f_oya=_f_seki;_f_h5_next=setTimeout('IKKYOKU_END(); ', 10);}function NAGARE(){var i, j, k;if(_f_gamemode!=_F_GAMEMODE_MUSHI){_f_h5_next=setTimeout('NAGARE_1(); ', 10);return;}_f_command=_f_oya;i=_f[_f_oya].torifuda05_ctr; while(--i>=0){ if((_f[_f_oya].torifuda05[i] & 0xf0)==0xb0) break; }if(i<0){i=_f[_f_oya].torifuda10_ctr; while(--i>=0){ if((_f[_f_oya].torifuda10[i] & 0xf0)==0xb0) break; }if(i<0){i=_f[_f_oya].torifuda20_ctr; while(--i>=0){ if((_f[_f_oya].torifuda20[i] & 0xf0)==0xb0) break; }if(i<0) _f_command=_f_oya ? 0 : 1;}}_f_h5_next=setTimeout('NAGARE_MUSHI_2(); ', 10);}function NAGARE_MUSHI_2(){var i, j, k;i=_f_bafuda.length;while(--i>=0){if(((j=_f_bafuda[i]) & 0xf0)==0xb0) break;}if(i<0){_f_h5_next=setTimeout('NAGARE_MUSHI_3(); ', 10);return;}var x, y, p=1;_f_bafuda[i]=0; k=j & 0x0f;if(k==1){ p=5; _f[_f_command].torifuda05[_f[_f_command].torifuda05_ctr++]=j; }else if(k==2){ p=10; _f[_f_command].torifuda10[_f[_f_command].torifuda10_ctr++]=j; }else if(k==3){ p=20; _f[_f_command].torifuda20[_f[_f_command].torifuda20_ctr++]=j; }else {  _f[_f_command].torifuda01[_f[_f_command].torifuda01_ctr++]=j;  }_f_torifuda_coords(_f_command, p);x=_f_x; y=_f_y;_f_bafuda_coords(i);_f_bafuda_disp();_f_from_bafuda_to_torifuda(_f_command, p, i, j, 0);_f_h5_next=setTimeout('WAIT_MOVIE("NAGARE_MUSHI_2_3"); ', 10);}function NAGARE_MUSHI_2_3(){var i, j, k;AUDIO_OUTPUT('mekurifuda'+(++_h5_sound_ctr & 3), false);_f_torifuda_disp(_f_command);_f_h5_next=setTimeout('NAGARE_MUSHI_2(); ', 10);}function NAGARE_MUSHI_3(){var i, j, k;_f_command=0;i=_f[0].torifuda01_ctr; while(--i>=0){ if((_f[0].torifuda01[i] & 0xf0)==0xb0) break; }if(i<0) _f_command=1;_f_h5_next=setTimeout('NAGARE_MUSHI_3_1(); ', 10);}function NAGARE_MUSHI_3_1(){var i, j, k;i=_f_bafuda.length;while(--i>=0){if(((j=_f_bafuda[i]) & 0xff)!=0) break;}if(i<0){_f_h5_next=setTimeout('NAGARE_MUSHI_END(); ', 10);return;}var x, y, p=1;_f_bafuda[i]=0; k=j & 0x0f;if(k==1){ p=5; _f[_f_command].torifuda05[_f[_f_command].torifuda05_ctr++]=j; }else if(k==2){ p=10; _f[_f_command].torifuda10[_f[_f_command].torifuda10_ctr++]=j; }else if(k==3){ p=20; _f[_f_command].torifuda20[_f[_f_command].torifuda20_ctr++]=j; }else {  _f[_f_command].torifuda01[_f[_f_command].torifuda01_ctr++]=j;  }_f_torifuda_coords(_f_command, p);x=_f_x; y=_f_y;_f_bafuda_coords(i);_f_bafuda_disp();_f_from_bafuda_to_torifuda(_f_command, p, i, j, 0);_f_h5_next=setTimeout('WAIT_MOVIE("NAGARE_MUSHI_3_3"); ', 10);}function NAGARE_MUSHI_3_3(){var i, j, k;AUDIO_OUTPUT('mekurifuda'+(++_h5_sound_ctr & 3), false);_f_torifuda_disp(_f_command);_f_h5_next=setTimeout('NAGARE_MUSHI_2(); ', 10);}function NAGARE_MUSHI_END(){NAGARE_1();}function NAGARE_1(){var i, j, k;if(_f_gamemode==_F_GAMEMODE_KOIKOI){_f_h5_next=setTimeout('NAGARE_KOIKOI(); ', 10);return;}_f_command=_f_nagare_judge();j='Jingle_Drawn'; i='一局終了です。';if(_f_gamemode==_F_GAMEMODE_600KEN || _f_gamemode==_F_GAMEMODE_HACHI){if(_f_command==0){j='Jingle_PlayerWin';if(_f_players==2) i='あなたの勝ちです。';else i=_f_seatName[_f_command]+'の勝ちです。';}else if(_f_command>0){j='Jingle_CPUWin2';if(_f_players==2) i='CPUの勝ちです。';else {i=_f_seatName[_f_command]+'の勝ちです。';if(_f_gamemode==_F_GAMEMODE_88){if(_f[0].balance_torifuda<_f[1].balance_torifuda && _f[0].balance_torifuda<_f[2].balance_torifuda) j='Jingle_PlayerLose';}else if(_f[0].balance_total<_f[1].balance_total && _f[0].balance_total<_f[2].balance_total) j='Jingle_PlayerLose';}}else if(_f_command==-0x10){j='Jingle_PlayerWin';i='あなたの上がりです。';}else if(_f_command==-0x11){j='Jingle_CPUWin2';i='CPUの上がりです。';}else if(_f_command==-0x20){i='引き分けです。\n次局の親はあなたになります。';}else if(_f_command==-0x21){i='引き分けです。\n次局の親はCPUになります。';}else if(_f_gamemode==_F_GAMEMODE_HACHI) i='引き分けです。';}else if(_f_command==0){j='Jingle_PlayerWin';if(_f_players==2) i='あなたの上がりです。';else i=_f_seatName[_f_command]+'の上がりです。';}else if(_f_command>0){j='Jingle_CPUWin2';if(_f_players==2) i='CPUの上がりです。';else {i=_f_seatName[_f_command]+'の上がりです。';if(_f_gamemode==_F_GAMEMODE_88){if(_f[0].balance_torifuda<_f[1].balance_torifuda && _f[0].balance_torifuda<_f[2].balance_torifuda) j='Jingle_PlayerLose';}else if(_f[0].balance_total<_f[1].balance_total && _f[0].balance_total<_f[2].balance_total) j='Jingle_PlayerLose';}}if(_f_gamemode==_F_GAMEMODE_600KEN && _f_command==-256){i='無効局となりました。';}_f_status_disp(i);AUDIO_OUTPUT(j, false);i=_f_players;while(--i>=0){_f_torifuda_disp(i);}inputKey=0;_f_mini_console_disp('');_f_h5_next=setTimeout('WAIT_MINICONSOLE("NAGARE_3"); ', 10);}function NAGARE_3(){var i, j, k;if(_f_gamemode==_F_GAMEMODE_88){if(_f_players==3){i=_f_players; j=0;while(--i>=0){if(_f[i].yaku_name_ctr>0 || _f[i].payback_name_ctr>0 || _f[i].torifuda_total>0) ++j;}i=_f_players;while(--i>=0){if(_f[i].yaku_name_ctr<1 && _f[i].payback_name_ctr<1 && _f[i].torifuda_total<1) continue;k=i; if(j<2) k=-1;_f_torifuda_disp(i);_f_yaku_disp(k, i, '');}}else _f_yaku_disp(-1, 0, '');}else if(_f_gamemode==_F_GAMEMODE_MUSHI){_f_torifuda_disp(0);_f_torifuda_disp(1);_f_yaku_disp(-1, 0, '');}else if(_f_gamemode==_F_GAMEMODE_600KEN || _f_gamemode==_F_GAMEMODE_HACHI){if(_f_command==-256){_f_yaku_disp(-1, 0, 'フケ');}else {i=_f_players;while(--i>=0){_f_torifuda_disp(i);_f_yaku_disp(i, i, '');}}}else {if(_f[0].torifuda_total==0 && _f[1].torifuda_total==0){i=_f_players; j=0; k=-1;while(--i>=0){if(_f[i].yaku_name_ctr>0){ ++j; k=i; }}if(j==1){_f_yaku_disp(-1, k, '');}else {i=_f_players; while(--i>=0){if(_f[i].yaku_name_ctr>0) _f_yaku_disp(i, i, '');}}}else {i=_f_players;while(--i>=0){_f_torifuda_disp(i);_f_yaku_disp(i, i, '');}}}inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("NAGARE_5"); ', 10);}function NAGARE_5(){var i, j, k;if(_f_gamemode==_F_GAMEMODE_HACHI){switch (_f_command){case -0x20: ;case 0: _f_8_prev_winner=-1;_f_oya=0;break;case -0x10: _f_8_prev_winner=0;_f_oya=0;break;case -0x21: ;case 1: _f_8_prev_winner=-1;_f_oya=1;break;case -0x11: _f_8_prev_winner=1;_f_oya=1;break;default: _f_8_prev_winner=-1;}}else if(_f_gamemode==_F_GAMEMODE_600KEN){if(++_f_oya>=_f_players) _f_oya=0;if(_f_command==-256){_f_600ken_4ko_flag=_f_600ken_4ko_flag2;_f_600ken_victor=_f_600ken_victor2;_f_600ken_ichikoro_flag=_f_600ken_ichikoro_flag2;_f_600ken_te4_flag=_f_600ken_te4_flag2;_f_600ken_new=0;i=_f_players; while(--i>=0){_f[i].current_point_600ken=_f[i].point_600ken=_f[i].score_before_game;}}else if(_f_600ken_victor>-1){_f_600ken_4ko_flag=-1;_f_600ken_victor=-1;_f_600ken_ichikoro_flag=-1;_f_600ken_te4_flag=0;_f_600ken_new=1;i=_f_players; while(--i>=0) _f[i].current_point_600ken=_f[i].point_600ken=0;}else {_f_600ken_new=0;i=_f_players; while(--i>=0) _f[i].point_600ken=_f[i].current_point_600ken;}}else if(_f_command>-1) _f_oya=_f_command;_f_h5_next=setTimeout('IKKYOKU_END(); ', 10);}function NAGARE_KOIKOI(){var i, j, k;_f_mini_console_disp('');_f_command=_f_nagare_judge();j='Jingle_Drawn'; i='流れです。';if(_f_command==0){j='Jingle_PlayerWin';if(_f_players==2) i='あなたの上がりです。';else i=_f_seatName[_f_command]+'の上がりです。';}else if(_f_command>0){j='Jingle_CPUWin2';if(_f_players==2) i='CPUの上がりです。';else i=_f_seatName[_f_command]+'の上がりです。';}_f_status_disp(i);AUDIO_OUTPUT(j, false);j=0; if(_f_command==0) j=1;i=8; while(--i>=0) _f[j].tefuda[i] &= 0xff;_f_torifuda_disp(0);_f_torifuda_disp(1);inputKey=0;_f_h5_next=setTimeout('WAIT_MINICONSOLE("NAGARE_KOIKOI_3"); ', 10);}function NAGARE_KOIKOI_3(){var i, j, k;if(_f_command<0){_f_h5_next=setTimeout('IKKYOKU_END(); ', 10);return;}_f_yaku_disp(-1, _f_command, '');inputKey=0;_f_mini_console_disp();_f_h5_next=setTimeout('WAIT_MINICONSOLE("NAGARE_KOIKOI_5"); ', 10);}function NAGARE_KOIKOI_5(){if(_f_command>-1) _f_oya=_f_command;_f_h5_next=setTimeout('IKKYOKU_END(); ', 10);}function IKKYOKU_END(){var i, j, k;if(_f_players==3 && _f_gamemode!=_F_GAMEMODE_600KEN){i=_f_players;while(--i>=0){_f[i].score_before_game=_f[i].score=_f[i].score_after_balance;_f[i].current_result=_f[i].result_after_balance;}_f_balance_disp(0);}else if(_f_gamemode==_F_GAMEMODE_600KEN || _f_gamemode==_F_GAMEMODE_HACHI){i=_f_players;while(--i>=0){_f[i].score_before_game=_f[i].score_after_balance=_f[i].score;_f[i].current_result=_f[i].result_after_balance;}_f_h5_next=setTimeout('IKKYOKU_END_3(); ', 10);return;}else {i=_f_players;while(--i>=0){_f[i].score_before_game=_f[i].score=_f[i].score_after_balance;_f[i].current_result=_f[i].result_after_balance;}_f_h5_next=setTimeout('IKKYOKU_END_3(); ', 10);return;}inputKey=0;_f_h5_next=setTimeout('WAIT_MINICONSOLE("IKKYOKU_END_3"); ', 10);}function IKKYOKU_END_3(){var i, j, k;if(_f_gamemode==_F_GAMEMODE_600KEN || _f_gamemode==_F_GAMEMODE_HACHI){i=_f_players;while(--i>=0){if(_f[i].score>_f_600ken_norm*10-1) break;}if(i<0){_f_h5_next=setTimeout('IKKYOKU(); ', 10);return;}}if(++_f_kyokusu_ctr<_f_max_kyokusu ||(_f_gamemode==_F_GAMEMODE_88 && _f_rule_sel['HH_extension'] && _f_88_ba_rate_next>1) ||(_f_gamemode==_F_GAMEMODE_600KEN && !_f_600ken_new)){_f_h5_next=setTimeout('IKKYOKU(); ', 10);return;}_f_h5_next=setTimeout('GAME_END(); ', 10);}function GAME_END(){var i, j, k;var cs, margin, blines, bcolumns;var w, h, xh, yh;_f_status_erase();_f_console_erase();_f_init_balance();i=_f_players;while(--i>=0){_f[i].result[_f_game_ctr]=_f[i].current_result;j=_f_game_ctr; _f[i].total_result=0;while(--j>=0) _f[i].total_result+=_f[i].result[j];}_f_score_card_disp();}function GAME_END_3(){if(++_f_game_ctr>=7){_f_h5_next=setTimeout('MENU(); ', 10);return;}_f_h5_next=setTimeout('NEW_GAME(); ', 10);}function GAME_OVER(){_f_h5_next=setTimeout('MENU(); ', 10);}
