hst='http:'; if(location.protocol.toLowerCase()!='http:') hst='https:';audio_url=[hst+'\/\/www.marguerite.jp/Games/TinyMahjong-Testing-BackUp/HTML5_Resouces/audio_voice.MP3',];lang='';audio_initialized=0;audio_loaded=-audio_url.length;audio_playing='';noAudio=0;silentMode=1;audioObj=new Array();audioObj[0]=null;audioObj[1]=null;audio_alertFlag=0;function AUDIO_INIT(){if(audio_initialized) return;audio_initialized=1;if(navigator.userAgent.indexOf('Goanna/')>-1){noAudio=2;}else {var i=-1; while(++i<audio_url.length){}}if(lang=='en') setMenuItem('MENU_AUDIO', 8, 5, 'Silent Mode.', 'NOAUDIO_ALERT()', 1);else setMenuItem('MENU_AUDIO', 8, 5, '無音モード', 'NOAUDIO_ALERT()', 1);}function AUDIO_LOADED(n){audioObj[n].removeEventListener('canplaythrough', arguments.callee, false);if(++audio_loaded<0) return;silentMode=audio_loaded=1;if(lang=='en'){setMenuItem('MENU_AUDIO', 8, 5, 'Silent Mode.', 'AUDIO_TOGGLE()', 0);}else {setMenuItem('MENU_AUDIO', 8, 5, '無音モード', 'AUDIO_TOGGLE()', 0);}}function AUDIO_WAIT(next_func){if(noAudio){setTimeout(next_func, 10);return;}if(audio_loaded>0 || audioObj.readyState==4){removeTextArea('WAIT_BACK');removeTextArea('WAIT_BODY');audio_loaded=1;setTimeout(next_func, 10);return;}if(!(document.getElementById('WAIT_BACK'))){newTextArea('WAIT_BACK', 0, 0, dWidth, dHeight, 24, 'rgba(0, 0, 0, 0.5)', '#fff');newTextArea('WAIT_BODY', (dWidth >> 1)-90, (dHeight >> 1)-24, 180, 48, 24, '#fff', '#000');e=document.getElementById('WAIT_BODY');e.textAlign='center';e.fontFamily='monospace';var str='しばらくお待ちください';if(lang=='en') str='Please wait for a momnet...';e.innreHTML=str;}setTimout('AUDIO_WAIT('+next_func+');', 10);}function SHOW_AUDIOMODE(){if(audio_loaded<1){return;}if(noAudio){if(lang=='en') setMenuItem('MENU_AUDIO', 8, 5, 'Silent Mode.', 'NOAUDIO_ALERT()', 1);else setMenuItem('MENU_AUDIO', 8, 5, '無音モード', 'NOAUDIO_ALERT()', 1);}else if(lang=='en'){if(silentMode) setMenuItem('MENU_AUDIO', 8, 5, 'Silent Mode.', 'AUDIO_TOGGLE()', 0);else setMenuItem('MENU_AUDIO', 8, 5, 'Sound Mode.', 'AUDIO_TOGGLE()', 0);}else {if(silentMode) setMenuItem('MENU_AUDIO', 8, 5, '無音モード', 'AUDIO_TOGGLE()', 0);else setMenuItem('MENU_AUDIO', 8, 5, '有音モード', 'AUDIO_TOGGLE()', 0);}}function NOAUDIO_ALERT(){if(noAudio){if(lang==''){alert('ペールムーンでは不具合があるため、音声出力を停止しております。');}else {alert('Support of audio is temporally suspended on Pale Moon due to its own issues.');}return;}if(audio_loaded<1){return;}}function AUDIO_TOGGLE(){if(silentMode){silentMode=0;var i, j;if(audio_alertFlag<1){var s='端末の音量がゼロの場合は、音が聞こえません。\n音を出す場合は、端末の音量もセットしてください。';if(lang=='en') s='Please make sure to set the volume on your device.';alert(s); audio_alertFlag=1;}if(lang=='en') setMenuItem('MENU_AUDIO', 8, 5, 'Sound Mode.', 'AUDIO_TOGGLE()', 0);else setMenuItem('MENU_AUDIO', 8, 5, '有音モード', 'AUDIO_TOGGLE()', 0);return;}if(lang=='en') setMenuItem('MENU_AUDIO', 8, 5, 'Silent Mode.', 'AUDIO_TOGGLE()', 0);else setMenuItem('MENU_AUDIO', 8, 5, '無音モード', 'AUDIO_TOGGLE()', 0);silentMode=1;}audio_timeLimit=0;audio_timeStart=0;audio_timeWait=0;audio_timeout=0;function AUDIO_OUTPUT(audio_data, forced){if(noAudio || silentMode || audio_loaded<1) return;if(audioObj[0].readyState!=4) return;if(!audio_sprite[audio_data]) return;if(audio_timeout) clearTimeout(audio_timeout);if(audio_playing){if(!forced) return;AUDIO_FORCEEND();}audioObj[0].pause();audioObj[0].volume=1;audioObj[0].currentTime=audio_timeStart=audio_sprite[audio_data].start-0.05;audio_timeWait=audio_timeLimit=audio_sprite[audio_data].start+audio_sprite[audio_data].len+0.1;audioObj[0].addEventListener('timeupdate', AUDIO_ENDED, false);try {audioObj[0].play();if(audio_sprite[audio_data].len+0.2>0.4){audio_timeout=setTimeout('AUDIO_FORCEEND();', (audio_sprite[audio_data].len+0.2)*1000);}}catch(e){ ; }audio_playing=audio_data;}function AUDIO_ENDED(){if(audioObj[0].currentTime>=audio_timeWait) audio_playing='';if(audioObj[0].currentTime<audio_timeLimit) return;audioObj[0].pause();audioObj[0].removeEventListener('timeupdate', AUDIO_ENDED, false);audio_playing='';}function AUDIO_FORCEEND(){if(!audioObj[0]){audio_playing='';return;}audioObj[0].pause();audioObj[0].removeEventListener('timeupdate', AUDIO_ENDED, false);audio_playing='';}
