t_XOO=new Array(40);t_OXO=new Array(40);t_OOX=new Array(40);t_OOO=new Array(40);function a0031(){var i=0;t_XOO=new Array(40);t_OXO=new Array(40);t_OOX=new Array(40);t_OOO=new Array(40);i=40; while(--i>-1){t_OOO[i]=t_XOO[i]=t_OXO[i]=t_OOX[i]=0;if(vZpt[i]>2 || (vZpt[i]>1 && pai_tbl[i]>0)) t_OOO[i]=3;else if(vZpt[i]>1 || (vZpt[i]>0 && pai_tbl[i]>0)) t_OOO[i]=1;if(i>30) continue;if(vZpt[i]+pai_tbl[i  ]>0 && vZpt[i+1]>0 && vZpt[i+2]>0) t_XOO[i]+=Math.min(vZpt[i+1], vZpt[i+2]);if(vZpt[i]>0 && vZpt[i+1]+pai_tbl[i+1]>0 && vZpt[i+2]>0) t_OXO[i]+=Math.min(vZpt[i], vZpt[i+2]);if(vZpt[i]>0 && vZpt[i+1]>0 && vZpt[i+2]+pai_tbl[i+2]>0) t_OOX[i]+=Math.min(vZpt[i], vZpt[i+1]);}}function a0032(jia, ej){var i=40, j, k, l, x, y, z, ii, kk;var p;var f;var zipai=sanyuan=yaojiu=green=red_so=fenghuaxueyue=gang=0;var suit=[0, 0, 0, 0];var b=[0, 0, 0, 0];var aa=new Array(40);var rv=new Array(40);var ke=new Array(40), ke_ctr=0;var sh=new Array(40), sh_ctr=0;var gang=0;var dr=0;var MM=4;if(gameMode==GAMEMODE_TAIWAN) MM=5;try{if(jia==ej || (f=fc[ej])<2) return(0);i=40; while(--i>-1){t_dgr[i]=1000; aa[i]=0;}if(players==2) xiajia=1;else  if(players==4){if((i=jia+1)>3) i=9;if(i==ej) xiajia=1;}k=-5; i=f; while(--i>=0){k+=5;x=fl[ej][k] % 50;suit[Math.floor(x / 10)]++;if(fl[ej][k+3] || fl[ej][k+4]) gang++;if(x==(fl[ej][k+1] % 50)){ke[ke_ctr++]=i;if(x>30){if(x>34) sanyuan++;zipai++; yaojiu++;}else if(x % 10==1 || x % 10==9) yaojiu++;if(x==36 || x==3 || (x<10 && !(x & 1))) green++;else if(x==37 || (x<10 && (x & 1))) red_so++;if(x==menfeng[ej] || x==35 || x==11 || x==15) fenghuaxueyue++;}else {x=Math.floor((x+(fl[ej][k+1] % 50)+(fl[ej][k+2] % 50)) / 3)-1;sh[sh_ctr++]=x;if(x % 10==1 || x % 10==7) yaojiu++;if(x==2) green++;}}dr=0;if(gameMode==GAMEMODE_REACH || gameMode==GAMEMODE_REACH3P || gameMode==GAMEMODE_SAMMA || gameMode==GAMEMODE_BOO || gameMode==GAMEMODE_EASTERN_BOO || gameMode==GAMEMODE_BEINUKI){i=doraCtr; while(--i>-1) aa[dora[i] % 50]++;k=-f*5; while(--k>=0){p=fl[ej][k] % 50;if(p<1 || p>37) continue;dr+=aa[p];if(fl[ej][k] % 100<40) continue;dr++;}}if(sanyuan>2){ yaku+=256; fan+=256; }else if(sanyuan>1){if(fc[ej]>MM-1){k=0x000f0000; if(gameMode==GAMEMODE_GUOJI) k=0x0fff0000;i=34; while(++i<38){if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){t_dgr[i] |= k;}}}else {i=34; while(++i<38){if(t_OOO[i]>1){k=0x0fff0000; if(fsp[ej][i]>0 && gameMode!=GAMEMODE_GUOJI) k=0x002000;t_dgr[i] |= k;continue;}if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){k=0x000f0000; if(gameMode==GAMEMODE_GUOJI) k=0x0fff0000;t_dgr[i] |= k;}}}}j=zipai-sanyuan;if(j>3){ yaku+=256; fan+=256; }else if(j>1){if(fc[ej]>MM-1){if(k>2){k=0x0fff0000;i=30; while(++i<35){if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){t_dgr[i] |= k;}}}}else {i=30; while(++i<35){if(t_OOO[i]>1){k=0x0fff0000; if(fsp[ej][i]>0 && gameMode!=GAMEMODE_GUOJI) k=0x002000;t_dgr[i] |= k;continue;}if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){k=0x0fff0000;t_dgr[i] |= k;}}}}if(zipai==yaojiu && zipai>=f && f>2){if(fc[ej]>MM-1){k=0x0fff0000;i=30; while(++i<38){if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){t_dgr[i] |= k;}}}else {i=30; while(++i<38){if(t_OOO[i]>1){k=0x0fff0000; if(fsp[ej][i]>0 && gameMode!=GAMEMODE_GUOJI) k=0x002000;t_dgr[i] |= k;continue;}if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){k=0x0fff0000;t_dgr[i] |= k;}}}}if(f==yaojiu && yaojiu>1){kk=0x0fff0000;k=f; j=0; i=-10; while((i+=10)<30){if(t_OOO[i+1]>1) ++k;else if(j<1 && t_OOO[i+1]) ++j;if(t_OOO[i+9]>1) ++k;else if(j<1 && t_OOO[i+9]) ++j;}if(k+j<MM) kk=0x000f0000;if(gameMode!=GAMEMODE_BEINUKI){i=30; while(++i<38){if(t_OOO[i+1]>1) ++k;else if(j<1 && t_OOO[i+1]) ++j;}}if(zipai<1 && sh_ctr<1 && k+j>MM-1){if(fc[ej]>MM-1){k=kk;j=-10; while((j+=10)<30){i=j+1;if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){t_dgr[i] |= k;}i=j+9;if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){t_dgr[i] |= k;}}if(gameMode!=GAMEMODE_BEINUKI){k=0x000f0000;i=30; while(++i<38){if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){t_dgr[i] |= k;}}}}else {j=-10; while((j+=10)<30){i=j+1;if(t_OOO[i]>1){k=kk; if(fsp[ej][i]>0 && gameMode!=GAMEMODE_GUOJI) k=0x002000;t_dgr[i] |= k;continue;}if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){k=kk;t_dgr[i] |= k;}i=j+9;if(t_OOO[i]>1){k=kk; if(fsp[ej][i]>0 && gameMode!=GAMEMODE_GUOJI) k=0x002000;t_dgr[i] |= k;continue;}if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){k=kk;t_dgr[i] |= k;}}if(gameMode!=GAMEMODE_BEINUKI){i=30; while(++i<38){if(t_OOO[i]>1){k=0x000f0000; if(fsp[ej][i]>0 && gameMode!=GAMEMODE_GUOJI) k=0x002000;t_dgr[i] |= k;continue;}if(t_OOO[i] && (fsp[ej][i]<1 || gameMode==GAMEMODE_GUOJI)){k=0x000f0000;t_dgr[i] |= k;}}}}}if((j=4-f)>0 && gameMode!=GAMEMODE_BOO){k=j; i=-10; while((i+=10)<30){x=vZpt[i+1]; y=vZpt[i+2]; z=vZpt[i+3];l=pai_tbl[i+1];if(x>0 && y>0 && z>0){w=Math.min(x, Math.min(y, z));x-=w; y-=w; z-=w; j-=w;}if(x>0 && y>0 && z<1 && pai_tbl[i+3]>0){j--;}else if(x>0 && y<1 && z>0 && pai_tbl[i+2]>0){j--;}else if(x<1 && y>0 && z>0 && l>0){j--; l--;}if(x>2){ j--; k--; }else if(x>1){k--;if(l>0) j--;}else if(x>0 && l>0) k--;x=vZpt[i+7]; y=vZpt[i+8]; z=vZpt[i+9];l=pai_tbl[i+9];if(x>0 && y>0 && z>0){w=Math.min(x, Math.min(y, z));x-=w; y-=w; z-=w; j-=w;}if(x>0 && y>0 && z<1 && l>0){j--; l--;}else if(x>0 && y<1 && z>0 && pai_tbl[i+8]>0){j--;}else if(x<1 && y>0 && z>0 && pai_tbl[i+7]>0){j--;}if(z>2){ j--; k--; }else if(z>1){k--;if(l>0) j--;}else if(z>0 && l>0) k--;}z=zipai; if(k>-1 || j>0) z=1;i=30; while(++i<38){if(vZpt[i]>2){ --j; --k; }else if(vZpt[i]>1){--k;if(pai_tbl[i]>0) --j;}else if(vZpt[i]>0){if(pai_tbl[i]>0) --k;}}if(k<0 && j<1){j=1; if(z<1) j++;i=-10; while((i+=10)<30){if(t_XOO[i+1]+t_OOO[i+1]) t_dgr[i+1] |= 0x001000;if(t_OXO[i+1]) t_dgr[i+2] |= 0x001000;if(t_OOX[i+1]) t_dgr[i+3] |= 0x001000;if(t_XOO[i+7]) t_dgr[i+7] |= 0x001000;if(t_OXO[i+7]) t_dgr[i+8] |= 0x001000;if(t_OOX[i+7]+t_OOO[i+9]) t_dgr[i+9] |= 0x001000;}j=1; if(f>3) j=0;i=30; while(++i<38){if(t_OOO[i]>j) t_dgr[i] |= 0x001000;}}}}if(gameMode!=GAMEMODE_GUOJI && (gameMode!=GAMEMODE_BEINUKI || zipai<1)){z=0; x=-1;if(suit[0]>0){ x=0; ++z; }if(suit[1]>0){ x=10; ++z; }if(suit[2]>0){ x=20; ++z; }b[0]=b[1]=b[2]=b[3]=2;if(gameMode==GAMEMODE_REACH || gameMode==GAMEMODE_REACH3P || gameMode==GAMEMODE_SAMMA || gameMode==GAMEMODE_BOO || gameMode==GAMEMODE_EASTERN_BOO){i=doraCtr; while(--i>-1){j=dora[i] % 50;k=vZpt[j]; if(pai_tbl[j]>0) ++k;if(f>3 && k>2) k=2;else if(f<4 && k>3) k=3;b[j >> 4]+=k;}}if(z<1 && f>2){i=40; while(--i>-1) aa[i]=0;i=0; while(++i<30){if(f<4){if(t_XOO[i]) aa[i]++;if(t_OXO[i]) aa[i+1]++;if(t_OOX[i]) aa[i+2]++;}if(t_OOO[i]) aa[i]++;}i=30; while(--i>-1){if(aa[i]) t_dgr[i] |= 0x001000;}i=30; while(++i<38){if(t_OOO[i]) t_dgr[i] |= 0x004000;}}else if(z==1 && f>1){i=40; while(--i>-1) aa[i]=0;i=x; l=10; while(--l>0){++i;if(f<4){if(t_XOO[i]) aa[i]++;if(t_OXO[i]) aa[i+1]++;if(t_OOX[i]) aa[i+2]++;}if(t_OOO[i]) aa[i]++;}i=x; l=10; while(--l>0){++i;if(aa[i]) t_dgr[i] |= 0x004000;}i=30; while(++i<38){if(t_OOO[i]) t_dgr[i] |= 0x004000;}}}if(gameMode==GAMEMODE_TAIWAN) return(0);if(gameMode!=GAMEMODE_ARSHIAR && gameMode!=GAMEMODE_BOO){if((gang==3 && f==3 && gangCtr==3) ||    (gang==2 && f<4 && gangCtr<3)){m=0x0fff0000; if(gang<3) m=0x004000;i=38; while(--i>-1){if(pai_tbl[i]<2 && vZpt[i]+pai_tbl[i]>3) t_dgr[i] |= m;}}if(f>2 && green>=f){if((j=4-f)>0){var k1=j1=j;x=vZpt[2]; y=vZpt[3]; z=vZpt[4];l=pai_tbl[2]; m=pai_tbl[3]; n=pai_tbl[4];if(x>0 && y>0 && z>0){w=Math.min(x, Math.min(y, z));x-=w; y-=w; z-=w; j1-=w;}if(x>0 && y>0 && z<1 && n>0){--x; --y; --n; --j1;}else if(x>0 && y<1 && z>0 && m>0){--x; --z; --m; --j1;}else if(x<1 && y>0 && z>0 && l>0){--y; --z; --l; --j1;}if(x>2){ --j1; --k1; }else if(x>1){--k1; if(l>0) --j1;}else if(x>0 && l>0) --k1;if(y>2){ --j1; --k1; }else if(y>1){--k1; if(m>0) --j1;}else if(y>0 && m>0) --k1;if(z>2){ --j1; --k1; }else if(z>1){--k1; if(n>0) --j1;}else if(z>0 && n>0) --k1;k=j;x=vZpt[2]; y=vZpt[3]; z=vZpt[4];l=pai_tbl[2]; m=pai_tbl[3]; n=pai_tbl[4];if(x>2){ --j; x-=3; }if(y>2){ --j; y-=3; }if(z>2){ --j; z-=3; }if(x>0 && y>0 && z>0){w=Math.min(x, Math.min(y, z));x-=w; y-=w; z-=w; j-=w;}if(x>0 && y>0 && z<1 && n>0){--x; --y; --n; --j;}else if(x>0 && y<1 && z>0 && m>0){--x; --z; --m; --j;}else if(x<1 && y>0 && z>0 && l>0){--y; --z; --l; --j;}if(x>1){--k; if(l>0) --j;}else if(x>0 && l>0) --k;if(y>1){--k; if(m>0) --j;}else if(y>0 && m>0) --k;if(z>1){--k; if(n>0) --j;}else if(z>0 && n>0) --k;if(j>j1 || (j==j1 && k>k1)){ j=j1; k=k1; }if((z=vZpt[6])>2){ --j; --k; }else if(z>1){--k; if(pai_tbl[6]>0) --j;}else if(z>0 && pai_tbl[6]>0) --k;if((z=vZpt[8])>2){ --j; --k; }else if(z>1){--k; if(pai_tbl[8]>0) --j;}else if(z>0 && pai_tbl[8]>0) --k;if((z=vZpt[36])>2){ --j; --k; }else if(z>1){--k; if(pai_tbl[36]>0) --j;}else if(z>0 && pai_tbl[36]>0) --k;if(k<0 && j<1 && gameMode!=GAMEMODE_ARSHIAR && gameMode!=GAMEMODE_BOO){j=0x4000; if(f>3) j=0x10000;if(t_XOO[2]+t_OOO[2]) t_dgr[2] |= j;if(t_OXO[2]+t_OOO[3]) t_dgr[3] |= j;if(t_OOX[2]+t_OOO[4]) t_dgr[4] |= j;if(t_OOO[6]) t_dgr[6] |= j;if(t_OOO[8]) t_dgr[8] |= j;if(t_OOO[36]) t_dgr[36] |= j;}}else {j=0x10000;if(t_OOO[2]) t_dgr[2] |= j;if(t_OOO[3]) t_dgr[3] |= j;if(t_OOO[4]) t_dgr[4] |= j;if(t_OOO[6]) t_dgr[6] |= j;if(t_OOO[8]) t_dgr[8] |= j;if(t_OOO[36]) t_dgr[36] |= j;}}}i=-1; while(++i<ke_ctr-1){if(ke[i]>ke[i+1]){j=ke[i]; ke[i]=ke[i+1]; ke[i+1]=j;i=-1;}}i=ke[0];if((ke_ctr>2 && i<10 && i+10==ke[1] && (i+20==ke[2] || (ke_ctr>3 && i+20==ke[3]))) ||    (ke_ctr>3 && ke[3]<30 && ke[3]-10==ke[2] && (ke[3]-20==ke[1] || ke[3]-20==i))) ;else if(f>1 && f<4){if(((i<20 && i+10==ke[1]) || (f>2 && (i+10==ke[2] || ((i=ke[1])<20 && i+10==ke[2]))))){if(i<10) i+=20; else i-=10;if(t_OOO[i]>1) t_dgr[i] |= 0x4000;}if((((i=ke[0])<10 && i+20==ke[1]) || (f>2 && (i+20==ke[2] || ((i=ke[1])<10 && i+20==ke[2]))))){if(t_OOO[i+10]>1) t_dgr[i+10] |= 0x4000;}}l=2; m=256;j=0x4000; k=0x10000;if(ke_ctr>3 && i<30 && i+3==ke[3]) ;else if(f==3 && ke[1]<30 && i+2==ke[3]){if(t_OOO[i-1]>1) t_dgr[i-1] |= k;if(t_OOO[i+3]>1) t_dgr[i+3] |= k;}else if(f==3 && ke[1]<30 && i+3==ke[3]){if(i+1==ke[1]){if(t_OOO[i+2]>1) t_dgr[i+2] |= k;if(i & 0x0f>1 && t_OOO[i-1]>1) t_dgr[i-1] |= j;}else {if(t_OOO[i+1]>1) t_dgr[i+1] |= k;if(t_OOO[i+4]>1) t_dgr[i+4] |= j;}}else if(f>1 && f<4){if(((i<30 && i+1==ke[1]) || (f>2 && (i+1==ke[2] || ((i=ke[1])<30 && i+1==ke[2]))))){if(t_OOO[i-1]>1) t_dgr[i-1] |= j;if(t_OOO[i+2]>1) t_dgr[i+2] |= j;}if(((i<30 && i+2==ke[1]) || (f>2 && (i+2==ke[2] || ((i=ke[1])<30 && i+2==ke[2]))))){if(t_OOO[i+1]>1) t_dgr[i+1] |= j;}}i=-1; while(++i<sh_ctr-1){if(sh[i]>sh[i+1]){j=sh[i]; sh[i]=sh[i+1]; sh[i+1]=j;i=-1;}}i=38; while(--i>-1){if(trp[ej][i]>0){ t_dgr[i]=0; continue; }if(t_dgr[i]>0x000fff) t_dgr[i] &= 0xfffff000;}i=40; while(--i>-1){vDanger[i]+=t_dgr[i];}if(dr>2 || gang>2 || zipai>2) return(2);return(0);} catch(e){};return(0);}function a0051(jia){var i, j, k, l, m, n, p=paiBuff % 50, l1, l2;var mq_buff=mq[jia];var fc_buff=fc[jia];var te_buff=new Array(20); i=20; while(--i>-1) te_buff[i]=te[jia][i];var exp=new Object();exp.mxf=0;exp.mxfc=0;exp.avf=0;exp.opr=[0,0];var cdpp=[0,0];cdpp[0]=cdp[0];cdpp[1]=cdp[1];i=40; while(--i>=0) vZpt[i]=zp[jia][i];i=20; while(--i>-1) te_buff[i]=te[jia][i];exp.flag=texp[jia].flag;exp.mxf=texp[jia].mxf;exp.mxfc=texp[jia].mxfc;exp.avf=texp[jia].avf;exp.cmd=-1;exp.flag=a0053(jia, exp);exp.cmd=-1;if(fc[jia]>2 && exp.flag) return(-1);if(gangOK && (mq[jia] || fc[jia]>0)){mq_buff=mq[jia];fc_buff=fc[jia];k=fc[jia]*5; j=0; n=0;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;fl[jia][k++]=l;if(++n==3) break;}}if(n==3){fl[jia][k++]=paiBuff;fl[jia][k]=0;mq[jia]=1; fc[jia]++;if(a0053(jia, exp)) exp.cmd=21;}mq[jia]=mq_buff;fc[jia]=fc_buff;i=20; while(--i>-1) te[jia][i]=te_buff[i];}if(pengOK){mq_buff=mq[jia];fc_buff=fc[jia];k=fc[jia]*5; j=0; n=0;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){exp.opr[n]=l;te[jia][i]=0;fl[jia][k++]=l;if(++n>1) break;}}if(n<2){i=20; while(--i>-1){l=te[jia][i] % 50;if(p==l){exp.opr[n]=l;te[jia][i]=0;fl[jia][k++]=l;if(++n>1) break;}}}if(n==2){fl[jia][k++]=paiBuff;fl[jia][k++]=0;fl[jia][k]=0;mq[jia]=1; fc[jia]++;cdp[0]=paiBuff % 50;if(a0052(jia, exp)) exp.cmd=22;}mq[jia]=mq_buff;fc[jia]=fc_buff;i=20; while(--i>-1) te[jia][i]=te_buff[i];}if(chiOK){k=fc[jia]*5; j=0;if(paiBuff % 10<8){mq_buff=mq[jia];fc_buff=fc[jia];k=fc[jia]*5; l1=l2=-1;p=(paiBuff % 50)+1;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){te[jia][i]=0;l1=l;break;}}if(l1<1){i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;l1=l;break;}}}p=(paiBuff % 50)+2;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){te[jia][i]=0;l2=l;break;}}if(l2<1){i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;l2=l;break;}}}if(l1>0 && l2>0){k=fc[jia]*5;fl[jia][k++]=l1;fl[jia][k++]=l2;fl[jia][k++]=paiBuff;fl[jia][k++]=0;fl[jia][k]=0;mq[jia]=1; fc[jia]++;cdp[0]=cdp[1]=0; if(fc[jia]<4) cdp[0]=paiBuff % 50;if(a0052(jia, exp)){exp.cmd=23;exp.opr[0]=l1;exp.opr[1]=l2;}}mq[jia]=mq_buff;fc[jia]=fc_buff;i=20; while(--i>-1) te[jia][i]=te_buff[i];}k=fc[jia]*5; j=0;if(paiBuff % 10>1 && paiBuff % 10<9){mq_buff=mq[jia];fc_buff=fc[jia];k=fc[jia]*5; l1=l2=-1;p=(paiBuff % 50)-1;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){te[jia][i]=0;l1=l;break;}}if(l1<1){i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;l1=l;break;}}}p=(paiBuff % 50)+1;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){te[jia][i]=0;l2=l;break;}}if(l2<1){i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;l2=l;break;}}}if(l1>0 && l2>0){k=fc[jia]*5;fl[jia][k++]=l1;fl[jia][k++]=l2;fl[jia][k++]=paiBuff;fl[jia][k++]=0;fl[jia][k]=0;mq[jia]=1; fc[jia]++;cdp[0]=cdp[1]=0; if(fc[jia]<4) cdp[0]=paiBuff % 50;if(a0052(jia, exp)){exp.cmd=23;exp.opr[0]=l1;exp.opr[1]=l2;}}mq[jia]=mq_buff;fc[jia]=fc_buff;i=20; while(--i>-1) te[jia][i]=te_buff[i];}k=0; j=0;if(paiBuff % 10>2){mq_buff=mq[jia];fc_buff=fc[jia];k=fc[jia]*5; l1=l2=-1;p=(paiBuff % 50)-2;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){te[jia][i]=0;l1=l;break;}}if(l1<1){i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;l1=l;break;}}}p=(paiBuff % 50)-1;i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(l>50 && p==m){te[jia][i]=0;l2=l;break;}}if(l2<1){i=20; while(--i>-1){l=te[jia][i] % 100; m=l % 50;if(p==m){te[jia][i]=0;l2=l;break;}}}if(l1>0 && l2>0){k=fc[jia]*5;fl[jia][k++]=l1;fl[jia][k++]=l2;fl[jia][k++]=paiBuff;fl[jia][k++]=0;fl[jia][k]=0;mq[jia]=1; fc[jia]++;cdp[0]=cdp[1]=0; if(fc[jia]<4) cdp[0]=paiBuff % 50;if(a0052(jia, exp)){exp.cmd=23;exp.opr[0]=l1;exp.opr[1]=l2;}}mq[jia]=mq_buff;fc[jia]=fc_buff;i=20; while(--i>-1) te[jia][i]=te_buff[i];}}k=fc[jia]*5;fl[jia][k]=fl[jia][k+1]=fl[jia][k+2]=fl[jia][k+3]=fl[jia][k+4]=0;cdp[0]=cdpp[0]; cdp[1]=cdpp[1];if((i=exp.cmd)>-1){cmmd[jia]=i;if(i==22 || i==23){cmp[0][jia]=exp.opr[0]; cmp[1][jia]=exp.opr[1];}}return(i);}function a0052(jia, exp2){var exp=new Object();var i;var mpch, yfa, flag=0;var hp, dpp, dp, dp2, dpf=new Array(40);i=40; while(--i>-1) dpf[i]=0;var ls=lingshang; lingshang=0;var zz=zampai; zampai=100;var rf=ronghe; ronghe=0;dpp=20; while(--dpp>-1){dp=te[jia][dpp];if((dp2=dp % 50)<1 || dp2>37) continue;if(cdp[0]==dp) continue;if(dpf[dp2]) continue;te[jia][dpp]=0; dpf[dp2]++;if(a0111(jia)){exp.mxf=exp2.mxf; mpch=yfa=0;exp.mxfc=exp2.mxfc;hp=0; while(++hp<38){if(hp % 10==0) continue;if(mpcd[hp]<1 && mpcd[Math.floor(hp / 10)*10]<1) continue;te[jia][15]=hp; helepai=hp;if(YAKU_JUDGE(jia)){if(vZpt[hp]>0){mpch++;if(fan>=exp.mxf){if(fan>exp.mxf){exp.mxf=fan; exp.mxfc=0;}exp.mxfc++;}}}else if(keishikiHele){if(mq[jia]){if(fan==1 && fc[jia]<4){fan=8+ndr_ctr[jia]; yfa+=fan;if(fan>=exp.mxf){if(fan>exp.mxf){exp.mxf=fan; exp.mxfc=0;}exp.mxfc++;}}else if(fan>3 && fc[jia]==4 && !(fl[jia][4]+fl[jia][9]+fl[jia][14]+fl[jia][19])){fan+=4+ndr_ctr[jia]; yfa+=fan;if(fan>=exp.mxf){if(fan>exp.mxf){exp.mxf=fan; exp.mxfc=0;}exp.mxfc++;}}}}te[jia][15]=0;}if(mpch>0){i=Math.floor(yfa / mpch);if(exp.mxf>exp2.mxf || (exp.mxf==exp2.mxf && (exp.mxfc>exp2.mxfc || (exp.mxfc==exp2.mxfc || i>exp2.avf)))){exp2.mxf=exp.mxf; exp2.mxfc=exp.mxfc; exp2.avf=i;flag=1;}}}te[jia][dpp]=dp;}zampai=zz;lingshang=ls;ronghe=rf;return(flag);}function a0053(jia, exp2){var exp=new Object();var i;var mpch, yfa;var hp;var ls=lingshang; lingshang=0;var zz=zampai; zampai=100;var rf=ronghe; ronghe=0;exp.mxf=exp2.mxf;exp.mxfc=exp2.mxfc;hp=0; while(++hp<38){if(hp % 10==0) continue;te[jia][15]=hp; helepai=hp;if(YAKU_JUDGE(jia)){if(vZpt[hp]>0){if(fan>=exp.mxf){if(fan>exp.mxf){exp.mxf=fan; exp.mxfc=0;}exp.mxfc++;}}}else if(keishikiHele){if(mq[jia]){if(fan==1 && fc[jia]<4){fan=8+ndr_ctr[jia];if(fan>=exp.mxf){if(fan>exp.mxf){exp.mxf=fan; exp.mxfc=0;}exp.mxfc++;}}else if(fan>3 && fc[jia]==4 && !(fl[jia][4]+fl[jia][9]+fl[jia][14]+fl[jia][19])){fan+=4+ndr_ctr[jia];if(fan>=exp.mxf){if(fan>exp.mxf){exp.mxf=fan; exp.mxfc=0;}exp.mxfc++;}}}}}zampai=zz;lingshang=ls;ronghe=rf;te[jia][15]=0;if(exp.mxfc<1) return(0);i=Math.floor(yfa / mpch);if(exp.mxf>exp2.mxf || (exp.mxf==exp2.mxf && (exp.mxfc>exp2.mxfc || (exp.mxfc==exp2.mxfc || i>exp2.avf)))){exp2.mxf=exp.mxf; exp2.mxfc=exp.mxfc; exp2.avf=i;}return(1);}function a0091(jia){var i, j, k, l, pxt;nrykfan[jia]=rm_2naki[jia]=0;i=40; while(--i>-1) wants[jia][i]=required[jia][i]=vYaku[i]=vXOO[i]=vOXO[i]=vOOX[i]=vOOO[i]=vOOOO[i]=0;var nxt=a0000(jia, 1);if(gameMode==GAMEMODE_BOO || gameMode==GAMEMODE_ARSHIAR){if(a0129(jia, nxt)>0) ;else if(gameMode==GAMEMODE_BOO && a0130(jia, nxt)) ;else {if(a0120(jia));else if(a0121(jia));else if(a0122(jia)){a0080(jia, 0, -1, nxt);}else if(a0080(jia, 0, -1, nxt)){a0125(jia);}else if(a0125(jia));if(gameMode==GAMEMODE_BOO){ a0112(jia);a0126(jia);}else {a0126(jia);if((zhuangjia==jia || sc[jia]>200) && fc[jia]<3) a0112(jia);}}}else if(gameMode==GAMEMODE_BEINUKI){if(a0129(jia, nxt)>0) ;else if(a0130(jia, nxt)) ;else {SHUPAI_MOVE(jia);l=ndr_ctr[jia]; i=doraCtr; while(--i>-1){if(pai_tbl[dora[i]]>1) l++;}if(l>0) a0112(jia);}}else if(gameMode==GAMEMODE_GUOJI){ if(a0132(jia, nxt)>0) ;else if(a0133(jia, nxt)>0) ;else if(a0131(jia, nxt)) ;else if(a0120(jia)) ;else if(a0121(jia)) ;else if(a0122(jia)) ;else if(a0127(jia)) ;else if(a0128(jia)){a0123(jia); a0124(jia, 0, -1);}else if(a0172(jia, 0, -1)) ;else if(a0124(jia, 0, -1)) ;else if(a0135(jia)) ;}else if(gameMode==GAMEMODE_TAIWAN){a0112(jia);}else {a0114(jia);if((p=a0129(jia, nxt))>0) ;else if(a0130(jia, nxt)) ;else {if(a0120(jia));else if(a0121(jia)){a0172(jia, 0, -1);a0126(jia);}else if(a0122(jia)){a0080(jia, 0, -1);if(a0125(jia));else a0126(jia);}else if(a0123(jia)){if(a0172(jia, 0, -1));else a0080(jia, 0, -1);a0126(jia);a0175(jia);i=40; while(--i>-1){if(vYaku[i]>0x0100) break;}if(i<0){i=40; while(--i>-1) vXOO[i]=vOXO[i]=vOOX[i]=vOOO[i]=vOOOO[i]=0;}}else if(a0172(jia, 0, -1)){if(a0125(jia));else a0126(jia);a0175(jia);}else if(a0080(jia, 0, -1)){if(a0125(jia));else a0126(jia);a0175(jia);i=40; while(--i>-1){if(vYaku[i]>0x0100) break;}if(i<0){i=40; while(--i>-1) vXOO[i]=vOXO[i]=vOOX[i]=vOOO[i]=vOOOO[i]=0;}}else if(a0126(jia)){a0175(jia);}else if(a0125(jia)){a0175(jia);}}k=-5; l=0; i=fc[jia]; while(--i>-1){k+=5;if((j=fl[jia][k] % 50)!=fl[jia][k+1] % 50) continue;if(j>34){ l++; continue; }if(j==zhuangfeng[0] || j==zhuangfeng[1]) l++;if(j==menfeng[jia]) l++;}if(shibari<=l) a0112(jia);}SHUPAI_MOVE(jia);j=30; while(++j<38){if(required[jia][j]<1) required[jia][j]=-32768;if(vOOOO[j]>vOOO[j] && pai_tbl[j]==3) wants[jia][j]=5;else if(vOOO[j]>0 && pai_tbl[j]>1) wants[jia][j]=4;}k=vXOO[21]; if(k>0 && pai_tbl[22]>0 && pai_tbl[23]>0) wants[jia][21]=1;if(k<vOOO[21] && pai_tbl[21]>1){k=vOOO[21]; wants[jia][21]=4;}if(k<vOOOO[21] && pai_tbl[21]==3) wants[jia][21]=5;k=vOOX[29]; if(k>0 && pai_tbl[27]>0 && pai_tbl[28]>0) wants[jia][29]=3;if(k<vOOO[29] && pai_tbl[29]>1){k=vOOO[29]; wants[jia][29]=4;}if(k<vOOOO[29] && pai_tbl[29]==3) wants[jia][29]=5;k=vXOO[11]; if(k>0 && pai_tbl[12]>0 && pai_tbl[13]>0) wants[jia][11]=1;if(k<vOOO[11] && pai_tbl[11]>1){k=vOOO[11]; wants[jia][11]=4;}if(k<vOOOO[11] && pai_tbl[11]==3) wants[jia][11]=5;k=vOOX[19]; if(k>0 && pai_tbl[17]>0 && pai_tbl[18]>0) wants[jia][19]=3;if(k<vOOO[19] && pai_tbl[19]>1){k=vOOO[19]; wants[jia][19]=4;}if(k<vOOOO[19] && pai_tbl[19]==3) wants[jia][19]=5;k=vXOO[ 1]; if(k>0 && pai_tbl[ 2]>0 && pai_tbl[ 3]>0) wants[jia][ 1]=1;if(k<vOOO[ 1] && pai_tbl[ 1]>1){k=vOOO[ 1]; wants[jia][ 1]=4;}if(k<vOOOO[ 1] && pai_tbl[ 1]==3) wants[jia][ 1]=5;k=vOOX[ 9]; if(k>0 && pai_tbl[ 7]>0 && pai_tbl[ 8]>0) wants[jia][ 9]=3;if(k<vOOO[ 9] && pai_tbl[ 9]>1){k=vOOO[ 9]; wants[jia][ 9]=4;}if(k<vOOOO[ 9] && pai_tbl[ 9]==3) wants[jia][ 9]=5;k=vXOO[22]; if(k>0 && pai_tbl[23]>0 && pai_tbl[24]>0) wants[jia][22]=1;if(k<vOXO[22] && pai_tbl[21]>0 && pai_tbl[23]>0){k=vOXO[22]; wants[jia][22]=2;}if(k<vOOO[22] && pai_tbl[22]>1){k=vOOO[22]; wants[jia][22]=4;}if(k<vOOOO[22] && pai_tbl[22]==3) wants[jia][22]=5;k=vOOX[28]; if(k>0 && pai_tbl[26]>0 && pai_tbl[27]>0) wants[jia][28]=3;if(k<vOXO[28] && pai_tbl[27]>0 && pai_tbl[28+1]>0){k=vOXO[28]; wants[jia][28]=2;}if(k<vOOO[28] && pai_tbl[28]>1){k=vOOO[28]; wants[jia][28]=4;}if(k<vOOOO[28] && pai_tbl[28]==3) wants[jia][28]=5;k=vXOO[12]; if(k>0 && pai_tbl[13]>0 && pai_tbl[14]>0) wants[jia][12]=1;if(k<vOXO[12] && pai_tbl[11]>0 && pai_tbl[13]>0){k=vOXO[12]; wants[jia][12]=2;}if(k<vOOO[12] && pai_tbl[12]>1){k=vOOO[12]; wants[jia][12]=4;}if(k<vOOOO[12] && pai_tbl[12]==3) wants[jia][12]=5;k=vOOX[18]; if(k>0 && pai_tbl[16]>0 && pai_tbl[17]>0) wants[jia][18]=3;if(k<vOXO[18] && pai_tbl[17]>0 && pai_tbl[18+1]>0){k=vOXO[18]; wants[jia][18]=2;}if(k<vOOO[18] && pai_tbl[18]>1){k=vOOO[18]; wants[jia][18]=4;}if(k<vOOOO[18] && pai_tbl[18]==3) wants[jia][18]=5;k=vXOO[ 2]; if(k>0 && pai_tbl[ 3]>0 && pai_tbl[ 4]>0) wants[jia][ 2]=1;if(k<vOXO[ 2] && pai_tbl[ 1]>0 && pai_tbl[ 3]>0){k=vOXO[ 2]; wants[jia][ 2]=2;}if(k<vOOO[ 2] && pai_tbl[ 2]>1){k=vOOO[ 2]; wants[jia][ 2]=4;}if(k<vOOOO[ 2] && pai_tbl[ 2]==3) wants[jia][ 2]=5;k=vOOX[ 8]; if(k>0 && pai_tbl[ 6]>0 && pai_tbl[ 7]>0) wants[jia][ 8]=3;if(k<vOXO[ 8] && pai_tbl[ 7]>0 && pai_tbl[ 8+1]>0){k=vOXO[ 8]; wants[jia][ 8]=2;}if(k<vOOO[ 8] && pai_tbl[ 8]>1){k=vOOO[ 8]; wants[jia][ 8]=4;}if(k<vOOOO[ 8] && pai_tbl[ 8]==3) wants[jia][ 8]=5;i=3; while(--i>0){k=vXOO[25+i]; if(k>0 && pai_tbl[26+i]>0 && pai_tbl[27+i]>0) wants[jia][25+i]=1;if(k<vOXO[25+i] && pai_tbl[24+i]>0 && pai_tbl[26+i]>0){k=vOXO[25+i]; wants[jia][25+i]=2;}if(k<vOOX[25+i] && pai_tbl[23+i]>0 && pai_tbl[24+i]>0){k=vOOX[25+i]; wants[jia][25+i]=3;}if(k<vOOO[25+i] && pai_tbl[25+i]>1){k=vOOO[25+i]; wants[jia][25+i]=4;}if(k<vOOOO[25+i] && pai_tbl[25+i]==3) wants[jia][25+i]=5;k=vOOX[25-i]; if(k>0 && pai_tbl[23-i]>0 && pai_tbl[24-i]>0) wants[jia][25-i]=3;if(k<vOXO[25-i] && pai_tbl[24-i]>0 && pai_tbl[26-i]>0){k=vOXO[25-i]; wants[jia][25-i]=2;}if(k<vXOO[25-i] && pai_tbl[26-i]>0 && pai_tbl[27-i]>0){k=vXOO[25-i]; wants[jia][25-i]=1;}if(k<vOOO[25-i] && pai_tbl[25-i]>1){k=vOOO[25-i]; wants[jia][25-i]=4;}if(k<vOOOO[25-i] && pai_tbl[25-i]==3) wants[jia][25-i]=5;k=vXOO[15+i]; if(k>0 && pai_tbl[16+i]>0 && pai_tbl[17+i]>0) wants[jia][15+i]=1;if(k<vOXO[15+i] && pai_tbl[14+i]>0 && pai_tbl[16+i]>0){k=vOXO[15+i]; wants[jia][15+i]=2;}if(k<vOOX[15+i] && pai_tbl[13+i]>0 && pai_tbl[14+i]>0){k=vOOX[15+i]; wants[jia][15+i]=3;}if(k<vOOO[15+i] && pai_tbl[15+i]>1){k=vOOO[15+i]; wants[jia][15+i]=4;}if(k<vOOOO[15+i] && pai_tbl[15+i]==3) wants[jia][15+i]=5;k=vOOX[15-i]; if(k>0 && pai_tbl[13-i]>0 && pai_tbl[14-i]>0) wants[jia][15-i]=3;if(k<vOXO[15-i] && pai_tbl[14-i]>0 && pai_tbl[16-i]>0){k=vOXO[15-i]; wants[jia][15-i]=2;}if(k<vXOO[15-i] && pai_tbl[16-i]>0 && pai_tbl[17-i]>0){k=vXOO[15-i]; wants[jia][15-i]=1;}if(k<vOOO[15-i] && pai_tbl[15-i]>1){k=vOOO[15-i]; wants[jia][15-i]=4;}if(k<vOOOO[15-i] && pai_tbl[15-i]==3) wants[jia][15-i]=5;k=vXOO[ 5+i]; if(k>0 && pai_tbl[ 6+i]>0 && pai_tbl[ 7+i]>0) wants[jia][ 5+i]=1;if(k<vOXO[ 5+i] && pai_tbl[ 4+i]>0 && pai_tbl[ 6+i]>0){k=vOXO[ 5+i]; wants[jia][ 5+i]=2;}if(k<vOOX[ 5+i] && pai_tbl[ 3+i]>0 && pai_tbl[ 4+i]>0){k=vOOX[ 5+i]; wants[jia][ 5+i]=3;}if(k<vOOO[ 5+i] && pai_tbl[ 5+i]>1){k=vOOO[ 5+i]; wants[jia][ 5+i]=4;}if(k<vOOOO[ 5+i] && pai_tbl[ 5+i]==3) wants[jia][ 5+i]=5;k=vOOX[ 5-i]; if(k>0 && pai_tbl[ 3-i]>0 && pai_tbl[ 4-i]>0) wants[jia][ 5-i]=3;if(k<vOXO[ 5-i] && pai_tbl[ 4-i]>0 && pai_tbl[ 6-i]>0){k=vOXO[ 5-i]; wants[jia][ 5-i]=2;}if(k<vXOO[ 5-i] && pai_tbl[ 6-i]>0 && pai_tbl[ 7-i]>0){k=vXOO[ 5-i]; wants[jia][ 5-i]=1;}if(k<vOOO[ 5-i] && pai_tbl[ 5-i]>1){k=vOOO[ 5-i]; wants[jia][ 5-i]=4;}if(k<vOOOO[ 5-i] && pai_tbl[ 5-i]==3) wants[jia][ 5-i]=5;}k=vXOO[25]; if(k>0 && pai_tbl[26]>0 && pai_tbl[27]>0) wants[jia][25]=1;if(k<vOXO[25] && pai_tbl[24]>0 && pai_tbl[26]>0){k=vOXO[25]; wants[jia][25]=2;}if(k<vOOX[25] && pai_tbl[23]>0 && pai_tbl[24]>0){k=vOOX[25]; wants[jia][25]=3;}if(k<vOOO[25] && pai_tbl[25]>1){k=vOOO[25]; wants[jia][25]=4;}if(k<vOOOO[25] && pai_tbl[25]==3) wants[jia][25]=5;k=vXOO[15]; if(k>0 && pai_tbl[16]>0 && pai_tbl[17]>0) wants[jia][15]=1;if(k<vOXO[15] && pai_tbl[14]>0 && pai_tbl[16]>0){k=vOXO[15]; wants[jia][15]=2;}if(k<vOOX[15] && pai_tbl[13]>0 && pai_tbl[14]>0){k=vOOX[15]; wants[jia][15]=3;}if(k<vOOO[15] && pai_tbl[15]>1){k=vOOO[15]; wants[jia][15]=4;}if(k<vOOOO[15] && pai_tbl[15]==3) wants[jia][15]=5;k=vXOO[ 5]; if(k>0 && pai_tbl[ 6]>0 && pai_tbl[ 7]>0 && players!=3) wants[jia][ 5]=1;if(k<vOXO[ 5] && pai_tbl[ 4]>0 && pai_tbl[ 6]>0){k=vOXO[ 5];if(players!=3) wants[jia][ 5]=2;}if(k<vOOX[ 5] && pai_tbl[ 3]>0 && pai_tbl[ 4]>0){k=vOOX[ 5];if(players!=3) wants[jia][ 5]=3;}if(k<vOOO[ 5] && pai_tbl[ 5]>1){k=vOOO[ 5];wants[jia][ 5]=4;}if(k<vOOOO[ 5] && pai_tbl[ 5]==3) wants[jia][ 5]=5;}function a0090(){var i, j, k, l, m, jia, q, x, y;rank[0]=rank[1]=rank[2]=rank[3]=-1;topJia=-1; q=-1; y=-1;while(++q<players){p=-65535; x=-1; j=jijia; i=players;do {if(rank[j]<0){if(sc[j]>p){x=j; p=sc[j];}}if(++j>=players) j=0;} while(j!=jijia);if(x<0) break;rank[x]=q;if(q==0) topJia=x;}jia=players; while(--jia>-1){t_jd[jia].rsv=0;t_jd[jia].duanyaojiu=0;t_jd[jia].suit=-1;if(gameMode==GAMEMODE_BOO || gameMode==GAMEMODE_ARSHIAR){t_strategy[jia]=T_STRATEGY_NORMAL;if(gameMode==GAMEMODE_BOO){if(jia==zhuangjia) t_strategy[jia]=T_STRATEGY_QUICK;else {i=players; while(--i>-1){if(sc[i]>sc[jia]) break;}if(i<0) t_strategy[jia]=T_STRATEGY_QUICK;else {var sq=players, smx=-99999; i=players; while(--i>-1){if(sc[i]<200){--sq;if(sc[i]>smx) smx=sc[i];}}j=24+tsumi*30;if(sc[jia]>200 && sq<3 && (smx<j || sc[jia]>=400-j || kyoku>players+players-2)) t_strategy[jia]=T_STRATEGY_QUICK;if(sc[jia]<200 && sc[jia]>=200-j) t_strategy[jia]=T_STRATEGY_QUICK;if(smx-sc[jia]>=j) t_strategy[jia]=T_STRATEGY_QUICK;}}}}else if(gameMode==GAMEMODE_BEINUKI){t_strategy[jia]=T_STRATEGY_QUICK;}else if(gameMode==GAMEMODE_GUOJI){t_strategy[jia]=T_STRATEGY_HEAVY;}else if(gameMode==GAMEMODE_TAIWAN){t_strategy[jia]=T_STRATEGY_QUICK;}else {t_strategy[jia]=T_STRATEGY_NORMAL;i=players; k=-1; l=sc[0]; while(--i>-1){if(k<sc[i]) k=sc[i];}l=200; m=300;if(lang=='en'){ l=m=0; }if(gameMode==GAMEMODE_SAMMA){ l=20; m=50; }if(gameMode==GAMEMODE_EASTERN_BOO){ l=80; m=80; }if((k>m && k<=sc[jia]) || (jia==zhuangjia && shibari<2)) t_strategy[jia]=T_STRATEGY_QUICK;else if(sc[jia]<l) t_strategy[jia]=T_STRATEGY_HEAVY;}}}
