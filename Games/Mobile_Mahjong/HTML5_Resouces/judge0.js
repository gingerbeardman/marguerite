gm_lipai_sw=0;gm_lipai_pattern1=[ 0,  0, 10, 20, 10, 20];gm_lipai_pattern2=[10, 20,  0,  0, 20, 10];gm_lipai_pattern3=[20, 10, 20, 10,  0,  0];gm_lipai_default=new Array();function LIPAI(jia){var i, j, p14;if(gameMode==GAMEMODE_GUOJI && !jia && fc[jia]<2){var p=new Array();var buff=new Array();var gm_ptn=[0, 0, 0, 0, 0, 0];var l, m, r1=r2=r3=-1;i=30; while(--i>=0) p[i]=0;i=20; while(--i>=0) buff[i]=te[0][i] % 100;i=15;while(--i>0){if((j=te[jia][i] % 50)<1 || j>29) continue;p[j]++;}l=m=-1; i=0;if(p[ 1]>0) i++; if(p[ 4]>0) i++; if(p[ 7]>0) i++; j=i;if(p[12]>0) i++; if(p[15]>0) i++; if(p[18]>0) i++;if(p[23]>0) i++; if(p[26]>0) i++; if(p[29]>0) i++;if(i>l){ l=i; r1= 0; r2=10; r3=20; }gm_ptn[0]=i;i=j;if(p[13]>0) i++; if(p[16]>0) i++; if(p[19]>0) i++;if(p[22]>0) i++; if(p[25]>0) i++; if(p[28]>0) i++;if(i>l){ l=i; r1= 0; r2=20; r3=10; }gm_ptn[1]=i;i=0;if(p[ 2]>0) i++; if(p[ 5]>0) i++; if(p[ 8]>0) i++; j=i;if(p[11]>0) i++; if(p[14]>0) i++; if(p[17]>0) i++;if(p[23]>0) i++; if(p[26]>0) i++; if(p[29]>0) i++;if(i>l){ l=i; r1=10; r2= 0; r3=20; }gm_ptn[2]=i;i=j;if(p[13]>0) i++; if(p[16]>0) i++; if(p[19]>0) i++;if(p[21]>0) i++; if(p[24]>0) i++; if(p[27]>0) i++;if(i>l){ l=i; r1=20; r2= 0; r3=10; }gm_ptn[3]=i;i=0;if(p[ 3]>0) i++; if(p[ 6]>0) i++; if(p[ 9]>0) i++; j=i;if(p[11]>0) i++; if(p[14]>0) i++; if(p[17]>0) i++;if(p[22]>0) i++; if(p[25]>0) i++; if(p[28]>0) i++;if(i>l){ l=i; r1=10; r2=20; r3= 0; }gm_ptn[4]=i;i=j;if(p[12]>0) i++; if(p[15]>0) i++; if(p[18]>0) i++;if(p[21]>0) i++; if(p[24]>0) i++; if(p[27]>0) i++;if(i>l){ l=i; r1=20; r2=10; r3= 0; }gm_ptn[5]=i;if(gm_lipai_sw){do {if(++gm_lipaiMode>5){ gm_lipaiMode=-1; break; }} while(gm_ptn[gm_lipaiMode]<l);}r1=r2=r3=-1;if(gm_lipaiMode>-1){r1=gm_lipai_pattern1[gm_lipaiMode];r2=gm_lipai_pattern2[gm_lipaiMode];r3=gm_lipai_pattern3[gm_lipaiMode];}else if(gm_lipai_default[19]){i=16; while(--i>0) te[0][i]=gm_lipai_default[i];return;}if(r1>-1){l=fc[jia]*3+1;j=r1+1; i=3; while(--i>=0){k=14; while(--k>0){if((buff[k] % 50)!=j) continue;buff[k]+=1000;break;}j+=3;}j=r2+2; i=3; while(--i>=0){k=14; while(--k>0){if((buff[k] % 50)!=j) continue;buff[k]+=1100;break;}j+=3;}j=r3+3; i=3; while(--i>=0){k=14; while(--k>0){if((buff[k] % 50)!=j) continue;buff[k]+=1200;break;}j+=3;}i=14; while(--i>=0){if(buff[i]>0 && buff[i]<100) buff[i]+=4000;}i=0; while(++i<13){if(buff[i]>buff[i+1]){j=buff[i]; buff[i]=buff[i+1]; buff[i+1]=j;i=0;}}i=0; while(++i<14) te[0][i]=buff[i] % 100;return;}}if(gameMode==GAMEMODE_TAIWAN){p14=te[jia][14]; te[jia][14]=0;i=20; while(--i>=0) pai_tbl[i]=0;i=17; j=14; while(--j>0){if((k=te[jia][j])!=0) pai_tbl[--i]=k;}if((k=te[jia][19])!=0) pai_tbl[--i]=k;if((k=te[jia][18])!=0) pai_tbl[--i]=k;if((k=te[jia][17])!=0) pai_tbl[--i]=k;if(!jia || opened[jia]){j=0; while(++j<16){k1=pai_tbl[j];k2=pai_tbl[j+1];l1=k1 % 50;l2=k2 % 50;if(l1>l2 || (l1==l2 && k1>k2)){pai_tbl[j]=k2;pai_tbl[j+1]=k1;j=0;}}}te[jia][0]=0;te[jia][17]=pai_tbl[1];te[jia][18]=pai_tbl[2];te[jia][19]=pai_tbl[3];i=0; while(++i<14) te[jia][i]=pai_tbl[i+3];te[jia][14]=p14;return;}i=20; while(--i>=0) pai_tbl[i]=0;i=14; j=14;while(--j>0){if((k=te[jia][j])!=0){--i;pai_tbl[i]=k;}}i=14; while(--i>=0) te[jia][i]=pai_tbl[i];if(!jia || opened[jia]){j=0; while(++j<13){k1=te[jia][j];k2=te[jia][j+1];l1=k1 % 50;l2=k2 % 50;if(l1>l2 || (l1==l2 && k1>k2)){te[jia][j]=k2;te[jia][j+1]=k1;j=0;}}}te[jia][17]=te[jia][18]=te[jia][19]=0;}function SHUPAI_MOVE(jia){i=40; while(--i>=0) pai_tbl[i]=0;i=20; while(--i>0){ j=te[jia][i] % 50; if(j) pai_tbl[j]++; }}function MENZI_1(jia){SHUPAI_MOVE(jia);i=5; while(--i>=0) mz[i]=0;i=0; j=-1; k=0; l=0; ok=1;while(++i<38){if(!l && i<30 && pai_tbl[i] && pai_tbl[i+1] && pai_tbl[i+2]){--pai_tbl[i]; --pai_tbl[i+1]; --pai_tbl[i+2];mz[++j]=i+1;--i; continue;}if(l<2 && !k && pai_tbl[i]>1){pai_tbl[i]-=2;++j;mz[j]=i+200;k=i;}if(pai_tbl[i]>2){pai_tbl[i]-=3;mz[++j]=i+100;}if(!pai_tbl[i]){ l=0; continue; }for(;;){if(j<0) return(0);i=mz[j--];if(i<100){pai_tbl[i-1]++; pai_tbl[i]++; pai_tbl[i+1]++;l=1; i-=2; break;}if(i>200){i-=200;pai_tbl[i]+=2;l=2; k=0; --i; break;}i-=100;pai_tbl[i]+=3;}}if(!k) return(0);return(1);}function MENZI_2(jia){SHUPAI_MOVE(jia);i=5; while(--i>=0) mz[i]=0;i=38; j=-1; k=0; l=0; ok=1;while(--i>0){if(!l && i>2 && i<30 && pai_tbl[i] && pai_tbl[i-1] && pai_tbl[i-2]){--pai_tbl[i]; --pai_tbl[i-1]; --pai_tbl[i-2];mz[++j]=i-1;++i; continue;}if(l<2 && !k && pai_tbl[i]>1){pai_tbl[i]-=2;++j;mz[j]=i+200;k=i;}if(pai_tbl[i]>2){pai_tbl[i]-=3;mz[++j]=i+100;}if(!pai_tbl[i]){ l=0; continue; }for(;;){if(j<0) return(0);i=mz[j--];if(i<100){pai_tbl[i-1]++; pai_tbl[i]++; pai_tbl[i+1]++;l=1; i+=2; break;}if(i>200){i-=200;pai_tbl[i]+=2;l=2; k=0; ++i; break;}i-=100;pai_tbl[i]+=3;}}if(!k) return(0);return(1);}function MENZI_3(jia){SHUPAI_MOVE(jia);i=5; while(--i>=0){ mz[i]=0; }i=0; j=-1; k=0; l=0; ok=1;while(++i<38){if(!l && pai_tbl[i]>2){pai_tbl[i]-=3;mz[++j]=i+100;}if(l<2 && !k && pai_tbl[i]>1){pai_tbl[i]-=2;mz[++j]=i+200;k=i;}if(i<30 && pai_tbl[i] && pai_tbl[i+1] && pai_tbl[i+2]){--pai_tbl[i]; --pai_tbl[i+1]; --pai_tbl[i+2];mz[++j]=i+1;--i; continue;}if(!pai_tbl[i]){ l=0; continue; }for(;;){if(j<0) return(0);i=mz[j--];if(i<200 && i>100){i-=100;pai_tbl[i]+=3;l=1; --i; break;}if(i>200){i-=200;pai_tbl[i]+=2;l=2; k=0; --i; break;}pai_tbl[i-1]++; pai_tbl[i]++; pai_tbl[i+1]++;}}if(!k) return(0);return(1);}function QIDUIZI(jia){if(gameMode==GAMEMODE_ARSHIAR && !rule.arshiar_qiduizi) return(0);SHUPAI_MOVE(jia);i=5; while(--i>=0) mz[i]=0;i=38; j=0; ok=1;while(--i>0){k=pai_tbl[i];if(k==2){ ++j; continue; }if(k){ ok=0; break; }}if(j!=7) return(0);return(1);}function GUOSHIWUSHUANG(jia){SHUPAI_MOVE(jia);shisanbuta=0;if(pai_tbl[1]*pai_tbl[9]*pai_tbl[11]*pai_tbl[19]*pai_tbl[21]*pai_tbl[29]*pai_tbl[31]*pai_tbl[32]*pai_tbl[33]*pai_tbl[34]*pai_tbl[35]*pai_tbl[36]*pai_tbl[37]==2) return(1);if(yixun || ronghe) return(0);i=38; j=0; while(--i>0){if(pai_tbl[i]>2) return(0);if(pai_tbl[i]==2){if(j) return(0);j=1;}}if(j<1) return(0);i=0; while(++i<8){if(pai_tbl[i]<1) continue;if(pai_tbl[i+1]>0 || pai_tbl[i+2]>0) return(0);}if(pai_tbl[8]>0 && pai_tbl[9]>0) return(0);i=10; while(++i<18){if(pai_tbl[i]<1) continue;if(pai_tbl[i+1]>0 || pai_tbl[i+2]>0) return(0);}if(pai_tbl[18]>0 && pai_tbl[19]>0) return(0);i=20; while(++i<28){if(pai_tbl[i]<1) continue;if(pai_tbl[i+1]>0 || pai_tbl[i+2]>0) return(0);}if(pai_tbl[28]>0 && pai_tbl[29]>0) return(0);if(rule.yaku.shisanbuta) return(0);shisanbuta=1;return(1);}function JIULIANBAODENG(jia){var k;SHUPAI_MOVE(jia);k=10; while(++k<14){if(pai_tbl[k]<2) continue;if(pai_tbl[k+1]==2 && pai_tbl[k+2]==2 && pai_tbl[k+3]==2 && pai_tbl[k+4]==2 && pai_tbl[k+5]==2 && pai_tbl[k+6]==2){if(!rule.yaku.daisharin) return(2);return(0);}}k=Math.floor((te[jia][1] % 100) / 10)*10;if(k>20) return(0);if(pai_tbl[k+1]+pai_tbl[k+2]+pai_tbl[k+3]+pai_tbl[k+4]+pai_tbl[k+5]+pai_tbl[k+6]+pai_tbl[k+7]+pai_tbl[k+8]+pai_tbl[k+9]<14) return(0);if(pai_tbl[k+2]*pai_tbl[k+3]*pai_tbl[k+4]*pai_tbl[k+5]*pai_tbl[k+6]*pai_tbl[k+7]*pai_tbl[k+8]<1) return(0);if(pai_tbl[k+1]>2 && pai_tbl[k+9]>2) return(1);return(0);}function TINGPAI_JUDGE(jia){i=40; while(--i>=0){ pai_tbl[i]=0; }i=20; while(--i>=0){ pai_tbl[te[jia][i] % 50]++; }mp_ctr[jia]=0;i=5; while(--i>=0){ gp[jia][i]=0; }i=38; j=0; while(--i>0){if(pai_tbl[i]==3){gp[jia][j++]=i;}}ft[jia]=mp_ctr[jia]=0;te[jia][15]=0;while(++te[jia][15]<38){if(te[jia][15]==10 || te[jia][15]==20 || te[jia][15]==30) ++te[jia][15];if(GUOSHIWUSHUANG(jia) && !shisanbuta){mp[jia][mp_ctr[jia]++]=te[jia][15];}else {if(gameMode!=GAMEMODE_GUOJI){j=0; i=15; while(--i>0){if((te[jia][i] % 50)==te[jia][15]) j++;}if(gameMode==GAMEMODE_TAIWAN){i=20; while(--i>15){if((te[jia][i] % 50)==te[jia][15]) j++;}}i=fc[jia]*5; while(--i>-1){if((fl[jia][i] % 50)==te[jia][15]) j++;}if(j>3) continue;}if(MENZI_1(jia)){j=te[jia][15];mp[jia][mp_ctr[jia]++]=j;if(fsp[jia][j]) ft[jia]=1;i=4; while(--i>=0){j=gp[jia][i];if(!j) continue;j+=100;k=5;while(--k>=0){if(mz[k]==j) break;}if(k<0) gp[jia][i]=0;}MENZI_2(jia);i=4; while(--i>=0){j=gp[jia][i];if(!j) continue;j+=100;k=5;while(--k>=0){if(mz[k]==j) break;}if(k<0) gp[jia][i]=0;}}else {if(QIDUIZI(jia)){j=te[jia][15];mp[jia][mp_ctr[jia]++]=j;if(fsp[jia][j]) ft[jia]=1;}}}}te[jia][15]=0;}function TINGPAI_JUDGE2(jia, r_declare){j_tmpi[jia]=0;j_txpi[jia]=0;j_tmpf[jia]=0;TINGPAI_JUDGE(jia);if(mp_ctr[jia]<1) return(0);j_tmpi[jia]=0xffff;j_tmpf[jia]=j_txpi[jia]=-1;var rflag=reach[jia];var iflag=ippatsu[jia];var lingshang2=lingshang;var qianggang2=qianggang;var zampai2=zampai;var ronghe2=ronghe;var helepai2=helepai;var i, j;ippatsu[jia]=0;if(r_declare){reach[jia]=1;if(!yixun) reach[jia]=2;}var yixun2=yixun;yixun=1;ippatsu[jia]=0;lingshang=qianggang=0;zampai=1; ronghe=1;i=mp_ctr[jia]; while(--i>-1){helepai=te[jia][15]=mp[jia][i];YAKU_JUDGE(jia);if(yf_req<j_tmpi[jia]) j_tmpi[jia]=yf_req;if(yf_req>j_txpi[jia]) j_txpi[jia]=yf_req;if(fan<j_tmpf[jia]) j_tmpf[jia]=fan;}te[jia][15]=0;helepai=helepai2;ronghe=ronghe2;zampai=zampai2;yixun=yixun2;qianggang=qianggang2;lingshang=lingshang2;reach[jia]=rflag;ippatsu[jia]=iflag;if(gameMode!=GAMEMODE_REACH && gameMode!=GAMEMODE_SAMMA) return(1);if(rule.kuitan_sakizuke<2)  return(1);if(j_tmpi[jia]>0xfffe) j_tmpi[jia]=0;if(j_tmpf[jia]<1) j_tmpf[jia]=0;return(j_tmpi[jia]);}function GET_SCORECARD(){var jia, i, j, k, t, top, blw;var ranked=[0,0,0,0];var ja=[-1,-1,-1,-1];var sb=[-63386,-65536,-65536,-65536];var tp=[0,0,0,0];boo_scbd=[0, 0, 0, 0];if(gameMode==GAMEMODE_PENGLI){k=players; while(--k>=0){sctt[k]+=(scre[k]=sc[k]);}return;}if(gameMode==GAMEMODE_REACH){if(lang=='en'){var uma=[300, 100, -100, -300], cr=0, l;ja=[-1,-1,-1,-1];for(;;){k=0; t=0; i=4; while(--i>-1){if(ja[i]>-1) continue;if(t<1 || k<sc[i]){ k=sc[i]; t=1; continue; }if(k==sc[i]) t++;}if(t<1) break;i=-1; j=0; l=cr; while(++i<t){j+=uma[cr++];}j=Math.floor(j / t);i=4; while(--i>-1){if(ja[i]>-1) continue;if(sc[i]==k){scre[i]=(sc[i]+j)*100;ja[i]=l;}}}i=4; while(--i>-1) sctt[i]+=scre[i];}else {jia=jijia; t=-65536; top=-1;do {if(--jia<0) jia=players-1;if(t<=sc[jia]){t=sc[jia]; top=jia;}} while(jia!=jijia);t=0; j=players; while(--j>-1){if(j!=top){i=scre[j]=Math.round((sc[j]-300)/10);t-=i;}}scre[top]=t;if(rule.yakitori){k=15; if(players==4) k=10;j=players; while(--j>-1){if(!yktr[j]) continue;shugi[j]-=30;i=players; while(--i>-1){if(i==j) continue;shugi[i]+=k;}}}j=players; while(--j>-1){if((rule.goshugi || rule.yakitori) && lang=='') scre[j]+=shugi[j];sctt[j]+=scre[j];}}return;}if(gameMode==GAMEMODE_SAMMA || gameMode==GAMEMODE_BEINUKI){jia=jijia; t=-65536; top=-1;do {if(--jia<0) jia=2;if(t<=sc[jia]){t=sc[jia]; top=jia;}} while(jia!=jijia);t=0; j=players; while(--j>-1){if(j!=top){i=scre[j]=sc[j]-50;t-=i;}}scre[top]=t;j=players; while(--j>-1){sctt[j]+=scre[j];if(!rule.goshugi || lang!='') continue;k=shugi_name.length; while(--k>-1) sctt[j]+=shugi[j];}return;}if(gameMode==GAMEMODE_BOO || gameMode==GAMEMODE_EASTERN_BOO){var sb=200; if(gameMode==GAMEMODE_EASTERN_BOO) sb=80;if(boo_yakuman){k=10; if(gameMode==GAMEMODE_EASTERN_BOO) k=20;scre=[0, 0, 0, 0];j=players; while(--j>-1){if(j!=jiaBuff){scre[jiaBuff]+=k;scre[j]-=k;}}boo_scbd[jiaBuff]=-3;}else {jia=players; t=sb; top=-1; blw=0;while(--jia>-1){if(sc[jia]<sb) blw++;if(t<=sc[jia]){t=sc[jia]; top=jia;}}scre=[0, 0, 0, 0];if(blw<1) return;k=10; if(blw<3) k=5;if(blw<2) k=3;j=players; while(--j>-1){if(j!=top && sc[j]<sb){scre[top]+=k;scre[j]-=k;}}boo_scbd[top]=-3;}j=players; while(--j>-1){sctt[j]+=scre[j]+boo_scbd[j];}return;}if(gameMode==GAMEMODE_ARSHIAR){j=players; while(--j>-1) sctt[j]+=(scre[j]=(sc[j]-200));return;}if(gameMode==GAMEMODE_GUOJI){k=0;for(;;){i=-65536; j=-1; jia=players; while(--jia>=0){if(ranked[jia]) continue;if(i<sc[jia]){ i=sc[jia]; j=jia; }}if(j<0) break;ranked[j]=1;ja[k]=j; sb[k]=i;k++;}tp=[40, 20, 10, 0];if(sb[0]==sb[3]) tp=[15, 15, 15, 15];else if(sb[0]==sb[2]) tp=[20, 20, 20, 0];else if(sb[1]==sb[3]) tp=[40, 10, 10, 10];else {if(sb[0]==sb[1]){ tp[0]=tp[1]=30;if(sb[2]==sb[3]) tp[2]=tp[3]=5;}else if(sb[1]==sb[2]) tp[1]=tp[2]=15;else if(sb[2]==sb[3]) tp[2]=tp[3]=5;}while(--k>=0){j=ja[k];scre[j]=tp[k];sctt[j]+=scre[j];}return;}if(gameMode==GAMEMODE_TAIWAN){k=players; while(--k>=0){sctt[k]+=(scre[k]=sc[k]);}return;}}function GM_SEAT_CHANGE(){var p, q, i, j;if(kyoku==4 || kyoku==12){j=  sc[1];   sc[1]=  sc[3];   sc[3]=j;j=sctt[1]; sctt[1]=sctt[3]; sctt[3]=j;j=scre[1]; scre[1]=scre[3]; scre[3]=j;j= cID[1];  cID[1]= cID[3];  cID[3]=j;j=vjia[1]; vjia[1]=vjia[3]; vjia[3]=j;switch(jijia){case 0: i=3; break;case 1: i=2; break;case 2: i=1; break;case 3: i=0; break;}zhuangjia=jijia=i;return;}if(kyoku!=8) return;if(jijia==0){i= cID[2];  cID[2]=  cID[3];  cID[3]=i;i=  sc[2];   sc[2]=   sc[3];   sc[3]=i;i=sctt[2]; sctt[2]= sctt[3]; sctt[3]=i;i=scre[2]; scre[2]= scre[3]; scre[3]=i;i=vjia[2]; vjia[2]= vjia[3]; vjia[3]=i;zhuangjia=jijia=2;return;}if(jijia==1){i= cID[1]; cID[1]=  cID[3]; cID[3]=  cID[2]; cID[2]=i;i=  sc[1];  sc[1]=   sc[3];  sc[3]=   sc[2];  sc[2]=i;i= sctt[1];sctt[1]= sctt[3];sctt[3]= sctt[2];sctt[2]=i;i= scre[1];scre[1]= scre[3];scre[3]= scre[2];scre[2]=i;i= vjia[1];vjia[1]= vjia[3];vjia[3]= vjia[2];vjia[2]=i;zhuangjia=jijia=0;return;}if(jijia==2){i= cID[1]; cID[1]=  cID[2]; cID[2]=  cID[3]; cID[3]=i;i=  sc[1];  sc[1]=   sc[2];  sc[2]=   sc[3];  sc[3]=i;i=sctt[1];sctt[1]= sctt[2];sctt[2]= sctt[3];sctt[3]=i;i=scre[1];scre[1]= scre[2];scre[2]= scre[3];scre[3]=i;i=vjia[1];vjia[1]= vjia[2];vjia[2]= vjia[3];vjia[3]=i;zhuangjia=jijia=3;return;}i= cID[2];   cID[2]=  cID[1];   cID[1]=i;i=  sc[2];  sc[2]=   sc[1];   sc[1]=i;i=sctt[2];sctt[2]= sctt[1]; sctt[1]=i;i=scre[2];scre[2]= scre[1]; scre[1]=i;i=vjia[2];vjia[2]= vjia[1]; vjia[1]=i;zhuangjia=jijia=1;return;}renhe_flag=0;yj_qiduizi=0;function YAKU_JUDGE(jia){var duy=0;pay0=pay1=pay2=0;keishikiHele=0;dundiao=0;yakutbl_ctr=yakuman_tbl_ctr=0;fu=fan=0;babao=-1;gx=0;yf_req=0;yakustatus_fu='';yakustatus_fan='';yakustatus_mgn='';yakustatus_pts='';fdat[jia].fudi=0;fdat[jia].menzi=0;fdat[jia].machi=0;fdat[jia].machi_name='';fdat[jia].mohe=0;fdat[jia].mohe_note='';fdat[jia].kui_pinghe=0;fdat[jia].dat=[0,0,0,0,0,0];fdat[jia].te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];fdat[jia].arshiar_qinyise=0;boo_yakuman=0;yj_qiduizi=0;if(gameMode==GAMEMODE_BEINUKI){var i=BEINUKI_YAKU_JUDGE(jia);return(i);}if(gameMode==GAMEMODE_TAIWAN){var i=TM_YAKU_JUDGE(jia);return(i);}if(gameMode==GAMEMODE_GUOJI){var i=GM_YAKU_JUDGE(jia);return(i);}if(gameMode==GAMEMODE_BOO || gameMode==GAMEMODE_ARSHIAR){var i=BOO_YAKU_JUDGE(jia);return(i);}var no2beikou=0;var hp=helepai % 50;var anke, gang;var fdat2=new Object();fdat2.dat=[0,0,0,0,0,0];fdat2.te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];var hb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];var mf;var fan2=0;var no_duidui=0;renhe_flag=0;i=shugi_name.length; while(--i>0) shugi_tbl[i]=0;if(yaojiu_furikiri!=0){if(gameModeSpecial & (GAMEMODE_SPECIAL_AOTENJYO | GAMEMODE_SPECIAL_SEMI_AOTENJYO)){fu=30; fan=5;yakutbl[yakutbl_ctr]='&#20040;九振切';if(lang=='en') yakutbl[yakutbl_ctr]='All Terminals and Honours Discard';yfantbl[yakutbl_ctr++]=5;}else {fu=30; fan=128+5;yakuman_tbl[yakuman_tbl_ctr]='&#20040;九振切';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='All Terminals and Honours Discard';yakuman_tbl_ctr++;}if(fdat_disp){i=20; while(--i>0) fdat[jia].te[i]=te[jia][i];}}else if((SHUPAI_MOVE(jia), helepai_ctr=pai_tbl[hp], GUOSHIWUSHUANG(jia))!=0 &&          (!shisanbuta || lang!='en')){fu=30;if(shisanbuta){if(gameModeSpecial & (GAMEMODE_SPECIAL_AOTENJYO | GAMEMODE_SPECIAL_SEMI_AOTENJYO)){fu=30; fan=5;yakutbl[yakutbl_ctr]='十\三不搭';yfantbl[yakutbl_ctr++]=5;}else {fu=30; fan=128+5;yakuman_tbl[yakuman_tbl_ctr]='十\三不搭';yakuman_tbl_ctr++;}}else {renhe_flag=0;if(!yixun && (!ndr_ctr[jia] || ndr[jia][0]>37)){renhe_flag=-1;i='地和'; j='Blessing of Earth';if(!tianhe){if(!ronghe){ i='天和'; j='Blessing of Heaven'; }}else {if(ronghe) renhe_flag=1;}if(renhe_flag<0){yakuman_tbl[yakuman_tbl_ctr++]=(lang=='en')  ? j : i;fan+=256;}}if(renhe_flag>-1){i=reach[jia];if(i>0){if(i>1){if(lang=='en'){yakutbl[yakutbl_ctr]='Daburu Riichi';yfantbl[yakutbl_ctr++]=2;}else {yakutbl[yakutbl_ctr]='二重立直';yfantbl[yakutbl_ctr++]=2;}fan+=2;}else {yakutbl[yakutbl_ctr]=(lang=='en')  ? 'Riichi' : '立直';yfantbl[yakutbl_ctr++]=i;fan++;}if(ippatsu[jia]){yakutbl[yakutbl_ctr]='一発';if(lang=='en') yakutbl[yakutbl_ctr]='Ippatsu';yfantbl[yakutbl_ctr++]=1;fan++;shugi_tbl[SHUGI_IPT]=1;}}if(!mq[jia] && !ronghe){yakutbl[yakutbl_ctr]='門前摸和';if(lang=='en') yakutbl[yakutbl_ctr]='Fully Concealed Hand';yfantbl[yakutbl_ctr++]=1;fan++;}}else renhe_flag=0;keishikiHele=1;yakuman_tbl[yakuman_tbl_ctr]='国士無双';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='Thirteen Orphans';yakuman_tbl_ctr++;fan=256; gx++;}if(fdat_disp){i=20; while(--i>0) fdat[jia].te[i]=te[jia][i];}yj_qiduizi=1;}else {if(!MENZI_1(jia)){if(!QIDUIZI(jia)) return(0);keishikiHele=1;renhe_flag=0;if(!yixun && (!ndr_ctr[jia] || ndr[jia][0]>37)){renhe_flag=-1;i='地和'; j='Blessing of Earth';if(!tianhe){if(!ronghe){ i='天和'; j='Blessing of Heaven'; }}else {if(ronghe) renhe_flag=1;}if(renhe_flag<0){yakuman_tbl[yakuman_tbl_ctr++]=(lang=='en')  ? j : i;fan+=256;}}if(renhe_flag>-1){i=reach[jia];if(i>0){if(i>1){if(lang=='en'){yakutbl[yakutbl_ctr]='Daburu Riichi';yfantbl[yakutbl_ctr++]=2;}else {yakutbl[yakutbl_ctr]='二重立直';yfantbl[yakutbl_ctr++]=2;}fan+=2;}else {yakutbl[yakutbl_ctr]=(lang=='en')  ? 'Riichi' : '立直';yfantbl[yakutbl_ctr++]=i;fan++;}if(ippatsu[jia]){yakutbl[yakutbl_ctr]='一発';if(lang=='en') yakutbl[yakutbl_ctr]='Ippatsu';yfantbl[yakutbl_ctr++]=1;fan++;shugi_tbl[SHUGI_IPT]=1;}}if(!mq[jia] && !ronghe){yakutbl[yakutbl_ctr]='門前摸和';if(lang=='en') yakutbl[yakutbl_ctr]='Fully Concealed Hand';yfantbl[yakutbl_ctr++]=1;fan++;}}else renhe_flag=0;i=30; j=0;while(++i<38){if(pai_tbl[i]==2) ++j;}if(j==7){yakuman_tbl[yakuman_tbl_ctr]='字一色';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='All Honors';yakuman_tbl_ctr++;fan=256;}else {k=j;if(pai_tbl[9]==2) ++j;if(pai_tbl[19]==2) ++j;if(pai_tbl[29]==2) ++j;if(pai_tbl[21]==2) ++j;if(pai_tbl[11]==2) ++j;if(pai_tbl[1]==2) ++j;if(j==7){yakutbl[yakutbl_ctr]='混老頭';if(lang=='en') yakutbl[yakutbl_ctr]='All Terminals and Honors';yfantbl[yakutbl_ctr++]=2;fan+=2;}else if(!j){yakutbl[yakutbl_ctr]='断&#20040;九';if(lang=='en') yakutbl[yakutbl_ctr]='All Simples';yfantbl[yakutbl_ctr++]=1;fan++;}i=16; while(--i>0){l=te[jia][i];if(l>0 && l<30) break;}l=Math.floor(l / 10)*10; j=k;i=10; while(--i>0){if(pai_tbl[l+i]==2) ++j;}if(j==7){if(k){yakutbl[yakutbl_ctr]='混一色';if(lang=='en') yakutbl[yakutbl_ctr]='Half Flush';yfantbl[yakutbl_ctr++]=3;fan+=3;}else {yakutbl[yakutbl_ctr]='清一色';if(lang=='en') yakutbl[yakutbl_ctr]='Full Flush';yfantbl[yakutbl_ctr++]=6;fan+=6;}}yakutbl[yakutbl_ctr]='七対子';if(lang=='en') yakutbl[yakutbl_ctr]='Seven Pairs';yfantbl[yakutbl_ctr++]=2;fan+=2;}fu=-1;if(fdat_disp){i=20; while(--i>0) hb[i]=te[jia][i];i=0; l=1; while(++i<14){if((j=hb[i]) % 50!=hp){ fdat[jia].te[l++]=j; hb[i]=0; }}m=0; while(++m<14){if(hb[m]>0) fdat[jia].te[l++]=hb[m];}fdat[jia].te[14]=hb[14];}yj_qiduizi=1;}else {keishikiHele=1; mm=0; var kez1=0, dz=0; no2beikou=0;for(;;){renhe_flag=0;if(!yixun && (!ndr_ctr[jia] || ndr[jia][0]>37)){renhe_flag=-1;i='地和'; j='Blessing of Earth';if(!tianhe){if(!ronghe){ i='天和'; j='Blessing of Heaven'; }}else {if(ronghe) renhe_flag=1;}if(renhe_flag<0){yakuman_tbl[yakuman_tbl_ctr++]=(lang=='en')  ? j : i;fan+=256;}}if(renhe_flag>-1){i=reach[jia];if(i>0){if(i>1){if(lang=='en'){yakutbl[yakutbl_ctr]='Daburu Riichi';yfantbl[yakutbl_ctr++]=2;}else {yakutbl[yakutbl_ctr]='二重立直';yfantbl[yakutbl_ctr++]=2;}fan+=2;}else {yakutbl[yakutbl_ctr]=(lang=='en')  ? 'Riichi' : '立直';yfantbl[yakutbl_ctr++]=i;fan++;}if(ippatsu[jia]){yakutbl[yakutbl_ctr]='一発';if(lang=='en') yakutbl[yakutbl_ctr]='Ippatsu';yfantbl[yakutbl_ctr++]=1;fan++;shugi_tbl[SHUGI_IPT]=1;}}if(!mq[jia] && !ronghe){yakutbl[yakutbl_ctr]='門前摸和';if(lang=='en') yakutbl[yakutbl_ctr]='Fully Concealed Hand';yfantbl[yakutbl_ctr++]=1;fan++;}}else renhe_flag=0;fu=0; k=l=anke=0;var pos=-1, pos2=-1;var mnm=mnm2=mnme='';mf=[0, 0, 0, 0, 0, 0];i=5; while(--i>=0){j=mz[i];if(!j) continue;if(j<100){if(hp+1==j){if(j % 10==8){++k;if(pos<0 || mnm=='嵌張'){pos=mz[i]; mnm='辺張'; enme='Edge Wait  ';}}else {++l; pos2=mz[i]; mnm2='両門'; enme='';}continue;}if(hp-1==j){if(j % 10==2){++k;if(pos<0 || mnm=='嵌張'){pos=mz[i]; mnm='辺張'; enme='Edge Wait  ';}}else {++l; pos2=mz[i]; mnm2='両門'; enme='';}continue;}if(hp==j){++k;if(pos<0){pos=mz[i]; mnm='嵌張'; mnme='Closed Wait';}}continue;}if(j>200){j%=50; n=0;if(hp==j){++k; dundiao=1;pos=mz[i]; mnm='単騎'; mnme='Single Wait';}if(j>34) n++;if(j==zhuangfeng[0]) n++;if(j==zhuangfeng[1]) n++;if(j==menfeng[jia]) n++;mf[i]=n+n; fu+=n+n;continue;}j%=50; ++anke;n=2;if(j>30 || j==1 || j==11 || j==21 || j==9 || j==19 || j==29) n=4;if(hp==j && helepai_ctr<4){pos2=mz[i]; mnm2='双ポン'; enme='';if(ronghe){ --anke; n=n / 2; }kez1=1;}mf[i]=n+n;fu+=n+n;}if(!fu && l && !fc[jia] && (ronghe || mo8pinghe || lang!='')){yakutbl[yakutbl_ctr]='平和';if(lang=='en') yakutbl[yakutbl_ctr]='Pinfu';yfantbl[yakutbl_ctr++]=1;fan++;if(!ronghe){fdat[jia].mohe=0;fdat[jia].mohe_note='(平和)';if(lang=='en') fdat[jia].mohe_note='(due to Pinfu)';}fdat[jia].machi_name=mnm2; pos=pos2; dundiao=0;}else {fdat[jia].menzi=fu;if(!ronghe){fdat[jia].mohe=2; fu+=2;}if(k){fu+=2; fdat[jia].machi=2; fdat[jia].machi_name=mnm;if(lang=='en') fdat[jia].machi_name=mnme;}else {fdat[jia].machi_name=mnm2;if(lang=='en') fdat[jia].machi_name='';pos=pos2;}}i=-1; k=-5; gang=0;while(++i<fc[jia]){k+=5;j=fl[jia][k] % 50;l=fl[jia][k+1] % 50;n=fl[jia][k+2] % 50;if(j!=l){mz[4-i]=(j+l+n) / 3;fdat[jia].dat[i]=3500;continue;}mz[4-i]=j+100;n=2;if(fl[jia][k+4]){ n=16; ++anke; ++gang; }if(fl[jia][k+3]){ n=8; ++gang; }if(j>30 || j==1 || j==11 || j==21 || j==9 || j==19 || j==29) n+=n;fu+=n; fdat[jia].dat[i]=3500+n;fdat[jia].menzi+=n;}fdat[jia].fudi=20; fu+=20;if(!mq[jia] && ronghe){fu+=10; fdat[jia].fudi=30;}if(!fan && fu==20){fu=30; fdat[jia].kui_pinghe=10;}fdat[jia].total=fu;if(fdat_disp){i=20; while(--i>0) hb[i]=te[jia][i];i=-1; while(++i<4-fc[jia]){if(mz[i]<=mz[i+1]) continue;j=mz[i]; mz[i]=mz[i+1]; mz[i+1]=j;j=mf[i]; mf[i]=mf[i+1]; mf[i+1]=j;i=-1;}var n=0;k=fc[jia]; l=fc[jia]*3+1;pos2=-1; i=-1; while(++i<5-fc[jia]){if(mz[i]<1) continue;if(pos==(j=mz[i]) && pos2<0){ pos2=i; continue; }if(j<100){j--; m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}j++; m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}j++; m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}fdat[jia].dat[k++]=3000;continue;}if(j<200){j %= 50; m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}fdat[jia].dat[k++]=3000+mf[i];continue;}j %= 50; m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}m=0; while(++m<14){if(hb[m] % 50==j){fdat[jia].te[l++]=hb[m]; hb[m]=0; break;}}fdat[jia].dat[k++]=2000+mf[i];}if(pos2>-1){m=0; while(++m<20){if(m==14) continue;if(hb[m]>0) fdat[jia].te[l++]=hb[m];}fdat[jia].te[14]=hb[14];j=3000; if(mz[pos2]>200) j=2000;fdat[jia].dat[k++]=j+mf[pos2];}}i=-1; while(++i<4){if(mz[i]<=mz[i+1]) continue;j=mz[i]; mz[i]=mz[i+1]; mz[i+1]=j;i=-1;}no_duidui=0;if(mz[0]>130 && mz[4]>230){yakuman_tbl[yakuman_tbl_ctr]='字一色';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='All Honors';yakuman_tbl_ctr++;fan+=256;no_duidui=1;}else {i=5; j=-1; k=0;while(--i>=0){l=mz[i] % 50;if(l>30){ ++k; continue; }if(j<0){ j=Math.floor(l / 10)*10; continue; }if(Math.floor(l / 10)*10!=j) break;}if(i<0){i=5; while(--i>=0){l=mz[i];if(l<100){if(l!=3) break;continue;}l=l % 100;if(l!=36 && l!=8 && l!=6 && l!=4 && l!=3 && l!=2) break;}if(i<0){yakuman_tbl[yakuman_tbl_ctr]='緑一色';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='All Green';yakuman_tbl_ctr++;fan+=256;}else if((i=JIULIANBAODENG(jia))>0 && (i<2 || lang!='en')){j='九蓮宝燈'; if(lang=='en') j='Nine Gates';if(i>1){ j='大車輪'; no2beikou=1; }yakuman_tbl[yakuman_tbl_ctr++]=j;fan=256;if(gameModeSpecial & GAMEMODE_SPECIAL_AOTENJYO) ;else if(fdat_disp){i=6; while(--i>=0) fdat[jia].dat[i]=0;i=20; while(--i>0) fdat[jia].te[i]=te[jia][i];}}else {i=5; while(--i>-1){l=mz[i];if(l<100) break;l=l % 100;if(l!=37 && l!=1 && l!=5 && l!=7 && l!=9) break;}if(i<0 && lang!='en' && !rule.yaku.benikujaku){yakuman_tbl[yakuman_tbl_ctr]='紅孔雀';yakuman_tbl_ctr++;fan+=256;no_duidui=1;}else {i=6; n='清一色';if(lang=='en') n='Full Flush';if(mz[3]>130 || mz[4]>230){i=3; n='混一色';if(lang=='en') n='Half Flush';}if(mq[jia]) --i;yakutbl[yakutbl_ctr]=n;yfantbl[yakutbl_ctr++]=i;fan+=i;}}}i=5; l=m=0;while(--i>=0){j=mz[i];if(j<100){j=j % 10;if(j==2 || j==8) ++l;else ++m;continue;}j=j % 100;if(j>28 || j==1 || j==11 || j==21 || j==9 || j==19) ++l;else ++m;}if(!l){if(!mq[jia] || rule.kuitan_sakizuke>-1){yakutbl[yakutbl_ctr]='断&#20040;九';if(lang=='en') yakutbl[yakutbl_ctr]='All Simples';yfantbl[yakutbl_ctr++]=1;fan++;if(mq[jia] && rule.kuitan_sakizuke) duy=1;}}else if(m==0){if(mz[0]>100){if(k==0){yakuman_tbl[yakuman_tbl_ctr]='清老頭';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='All Terminals';yakuman_tbl_ctr++;fan+=256;no_duidui=1;}else {yakutbl[yakutbl_ctr]='混老頭';if(lang=='en') yakutbl[yakutbl_ctr]='All Terminals and Honors';yfantbl[yakutbl_ctr++]=2;fan+=2;}}else {i=3; n='純全帯&#20040;';if(k!=0){i=2; n='混全帯&#20040;';if(lang=='en') n='Outside Hand';}else if(lang=='en') n='Terminals in All Sets';if(mq[jia]) --i;yakutbl[yakutbl_ctr]=n;yfantbl[yakutbl_ctr++]=i;fan+=i;}}}if(anke==4){yakuman_tbl[yakuman_tbl_ctr]='四暗刻';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='Four Concealed Pungs';yakuman_tbl_ctr++;fan+=256;no_duidui=1;}else if(anke==3){yakutbl[yakutbl_ctr]='三暗刻';if(lang=='en') yakutbl[yakutbl_ctr]='Three Concealed Pungs';yfantbl[yakutbl_ctr++]=2;fan+=2;}if(mz[0]>100 && mz[0]<130 && mz[0]+3==mz[3] && lang!='en' && !rule.yaku.Xlianke){yakuman_tbl[yakuman_tbl_ctr]='四連刻';yakuman_tbl_ctr++;fan+=256;no_duidui=1;if(fc[jia]==4) babao=dja[jia][3];}else if(mz[1]>100 && mz[1]<130 && (mz[0]+2==mz[2] || mz[1]+2==mz[3]) && lang!='en' && rule.yaku.Xlianke<2){yakutbl[yakutbl_ctr]='三連刻';yfantbl[yakutbl_ctr++]=2;fan+=2;}else if((mz[0]+10==mz[1] && mz[0]<110 && (mz[1]+10==mz[2] || mz[1]+10==mz[3])) ||    (mz[3]-10==mz[2] && mz[3]<130 && (mz[2]-10==mz[1] || mz[2]-10==mz[0]))){i=2; j='刻';if(mz[1]<100){j='順'; if(mq[jia]) --i;}if(lang=='en'){j='Triple Pung';if(mz[1]<100) j='Mixed Triple Chow';yakutbl[yakutbl_ctr]=j;}else yakutbl[yakutbl_ctr]='三色同'+j;yfantbl[yakutbl_ctr++]=i;fan+=i;}else if(((mz[0]+3==mz[1] && (mz[0] % 10)==2 && (mz[1]+3==mz[2] || mz[1]+3==mz[3])) ||(mz[3]-3==mz[2] && (mz[3] % 10)==8 && (mz[2]-3==mz[1] || mz[2]-3==mz[0]))) && mz[1]<100){i=2; if(mq[jia]) --i;yakutbl[yakutbl_ctr]='一気通貫';if(lang=='en') yakutbl[yakutbl_ctr]='Pure Straight';yfantbl[yakutbl_ctr++]=i;fan+=i;}shugi_tbl[SHUGI_GANG]=gang;if(gang==4){yakuman_tbl[yakuman_tbl_ctr]='四槓子';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='Four Kongs';yakuman_tbl_ctr++;fan+=256;k=15; while((k-=5)>-1){l=fl[jia][k] % 50;if(l<35) break;}no_duidui=1;if(k>-1) babao=sigangziBabao;}else if(gang==3){yakutbl[yakutbl_ctr]='三槓子';if(lang=='en') yakutbl[yakutbl_ctr]='Three Kongs';yfantbl[yakutbl_ctr++]=2;fan+=2;}n=0; i=-1; k=0; while(++i<5){j=mz[i] % 100;if(j>30 && j<35) ++k;}if(k==4){yakuman_tbl[yakuman_tbl_ctr]='四喜和';if(lang=='en'){yakuman_tbl[yakuman_tbl_ctr]='Four Winds';}yakuman_tbl_ctr++;fan+=256;if((j<30 || j>34) && fc[jia]>3) babao=djia[jia][3];}if(mz[1]==135){yakuman_tbl[yakuman_tbl_ctr]='大三元';if(lang=='en') yakuman_tbl[yakuman_tbl_ctr]='Big Three Dragons';yakuman_tbl_ctr++;fan+=256; ++n;i=-1; j=0; k=-5; while(++i<fc[jia]){k+=5; l=fl[jia][k] % 50;if(l<35) continue;++j; if(j==3) babao=dja[jia][i];}}else if(mz[2]>134 && mz[4]>234){yakutbl[yakutbl_ctr]='小三元';if(lang=='en') yakutbl[yakutbl_ctr]='Little Three Dragons';yfantbl[yakutbl_ctr++]=4;fan+=4; ++n;}i=-1; var me;while(++i<4){j=mz[i]-100; k=0;if(j<0 || j>100) continue;if(j>34 || j==zhuangfeng[0] || j==zhuangfeng[1]) ++k;if(j==menfeng[jia]) k++;if(k==0) continue;if(n!=0 && j>34) continue;if(j==35){m='白板';if(lang=='en') m='White Dragon Pung';}else if(j==36){m='緑発';if(lang=='en') m='Green Dragon Pung';}else if(j==37){m='紅中';if(lang=='en') m='Red Dragon Pung';}else {m='東'; me='East';if(j==32){ m='南'; me='South'; }else if(j==33){ m='西'; me='West'; }else if(j==34){ m='北'; me='North'; }if(k>1){m=m+'連風';if(lang=='en') m=me+' Wind Pung';}else {m=m+'風';if(lang=='en') m=me+' Wind Pung';}}yakutbl[yakutbl_ctr]=m;yfantbl[yakutbl_ctr++]=k;fan+=k;}if(no2beikou) ;else if(mz[0]==mz[3] && lang!='en' && !rule.yaku.yiseXshun){yakuman_tbl[yakuman_tbl_ctr]='一色四順';yakuman_tbl_ctr++;fan+=256;if(fc[jia]==4) babao=djia[jia][3];}else if(mz[0]==mz[1] && mz[2]==mz[3] && mq[jia]==0){if(lang=='en'){yakutbl[yakutbl_ctr]='Twice Pure Double Chows';yfantbl[yakutbl_ctr++]=3;}else {yakutbl[yakutbl_ctr]='両盃口';yfantbl[yakutbl_ctr++]=3;}fan+=3;}else if((mz[0]==mz[2] || mz[1]==mz[3]) && lang!='en' && rule.yaku.yiseXshun<2){i=2; if(mq[jia]) --i;yakutbl[yakutbl_ctr]='一色三順';yfantbl[yakutbl_ctr++]=i;fan+=i;}else if(!mq[jia] && (mz[0]==mz[1] || mz[1]==mz[2] || mz[2]==mz[3])){yakutbl[yakutbl_ctr]='一盃口';if(lang=='en') yakutbl[yakutbl_ctr]='Pure Double Chow';yfantbl[yakutbl_ctr++]=1;fan++;}if(mz[0]>100 && !no_duidui){yakutbl[yakutbl_ctr]='対々和';if(lang=='en') yakutbl[yakutbl_ctr]='All Pungs';yfantbl[yakutbl_ctr++]=2;fan+=2;}if(!mm){i=yakutbl_ctr; while(--i>=0){yakutbl2[i]=yakutbl[i];yfantbl2[i]=yfantbl[i];}yakutbl_ctr2=yakutbl_ctr;i=yakuman_tbl_ctr; while(--i>=0){yakuman_tbl2[i]=yakuman_tbl[i];}yakuman_tbl_ctr2=yakuman_tbl_ctr;fan2=fan;fu2=fu;yakutbl_ctr=yakuman_tbl_ctr=0;fan=fu=0;if(fdat_disp){fdat2.fudi=fdat[jia].fudi;fdat2.menzi=fdat[jia].menzi;fdat2.machi=fdat[jia].machi;fdat2.machi_name=fdat[jia].machi_name;fdat2.mohe=fdat[jia].mohe;fdat2.mohe_note=fdat[jia].mohe_note;fdat2.kui_pinghe=fdat[jia].kui_pinghe;fdat2.total=fdat[jia].total;i=6; while(--i>=0) fdat2.dat[i]=fdat[jia].dat[i];i=20; while(--i>=0) fdat2.te[i]=fdat[jia].te[i];fdat[jia].fudi=0;fdat[jia].menzi=0;fdat[jia].machi=0;fdat[jia].machi_name='';fdat[jia].mohe=0;fdat[jia].mohe_note='';fdat[jia].kui_pinghe=0;fdat[jia].dat=[0,0,0,0,0,0];i=20; while(--i>0) fdat[jia].te[i]=te[jia][i];fdat[jia].total=0;}MENZI_2(jia);++mm; continue;}if(mm<2){if(fan2<fan || (fan2==fan && fu2<fu)){i=yakutbl_ctr; while(--i>=0){yakutbl2[i]=yakutbl[i];yfantbl2[i]=yfantbl[i];}yakutbl_ctr2=yakutbl_ctr;i=yakuman_tbl_ctr; while(--i>=0){yakuman_tbl2[i]=yakuman_tbl[i];}yakuman_tbl_ctr2=yakuman_tbl_ctr;fan2=fan;fu2=fu;if(fdat_disp){fdat2.fudi=fdat[jia].fudi;fdat2.menzi=fdat[jia].menzi;fdat2.machi=fdat[jia].machi;fdat2.machi_name=fdat[jia].machi_name;fdat2.mohe=fdat[jia].mohe;fdat2.mohe_note=fdat[jia].mohe_note;fdat2.kui_pinghe=fdat[jia].kui_pinghe;fdat2.total=fdat[jia].total;i=6; while(--i>=0) fdat2.dat[i]=fdat[jia].dat[i];i=20; while(--i>=0) fdat2.te[i]=fdat[jia].te[i];}}yakutbl_ctr=yakuman_tbl_ctr=0;fan=fu=0;if(fdat_disp){fdat[jia].fudi=0;fdat[jia].menzi=0;fdat[jia].machi=0;fdat[jia].machi_name='';fdat[jia].mohe=0;fdat[jia].mohe_note='';fdat[jia].kui_pinghe=0;fdat[jia].dat=[0,0,0,0,0,0];i=20; while(--i>0) fdat[jia].te[i]=te[jia][i];fdat[jia].total=0;}MENZI_3(jia);++mm; continue;}break;}if(fan2>fan || (fan2==fan && fu2>fu)){i=yakutbl_ctr2; while(--i>=0){yakutbl[i]=yakutbl2[i];yfantbl[i]=yfantbl2[i];}yakutbl_ctr=yakutbl_ctr2;i=yakuman_tbl_ctr2; while(--i>=0){yakuman_tbl[i]=yakuman_tbl2[i];}yakuman_tbl_ctr=yakuman_tbl_ctr2;fan=fan2;fu=fu2;if(fdat_disp){fdat[jia].fudi=fdat2.fudi;fdat[jia].menzi=fdat2.menzi;fdat[jia].machi=fdat2.machi;fdat[jia].machi_name=fdat2.machi_name;fdat[jia].mohe=fdat2.mohe;fdat[jia].mohe_note=fdat2.mohe_note;fdat[jia].kui_pinghe=fdat2.kui_pinghe;fdat[jia].total=fdat2.total;i=6; while(--i>=0) fdat[jia].dat[i]=fdat2.dat[i];i=20; while(--i>=0) fdat[jia].te[i]=fdat2.te[i];}}}}if(mq[jia] && rule.kuitan_sakizuke>1){i=-1; k=-5;while(++i<fc[jia]){k+=5;j=fl[jia][k] % 50;if(fl[jia][k+4]) continue;l=0;if(j>34 || j==zhuangfeng[0] || j==zhuangfeng[1]) ++l;if(j==menfeng[jia]) ++l;if(l<1) n=1;if(!n) continue;duy+=l;}if(n){k=(hp % 50)+100; i=5; while(--i>-1){if(mz[i]==k) break;}if(i>-1){if(hp>34 || hp==zhuangfeng[0] || hp==zhuangfeng[1]) ++duy;if(hp==menfeng[jia]) ++duy;}}}if(lingshang!=0 && ronghe==0){yakutbl[yakutbl_ctr]='嶺上開花';if(lang=='en') yakutbl[yakutbl_ctr]='After a Kong';yfantbl[yakutbl_ctr++]=1;fan++;}else {if(lingshang!=0 && ronghe!=0 && lang!='en' && !rule.yaku.gang_buri){yakutbl[yakutbl_ctr]='槓振和';yfantbl[yakutbl_ctr++]=1;fan++;}if(qianggang!=0 && ronghe!=0){yakutbl[yakutbl_ctr]='搶槓和';if(lang=='en') yakutbl[yakutbl_ctr]='Robbing The Kong';yfantbl[yakutbl_ctr++]=1;fan++;}if(zampai==0 && !yaojiu_furikiri){i='海底摸月';if(ronghe!=0) i='河底撈魚';if(lang=='en') i='Under the Sea';yakutbl[yakutbl_ctr]=i;yfantbl[yakutbl_ctr++]=1;fan++;}}yf_req=fan-duy;if( !yaojiu_furikiri){if((gameMode!=GAMEMODE_PENGLI && yf_req<shibari && !renhe_flag) ||    (gameMode==GAMEMODE_PENGLI && !reach[jia])) return(0);SHUPAI_MOVE(jia);i=fc[jia]*5; j=0;while(--i>=0){k=fl[jia][i] % 100;if(k==0) continue;if(k>50){++j; k-=50;}pai_tbl[k]++;}shugi_tbl[SHUGI_AKA]=j;if(gameMode!=GAMEMODE_PENGLI){i=20; while(--i>0){if((te[jia][i] % 100)>50){++j;shugi_tbl[SHUGI_AKA]++;}}if(lang=='en' && j>0){yakutbl[yakutbl_ctr]='Red Five Tiles';yfantbl[yakutbl_ctr++]=j;fan+=j; j=0;}i=ndr_ctr[jia]; j+=i; while(--i>-1){pai_tbl[ndr[jia][i] % 50]++;}i=doraCtr; while(--i>=0) j+=pai_tbl[dora[i]];if(reach[jia]){i=uradora_opened; while(--i>=0){j+=pai_tbl[uradora[i]];shugi_tbl[SHUGI_URA]+=pai_tbl[uradora[i]];}}if(j>0){yakutbl[yakutbl_ctr]='ドラ';if(lang=='en') yakutbl[yakutbl_ctr]='Dora';yfantbl[yakutbl_ctr++]=j;fan+=j;}}else if(dora[0]>0){j=pai_tbl[dora[0]]+pai_tbl[dora[0]+10]+pai_tbl[dora[0]+20];if(j>0){yakutbl[yakutbl_ctr]='ドラ';yfantbl[yakutbl_ctr++]=j;fan+=j;}}}i=8; if(gameMode==GAMEMODE_SAMMA) i=50;if(renhe_flag>0 && ((gameModeSpecial & (GAMEMODE_SPECIAL_AOTENJYO | GAMEMODE_SPECIAL_SEMI_AOTENJYO)) || fan<i || yf_req<shibari)){var str='人和';if(lang=='en') str='Blessing of Man';if(gameModeSpecial & (GAMEMODE_SPECIAL_AOTENJYO | GAMEMODE_SPECIAL_SEMI_AOTENJYO)){var v=8;i=yakutbl_ctr; while(--i>-1){yakutbl[i+1]=yakutbl[i];yfantbl[i+1]=yfantbl[i];}yakutbl_ctr++;yakutbl[0]=str; yfantbl[0]=v; fan+=v;}else {yakuman_tbl[0]=str; fan=192;yakuman_tbl_ctr=1;}}if(fan>255) shugi_tbl[SHUGI_YKM]=20;pay2=0;if(gameMode==GAMEMODE_PENGLI){fan &= 255;i=yakutbl2.length; while(--i>=0){yakutbl2[i]='';yfantbl2[i]='';}i=-1; while(++i<yakuman_tbl_ctr){yakutbl2[i]=yakuman_tbl[i];yfantbl2[i]=15;fan+=15;}j=-1; while(++j<yakutbl_ctr){yakutbl2[i]=yakutbl[j];yfantbl2[i]=yfantbl[j];i++;}yakutbl_ctr=0; j=-1; while(++j<i){yakutbl[j]=yakutbl2[j];yfantbl[j]=yfantbl2[j];++yakutbl_ctr;}yakuman_tbl_ctr=0;yakustatus_fu=0;fdat[jia].dat=[0,0,0,0,0,0];if(!mq[jia]){i=yakutbl_ctr; while(--i>-1){yakutbl[i+1]=yakutbl[i];yfantbl[i+1]=yfantbl[i];}yakutbl_ctr++;yakutbl[0]='門前清';yfantbl[0]=1;fan++;}yakustatus_fan=fan;i=fan; if(i>30) i=30;pay1=1; --i; while(--i>-1) pay1+=pay1;yakustatus_pts=pay0=pay2=pay1;return(fan);}if(gameMode==GAMEMODE_SAMMA){yakustatus_fu=0;fdat[jia].dat=[0,0,0,0,0,0];if(fan>255){yakutbl_ctr=-1; while(++yakutbl_ctr<yakuman_tbl_ctr){yakutbl[yakutbl_ctr]=yakuman_tbl[yakutbl_ctr];yfantbl[yakutbl_ctr]='';}yakustatus_mgn='役満貫';yakustatus_fan=0;yakustatus_pts=pay0=pay1=pay2=100;return(100);}if(fan>127){yakutbl_ctr=-1; while(++yakutbl_ctr<yakuman_tbl_ctr){yakutbl[yakutbl_ctr]=yakuman_tbl[yakutbl_ctr];yfantbl[yakutbl_ctr]='';}yakustatus_mgn='満貫';yakustatus_pts=pay0=pay1=pay2=50;return(50);}fan+=2;if(zhuangjia==jia){++fan;yakustatus_mgn='荘家 ';}if(!mq[jia]){i=yakutbl_ctr; while(--i>-1){yakutbl[i+1]=yakutbl[i];yfantbl[i+1]=yfantbl[i];}yakutbl_ctr++;yakutbl[0]='門前清';yfantbl[0]=1;fan++;}yakustatus_fan=fan;if(fan>=50){yakustatus_mgn+='満貫';yakustatus_pts=pay0=pay1=pay2=50;return(50);}yakustatus_pts=pay0=pay1=pay2=fan;return(fan);}if(gameModeSpecial & (GAMEMODE_SPECIAL_AOTENJYO | GAMEMODE_SPECIAL_SEMI_AOTENJYO)){fan &= 255;i=yakutbl2.length; while(--i>=0){yakutbl2[i]='';yfantbl2[i]='';}i=-1; while(++i<yakuman_tbl_ctr){yakutbl2[i]=yakuman_tbl[i];yfantbl2[i]=15;fan+=15;}j=-1; while(++j<yakutbl_ctr){yakutbl2[i]=yakutbl[j];yfantbl2[i]=yfantbl[j];i++;}yakutbl_ctr=0; j=-1; while(++j<i){yakutbl[j]=yakutbl2[j];yfantbl[j]=yfantbl2[j];++yakutbl_ctr;}yakuman_tbl_ctr=0;}if(gameModeSpecial & GAMEMODE_SPECIAL_AOTENJYO){fan+=2;if(fu==-1){if(!qiduizi_fu) fu=30;}else {fu=Math.floor((fu-1) / 10) * 10+10;}i=fu; j=fan;if(fu>0){ yakustatus_fu=fu; yakustatus_fan=fan; }else { yakustatus_fu=25; yakustatus_fan=fan; i=100; j-=2; }while(--j>=0){if((i+=i)>=250000000){i=250000000; break;}}j=i+i;pay0=Math.floor((i-1)/100)+1;pay1=Math.floor((j-1)/100)+1;if(zhuangjia==jia){ pay2=Math.floor((i*6-1)/100)+1; pay0=pay1; }else pay2=Math.floor((i*4-1)/100)+1;}else if(fan>255){yakutbl_ctr=-1; while(++yakutbl_ctr<yakuman_tbl_ctr){yakutbl[yakutbl_ctr]=yakuman_tbl[yakutbl_ctr];yfantbl[yakutbl_ctr]='';}yakustatus_mgn='役満貫';if(lang=='en') yakustatus_mgn='Yakuman';pay0=80; pay1=160;if(gameMode==GAMEMODE_EASTERN_BOO){yakustatus_mgn='満貫';if(lang=='en') yakustatus_mgn='Mangan';pay0=20; pay1=40;babao=-1;}fdat[jia].dat=[0,0,0,0,0,0];boo_yakuman=1;}else if(fan>191){yakutbl_ctr=-1; while(++yakutbl_ctr<yakuman_tbl_ctr){yakutbl[yakutbl_ctr]=yakuman_tbl[yakutbl_ctr];yfantbl[yakutbl_ctr]='';}yakustatus_mgn='倍満貫';if(lang=='en') yakustatus_mgn='Baiman';pay0=40; pay1=80;if(gameMode==GAMEMODE_EASTERN_BOO){yakustatus_mgn='満貫';if(lang=='en') yakustatus_mgn='Mangan';pay0=20; pay1=40;babao=-1;}fdat[jia].dat=[0,0,0,0,0,0];}else if(fan>127){yakutbl_ctr=-1; while(++yakutbl_ctr<yakuman_tbl_ctr){yakutbl[yakutbl_ctr]=yakuman_tbl[yakutbl_ctr];yfantbl[yakutbl_ctr]='';}yakustatus_mgn='満貫';if(lang=='en') yakustatus_mgn='Mangan';pay0=20; pay1=40;fdat[jia].dat=[0,0,0,0,0,0];}else {fan+=2;if((gameModeSpecial & GAMEMODE_SPECIAL_SEMI_AOTENJYO) && fan>=17){yakustatus_fan=fan;j=((fan-15) >> 1)+4;if(lang=='en') yakustatus_mgn=j+' times of Mangan';else {if(j>19) yakustatus_mgn=dat_wasuji[Math.floor(j / 10)];if(j>9){ yakustatus_mgn='十'; j=j % 10; }yakustatus_mgn+=dat_wasuji[j]+'倍満貫';}pay0=20*j; pay1=40*j;fdat[jia].dat=[0,0,0,0,0,0];}else if(gameMode!=GAMEMODE_EASTERN_BOO && fan>=8){if(fan>=15){yakustatus_fan=fan;yakustatus_mgn='四倍満貫';if(lang=='en') yakustatus_mgn='Yakuman';pay0=80; pay1=160;fdat[jia].dat=[0,0,0,0,0,0];}else if(fan>=13){yakustatus_fan=fan;yakustatus_mgn='三倍満貫';if(lang=='en') yakustatus_mgn='Sambaiman';pay0=60; pay1=120;fdat[jia].dat=[0,0,0,0,0,0];}else if(fan>=10){yakustatus_fan=fan;yakustatus_mgn='倍満貫';if(lang=='en') yakustatus_mgn='Baiman';pay0=40; pay1=80;fdat[jia].dat=[0,0,0,0,0,0];}else {yakustatus_fan=fan;yakustatus_mgn='跳満貫';if(lang=='en') yakustatus_mgn='Haneman';pay0=30; pay1=60;fdat[jia].dat=[0,0,0,0,0,0];}}else {if(fu==-1){if(!qiduizi_fu) fu=30;}else {fu=Math.floor((fu-1) / 10) * 10+10;}i=fu; j=fan;if(fu>0){ yakustatus_fu=fu; yakustatus_fan=fan; }else { yakustatus_fu=25; yakustatus_fan=fan; i=100; j-=2; }while(--j>=0) i+=i;if(i>2000){yakustatus_mgn='満貫';if(lang=='en') yakustatus_mgn='Mangan';pay0=20; pay1=40;}else {j=i+i;pay0=Math.floor((i-1)/100)+1;pay1=Math.floor((j-1)/100)+1;if(zhuangjia==jia){ pay2=Math.floor((i*6-1)/100)+1; pay0=pay1; }else pay2=Math.floor((i*4-1)/100)+1;}}}if(pay2==0){if(zhuangjia==jia){ pay2=pay1*3; pay0=pay1; }else pay2=pay0*4;}yakustatus_pts=pay2*100;return(pay2);}
