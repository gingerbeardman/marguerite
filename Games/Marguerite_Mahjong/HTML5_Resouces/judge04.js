function _t_init_balance(){var jia=_t_players;_t_top_jia=_t_top_jia2=-1;_t_shizumi_ctr=_t_shizumi_ctr2=0;_t_ko_flag=_t_ko_flag2=0;_t_bm_yakuman_jia=_t_bm_yakuman_jia2=-1;while(--jia>=0){_t[jia].balance_point=_t[jia].balance2_point=_t[jia].balance_tsumi=_t[jia].balance2_tsumi=_t[jia].balance_dora=_t[jia].balance2_dora=_t[jia].balance_zhuangjia=_t[jia].balance2_zhuangjia=_t[jia].balance_total=_t[jia].balance2_total=_t[jia].balance_kyotaku=_t[jia].balance2_kyotaku=0;_t[jia].score_after_balance2=_t[jia].score_after_balance=_t[jia].score;_t[jia].chip_balance=0;_t[jia].chip_gotten=0;_t[jia].chip_detail.yakibuta=_t[jia].chip_detail.gang=_t[jia].chip_detail.ippatsu=_t[jia].chip_detail.uradora=_t[jia].chip_detail.akapai=_t[jia].chip_detail.hanapai=_t[jia].chip_detail.yakuman=0;_t[jia].chip_detail.yakibuta2=_t[jia].chip_detail.gang2=_t[jia].chip_detail.ippatsu2=_t[jia].chip_detail.uradora2=_t[jia].chip_detail.akapai2=_t[jia].chip_detail.hanapai2=_t[jia].chip_detail.yakuman2=0;_t[jia].balance_menqian=_t[jia].balance2_menqian=0;}_t_result_after_balance();jia=_t_players;while(--jia>=0){_t[jia].result_after_balance2=_t[jia].result_after_balance;_t[jia].rank_after_balance2=_t[jia].rank_after_balance;_t[jia].resultRank_after_balance2=_t[jia].resultRank_after_balance;}}function _t_init_balance2(){var jia=_t_players, j;_t_top_jia=-1;_t_shizumi_ctr=0;_t_bm_yakuman_jia=-1;while(--jia>=0){if(!_t_rule.liangjiahe){_t[jia].balance_point=_t[jia].balance_tsumi=_t[jia].balance_dora=_t[jia].balance_zhuangjia=_t[jia].balance_total=_t[jia].balance_kyotaku=0;_t[jia].score_after_balance=_t[jia].score;_t[jia].chip_balance=0;_t[jia].chip_detail.ippatsu=_t[jia].chip_detail.uradora=_t[jia].chip_detail.akapai=_t[jia].chip_detail.hanapai=_t[jia].chip_detail.yakuman=0;_t[jia].balance_menqian=0;continue;}_t[jia].balance_point=_t[jia].balance2_point;_t[jia].balance_tsumi=_t[jia].balance2_tsumi;_t[jia].balance_dora=_t[jia].balance2_dora;_t[jia].balance_zhuangjia=_t[jia].balance2_zhuangjia;_t[jia].balance_kyotaku=_t[jia].balance2_kyotaku;_t[jia].balance_total=_t[jia].balance2_total;_t[jia].score_after_balance=_t[jia].score_after_balance2;_t[jia].chip_balance=_t[jia].chip_balance2;_t[jia].chip_detail.ippatsu=_t[jia].chip_detail.ippatsu2;_t[jia].chip_detail.uradora=_t[jia].chip_detail.uradora2;_t[jia].chip_detail.akapai=_t[jia].chip_detail.akapai2;_t[jia].chip_detail.hanapai=_t[jia].chip_detail.hanapai2;_t[jia].chip_detail.yakuman=_t[jia].chip_detail.yakuman2;_t[jia].balance_menqian=_t[jia].balance2_menqian;}_t_result_after_balance();}function _t_save_balance(){var jia=_t_players;while(--jia>=0){_t[jia].balance2_point=_t[jia].balance_point;_t[jia].balance2_tsumi=_t[jia].balance_tsumi;_t[jia].balance2_dora=_t[jia].balance_dora;_t[jia].balance2_zhuangjia=_t[jia].balance_zhuangjia;_t[jia].balance2_total=_t[jia].balance_total;_t[jia].balance2_kyotaku=_t[jia].balance_kyotaku;_t[jia].score_after_balance2=_t[jia].score_after_balance;_t[jia].result_after_balance2=_t[jia].result_after_balance;_t[jia].rank_after_balance2=_t[jia].rank_after_balance;_t[jia].chip_balance2=_t[jia].chip_balance;_t[jia].balance2_menqian=_t[jia].balance_menqian;_t[jia].chip_detail.ippatsu2=_t[jia].chip_detail.ippatsu;_t[jia].chip_detail.uradora2=_t[jia].chip_detail.uradora;_t[jia].chip_detail.akapai2=_t[jia].chip_detail.akapai;_t[jia].chip_detail.hanapai2=_t[jia].chip_detail.hanapai;_t[jia].chip_detail.yakuman2=_t[jia].chip_detail.yakuman;}_t_top_jia2=_t_top_jia;_t_shizumi_ctr2=_t_shizumi_ctr;_t_ko_flag2=_t_ko_flag;_t_bm_yakuman_jia2=_t_bm_yakuman_jia;}function _t_hele_balance(jia, dajia){var jia2=-1, i, j, ts=0, po=0, kt=0, cp=0, cp2=0;_t_chip_detail.yakibuta=0;if(_t_rule.chip.yakibuta){jia2=_t_players; j=0; k=-1; while(--jia2>=0){if(_t[jia2].yakitori_flag){ j++; k=jia2; }}if(j==1 && k==jia && dajia>-1) _t_chip_detail.yakibuta=_t_rule.chip.yakibuta;}if(_t_gamemode==_T_GAMEMODE_GUOJI){var zh=0, zh1=0, zh2;if(dajia<0){jia2=_t_players;while(--jia2>=0){if(jia2==jia) continue;_t[jia2].balance_point-=_t_yaku_result_point+8; po+=_t_yaku_result_point+8;_t[jia2].balance_total-=_t_yaku_result_point+8;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;}}else {jia2=_t_players;while(--jia2>=0){if(jia2==jia) continue;i=8; if(jia2==dajia) i+=_t_yaku_result_point;_t[jia2].balance_point-=i; po+=i;_t[jia2].balance_total-=i;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;}}_t[jia].balance_point+=po;_t[jia].balance_total+=po;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;return;}if(_t_reach_mahjong_rule){var rbc=_t_reach_bo_ctr;i=4; while(--i>=0) _t[i].balance_kyotaku=0;if(_t_players==4){if(dajia<0){if(_t_babaojia>-1){po=_t_yaku_result_point;if(_t_rule.wareme && (jia==_t_kaimen_jia || _t_babaojia==_t_kaimen_jia)) po <<= 1;ts=_t_tsumi_rong*_t_tsumibo_ctr;_t[_t_babaojia].balance_point-=po;_t[_t_babaojia].balance_tsumi-=ts;_t[_t_babaojia].balance_total-=po+ts;if(_t_rule.chip.any){cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[_t_babaojia].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[_t_babaojia].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[_t_babaojia].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[_t_babaojia].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai; _t[_t_babaojia].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[_t_babaojia].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[_t_babaojia].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[_t_babaojia].chip_balance-=cp2; cp+=cp2;}}else {jia2=4;while(--jia2>=0){if(jia2==jia) continue;i=_t_yaku_pay_of_sanjia;if(jia2==_t_zhuangjia) i=_t_yaku_pay_of_zhuangjia;if(_t_rule.wareme && (jia==_t_kaimen_jia || jia2==_t_kaimen_jia)) i <<= 1;_t[jia2].balance_point-=i; po+=i; j=i;i=_t_tsumibo_ctr*_t_tsumi_mohe;j+=i;_t[jia2].balance_tsumi-=i; ts+=i;_t[jia2].balance_total-=j;if(!_t_rule.chip.any) continue;cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[jia2].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[jia2].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[jia2].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[jia2].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[jia2].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[jia2].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[jia2].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[jia2].chip_balance-=cp2; cp+=cp2;}}}else {i=4; while(--i>=0){if(i==dajia || !_t[i].reach_flag || _t[i].declare_command!=25) continue;_t[i].balance_kyotaku+=10; rbc-=10;}po=_t_yaku_result_point;if(_t_rule.wareme && jia==_t_kaimen_jia) po <<= 1;i=po; po=0;ts=_t_tsumi_rong*_t_tsumibo_ctr;if(_t_babaojia>-1){i >>= 1; j=i;if(_t_rule.wareme && _t_babaojia==_t_kaimen_jia) i <<= 1;_t[_t_babaojia].balance_point-=i;_t[_t_babaojia].balance_total=_t[_t_babaojia].balance_point;po+=i; i=j;}if(_t_rule.wareme && dajia==_t_kaimen_jia) i <<= 1;_t[dajia].balance_point-=i;_t[dajia].balance_tsumi-=ts;_t[dajia].balance_total=_t[dajia].balance_point+_t[dajia].balance_tsumi;po+=i;if(_t_rule.chip.any){cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[dajia].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[dajia].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[dajia].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[dajia].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[dajia].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[dajia].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[dajia].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[dajia].chip_balance-=cp2; cp+=cp2;}}_t[jia].balance_point+=po;_t[jia].balance_tsumi+=ts;_t[jia].balance_kyotaku+=rbc;_t[jia].balance_total+=po+ts+rbc;if(_t_rule.chip.any) _t[jia].chip_balance+=cp;i=4; while(--i>=0){_t[i].balance_total=_t[i].balance_point+_t[i].balance_tsumi+_t[i].balance_kyotaku;_t[i].score_after_balance=_t[i].score+_t[i].balance_total;}return;}if(_t_players==3){if(dajia<0){jia2=3;while(--jia2>=0){if(jia2==jia) continue;j=_t_yaku_result_point;if(_t_gamemode==_T_GAMEMODE_REACH){j=_t_yaku_pay_of_sanjia;if(jia2==_t_zhuangjia) j=_t_yaku_pay_of_zhuangjia;}if(_t_rule.wareme && (jia==_t_kaimen_jia || jia2==_t_kaimen_jia)) j <<= 1;_t[jia2].balance_point-=j; po+=j;i=_t_tsumibo_ctr*_t_tsumi_mohe;_t[jia2].balance_tsumi-=i; ts+=i;_t[jia2].balance_total-=j+i;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;if(!_t_rule.chip.any) continue;cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[jia2].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[jia2].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[jia2].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[jia2].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[jia2].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[jia2].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[jia2].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[jia2].chip_balance-=cp2; cp+=cp2;}}else {po=_t_yaku_result_point;if(_t_rule.wareme && (jia==_t_kaimen_jia || dajia==_t_kaimen_jia)) po <<= 1;ts=_t_tsumibo_ctr*_t_tsumi_rong;_t[dajia].balance_point-=po;_t[dajia].balance_tsumi-=ts;_t[dajia].balance_total-=po+ts;_t[dajia].score_after_balance=_t[dajia].score+_t[dajia].balance_total;if(_t_rule.chip.any){cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[dajia].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[dajia].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[dajia].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[dajia].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[dajia].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[dajia].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[dajia].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[dajia].chip_balance-=cp2; cp+=cp2;}}_t[jia].balance_point+=po;_t[jia].balance_tsumi+=ts;_t[jia].balance_kyotaku=_t_reach_bo_ctr;_t[jia].balance_total+=po+ts+_t_reach_bo_ctr;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;if(_t_rule.chip.any) _t[jia].chip_balance+=cp;return;}if(_t_players==2){jia2=(jia) ? 0 : 1;po=_t_yaku_result_point;ts=_t_tsumi_rong*_t_tsumibo_ctr;_t[jia2].balance_point-=po;_t[jia2].balance_tsumi-=ts;_t[jia2].balance_total+=i+ts;_t[jia2].score_after_balance=_t[dajia].score+_t[dajia].balance_total;if(_t_rule.chip.any){cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[jia2].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[jia2].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[jia2].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[jia2].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[jia2].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[jia2].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[jia2].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[jia2].chip_balance-=cp2; cp+=cp2;}_t[jia].balance_point+=po;_t[jia].balance_tsumi+=ts;_t[jia].balance_kyotaku=_t_reach_bo_ctr;_t[jia].balance_total+=po+ts+_t_reach_bo_ctr;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;if(_t_rule.chip.any) _t[jia].chip_balance+=cp;return;}}if(_t_gamemode==_T_GAMEMODE_BOO){var dr=0, mq=0;if(dajia<0){jia2=4;while(--jia2>=0){if(jia2==jia) continue;i=_t_yaku_pay_of_sanjia;if(jia2==_t_zhuangjia) i=_t_yaku_pay_of_zhuangjia;_t[jia2].balance_point-=i; po+=i; j=i;i=_t_tsumibo_ctr*_t_tsumi_mohe;j+=i;_t[jia2].balance_tsumi-=i; ts+=i;if(!_t[jia].menqian_flag && _t_rule.bm_menqian){_t[jia2].balance_menqian-=10; mq+=10;}if(_t_yakufan_ctr>1 || !_t[jia].menqian_flag || !_t_rule.bm_yakunashi_dora){i=_t_yaku_dora*10; j+=i;_t[jia2].balance_dora=-i; dr+=i;}_t[jia2].balance_total=_t[jia2].balance_point+_t[jia2].balance_tsumi+_t[jia2].balance_dora+_t[jia2].balance_menqian;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;}}else {po=_t_yaku_result_point;_t[dajia].balance_point-=po;ts=_t_tsumibo_ctr*_t_tsumi_mohe*3;_t[dajia].balance_tsumi-=ts;if(!_t[jia].menqian_flag && _t_rule.bm_menqian){_t[dajia].balance_menqian-=30; mq+=30;}if(_t_yakufan_ctr>1 || !_t[jia].menqian_flag || !_t_rule.bm_yakunashi_dora){dr=_t_yaku_dora*30;_t[dajia].balance_dora-=dr;}_t[dajia].balance_total=_t[dajia].balance_point+_t[dajia].balance_tsumi+_t[dajia].balance_dora+_t[dajia].balance_menqian;_t[dajia].score_after_balance=_t[dajia].score+_t[dajia].balance_total;}_t[jia].balance_point+=po;_t[jia].balance_tsumi+=ts;_t[jia].balance_dora+=dr;_t[jia].balance_menqian+=mq;_t[jia].balance_total=_t[jia].balance_point+_t[jia].balance_tsumi+_t[jia].balance_dora+_t[jia].balance_menqian;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;if(_t_yakuman_name_ctr>0 && _t_rule.bm_yakuman) _t_bm_yakuman_jia=jia;return;}if(_t_gamemode==_T_GAMEMODE_ARSHIAR){if(dajia<0 && _t_babaojia){jia2=4;while(--jia2>=0){if(jia2==jia) continue;i=_t_yaku_pay_of_sanjia;if(jia2==_t_zhuangjia) i=_t_yaku_pay_of_zhuangjia;_t[jia2].balance_point-=i; po+=i;_t[jia2].balance_total=_t[jia2].balance_point;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;}}else {po=i=_t_yaku_result_point;if(_t_babaojia>-1){i >>= 1;_t[_t_babaojia].balance_point-=i;_t[_t_babaojia].balance_total=_t[_t_babaojia].balance_point;_t[_t_babaojia].score_after_balance=_t[_t_babaojia].score+_t[_t_babaojia].balance_total;}_t[dajia].balance_point-=i;_t[dajia].balance_total=_t[dajia].balance_point;_t[dajia].score_after_balance=_t[dajia].score+_t[dajia].balance_total;}_t[jia].balance_point+=po;_t[jia].balance_total=_t[jia].balance_point;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;return;}if(_t_gamemode==_T_GAMEMODE_BEINUKI){if(_t_yaku_result_point<=1){jia2=3;while(--jia2>=0){if(jia2==jia) continue;_t[jia2].balance_point+=3;_t[jia2].balance_tsumi+=0;_t[jia2].balance_total+=3;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;}po=-6; ts=0;}else if(dajia<0){jia2=3;while(--jia2>=0){if(jia2==jia) continue;j=_t_yaku_result_point;if(_t_rule.wareme && (jia==_t_kaimen_jia || jia2==_t_kaimen_jia)) j <<= 1;_t[jia2].balance_point-=j; po+=j;i=_t_tsumibo_ctr*_t_tsumi_mohe;_t[jia2].balance_tsumi-=i; ts+=i;_t[jia2].balance_total-=j+i;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;if(!_t_rule.chip.any) continue;cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[jia2].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[jia2].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[jia2].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[jia2].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[jia2].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[jia2].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[jia2].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[jia2].chip_balance-=cp2; cp+=cp2;}}else {po=_t_yaku_result_point;if(_t_rule.wareme && (jia==_t_kaimen_jia || dajia==_t_kaimen_jia)) po <<= 1;ts=_t_tsumibo_ctr*_t_tsumi_rong;_t[dajia].balance_point-=po;_t[dajia].balance_tsumi-=ts;_t[dajia].balance_total-=po+ts;_t[dajia].score_after_balance=_t[dajia].score+_t[dajia].balance_total;if(_t_rule.chip.any){cp2=0;_t[jia].chip_detail.yakibuta+=_t_chip_detail.yakibuta;_t[dajia].chip_detail.yakibuta-=_t_chip_detail.yakibuta;cp2+=_t_chip_detail.yakibuta;_t[jia].chip_detail.gang+=_t_chip_detail.gang;_t[dajia].chip_detail.gang-=_t_chip_detail.gang;cp2+=_t_chip_detail.gang;_t[jia].chip_detail.ippatsu+=_t_chip_detail.ippatsu;_t[dajia].chip_detail.ippatsu-=_t_chip_detail.ippatsu;cp2+=_t_chip_detail.ippatsu;_t[jia].chip_detail.uradora+=_t_chip_detail.uradora;_t[dajia].chip_detail.uradora-=_t_chip_detail.uradora;cp2+=_t_chip_detail.uradora;_t[jia].chip_detail.akapai+=_t_chip_detail.akapai;_t[dajia].chip_detail.akapai-=_t_chip_detail.akapai; cp2+=_t_chip_detail.akapai;_t[jia].chip_detail.hanapai+=_t_chip_detail.hanapai;_t[dajia].chip_detail.hanapai-=_t_chip_detail.hanapai;cp2+=_t_chip_detail.hanapai;_t[jia].chip_detail.yakuman+=_t_chip_detail.yakuman;_t[dajia].chip_detail.yakuman-=_t_chip_detail.yakuman;cp2+=_t_chip_detail.yakuman;_t[dajia].chip_balance-=cp2; cp+=cp2;}}_t[jia].balance_point+=po;_t[jia].balance_tsumi+=ts;_t[jia].balance_total+=po+ts;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;if(_t_rule.chip.any) _t[jia].chip_balance+=cp;return;}if(_t_gamemode==_T_GAMEMODE_TAIWAN){var zh=0, zh1=0, zh2;if(dajia<0){jia2=_t_players;while(--jia2>=0){if(jia2==jia) continue;zh2=0;_t[jia2].balance_point-=_t_yaku_result_point; po+=_t_yaku_result_point;i=_t_tsumibo_ctr*_tm_yakuRate;_t[jia2].balance_tsumi-=i; ts+=i;if(jia==_t_zhuangjia || jia2==_t_zhuangjia) zh2=_tm_yakuRate;_t[jia2].balance_zhuangjia-=zh2; zh+=zh2;_t[jia2].balance_total-=_t_yaku_result_point+i+zh2;_t[jia2].score_after_balance=_t[jia2].score+_t[jia2].balance_total;}}else {po=_t_yaku_result_point;if(dajia==_t_zhuangjia || jia==_t_zhuangjia){zh=_tm_yakuRate;ts=_t_tsumibo_ctr*_tm_yakuRate;}_t[dajia].balance_point-=po;_t[dajia].balance_tsumi-=ts;_t[dajia].balance_zhuangjia-=zh;_t[dajia].balance_total-=po+ts+zh;_t[dajia].score_after_balance=_t[dajia].score+_t[dajia].balance_total;}_t[jia].balance_point+=po;_t[jia].balance_tsumi+=ts;_t[jia].balance_zhuangjia+=zh;_t[jia].balance_total+=po+ts+zh;_t[jia].score_after_balance=_t[jia].score+_t[jia].balance_total;return;}}function _t_result_after_balance(){var jia, sc, jia2, rank=0, paid, got;var i, j, k;_t_top_jia=-1;_t_shizumi_ctr=0;_t_ko_flag=0;var fl=[0,0,0,0];var ja=[-1,-1,-1,-1];var sb=[-63386,-65536,-65536,-65536];var tp=[0,0,0,0];var tr=[0, 0, 0, 0];if(_t_gamemode==_T_GAMEMODE_GUOJI || (_t_gamemode==_T_GAMEMODE_REACH && _t_lang!='ja')){k=0;for(;;){i=-65536; j=-1; jia=_t_players; while(--jia>=0){if(fl[jia]) continue;if(i<_t[jia].score_after_balance){ i=_t[jia].score_after_balance; j=jia; }}if(j<0) break;fl[j]=1;ja[k]=j; sb[k]=i;k++;}_t_top_jia=ja[0];if(_t_gamemode==_T_GAMEMODE_REACH && _t_lang!='ja'){tp=[300, 100, -100, -300];if(sb[0]==sb[3]) tp=[0, 0, 0, 0];else if(sb[0]==sb[2]) tp=[100, 100, 100, -900];else if(sb[1]==sb[3]) tp=[300, -100, -100, -100];else {if(sb[0]==sb[1]) tp[0]=tp[1]=200;else if(sb[1]==sb[2]) tp[1]=tp[2]=0;else if(sb[2]==sb[3]) tp[2]=tp[3]=-200;}while(--k>=0){j=ja[k];_t[j].result_after_balance=_t[j].score_after_balance+tp[k];_t[j].rank_after_balance=k;}return;}else if(_t_gamemode==_T_GAMEMODE_GUOJI){tp=[40, 20, 10, 0];if(sb[0]==sb[3]) tp=[15, 15, 15, 15];else if(sb[0]==sb[2]) tp=[20, 20, 20, 0];else if(sb[1]==sb[3]) tp=[40, 10, 10, 10];else {if(sb[0]==sb[1]){ tp[0]=tp[1]=30; tp[2]=tp[3]=0; }else if(sb[1]==sb[2]) tp[1]=tp[2]=15;else if(sb[2]==sb[3]) tp[2]=tp[3]=5;}while(--k>=0){j=ja[k];_t[j].result_after_balance=tp[k];_t[j].rank_after_balance=k;}return;}}jia=_t_players; while(--jia>=0){_t[jia].rank_after_balance=-1;i=_t[jia].score_after_balance;if(_t_gamemode==_T_GAMEMODE_BOO || _t_gamemode==_T_GAMEMODE_EASTERN_BOO){if(i<=0) _t_ko_flag=1;i=0;}else {if(i<0) _t_ko_flag=1;if(_t_gamemode==_T_GAMEMODE_ARSHIAR) i-=200;else if(_t_gamemode==_T_GAMEMODE_BEINUKI || _t_gamemode==_T_GAMEMODE_CHIP_MAHJONG) i-=50;else if(_t_gamemode==_T_GAMEMODE_PENGLI) ;else if(_t_reach_mahjong_rule) i=Math.round((i-300)/10);}_t[jia].result_after_balance=i;}for(;;){jia=_t_jijia; jia2=-1;do {if(_t[jia].rank_after_balance<0){if(jia2<0 || _t[jia].score_after_balance>sc){ sc=_t[jia].score_after_balance; jia2=jia; }}if(++jia>=_t_players) jia=0;} while(jia!=_t_jijia);if(jia2<0) break;if(_t_top_jia<0) _t_top_jia=jia2;_t[jia2].rank_after_balance=rank++;}if(_t_gamemode==_T_GAMEMODE_BOO || _t_gamemode==_T_GAMEMODE_EASTERN_BOO){if(_t_bm_yakuman_jia>-1 && (_t_rule.bm_yakuman>0 || _t_gamemode==_T_GAMEMODE_EASTERN_BOO)){_t_shizumi_ctr=_t_players-1; _t_top_jia=_t_bm_yakuman_jia;if(_t_rule.bm_yakuman==2 || _t_gamemode==_T_GAMEMODE_EASTERN_BOO) _t_shizumi_ctr=6;}else {_t_bm_yakuman_jia=-1;jia=_t_players;while(--jia>=0){if(_t[jia].score_after_balance<_t_genten){ _t_shizumi_ctr++; }}}paid=0; got=-3;if(_t_players==4){if(_t_shizumi_ctr==1){ paid=-3; got=0; }else if(_t_shizumi_ctr==2){ paid=-5; got=7; }else if(_t_shizumi_ctr==3){ paid=-10; got=27; }else if(_t_shizumi_ctr==6){ paid=-20; got=57; }}else  {if(_t_shizumi_ctr==1){ paid=-3; got=0; }else if(_t_shizumi_ctr==2){ paid=-10; got=17; }else if(_t_shizumi_ctr==6){ paid=-20; got=37; }}jia=_t_players;while(--jia>=0){if(_t[jia].score_after_balance<_t_genten || _t_bm_yakuman_jia>-1){ _t[jia].result_after_balance=paid; }}_t[_t_top_jia].result_after_balance=got;return;}if(_t_reach_mahjong_rule || _t_gamemode==_T_GAMEMODE_BEINUKI){sc=0; jia=_t_players;while(--jia>=0){if(jia!=_t_top_jia) sc-=_t[jia].result_after_balance;}_t[_t_top_jia].result_after_balance=sc;}if(_t_rule.yakitori){var yc=0;jia=_t_players; while(--jia>=0){if(_t[jia].yakitori_flag) yc++;}if(yc && yc<_t_players){k=30*yc / (_t_players-yc);jia=_t_players; while(--jia>=0){if(_t[jia].yakitori_flag) _t[jia].result_after_balance-=30;else _t[jia].result_after_balance+=k;}}}jia=_t_players; while(--jia>=0) _t[jia].result_after_balance+=_t[jia].chip+_t[jia].chip_balance;jia=_t_players;while(--jia>-1){ _t[jia].resultRank_after_balance=-1;tr[jia]=_t[jia].result_after_balance+_t[jia].total_result;}i=0; for(;;){jia=_t_players; j=-65536; k=-1;while(--jia>-1){if(_t[jia].resultRank_after_balance>-1) continue;if(tr[jia]>j){j=tr[jia]; k=jia;}}if(k<0) break;_t[k].resultRank_after_balance=i++;}}
