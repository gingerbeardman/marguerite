_t_zpt=new Array(0x40);_t_hp=0;_t_sf=0;_t_df=0;function yj_menzisort(jia, yaku_menzi, yaku_menzi_fu, dandiao, bianzhang, qianzhang, shuangpeng, liangmen){var i, j, k, l, m, n;var yaku_shupai_buff=new Array(20);j=0; while(++j<20){_t_y_shupai[j]=0;yaku_shupai_buff[j]=_t[jia].shupai[j];}yaku_shupai_buff[0]=yaku_shupai_buff[14]=yaku_shupai_buff[15]=0;if((k=dandiao)<0 && (k=bianzhang)<0 && (k=qianzhang)<0 && (k=liangmen)<0) k=shuangpeng;var n1=_t[jia].fulou_ctr*3;var lim=5-_t[jia].fulou_ctr;i=-1; n=0; while(++i<lim){if(i==k) continue;j=yaku_menzi[i];if(j<=0) break;if(j<0x40){_t_y_shupai_fu[n++]=3;_t_y_shupai_fu[n++]=0;j--; l=3;while(--l>=0){m=0;while(++m<14){if((yaku_shupai_buff[m] & 0x3f)==j){_t_y_shupai[++n1]=yaku_shupai_buff[m];yaku_shupai_buff[m]=0;break;}}++j;}continue;}l=3;if(j>=0xc0) --l;_t_y_shupai_fu[n++]=l;_t_y_shupai_fu[n++]=yaku_menzi_fu[i];j &= 0x3f; while(--l>=0){m=0; while(++m<14){if((yaku_shupai_buff[m] & 0x3f)==j){_t_y_shupai[++n1]=yaku_shupai_buff[m];yaku_shupai_buff[m]=0;break;}}}}if((j=yaku_menzi[k])<0xc0){ _t_y_shupai_fu[n++]=3; }else { _t_y_shupai_fu[n++]=2; }_t_y_shupai_fu[n++]=yaku_menzi_fu[k];m=0; while(++m<14){if((yaku_shupai_buff[m] & 0x3f)>0) _t_y_shupai[++n1]=yaku_shupai_buff[m];}_t_y_shupai_fu[n]=-1;_t_y_shupai[14]=_t[jia].shupai[14];_t_y_shupai[15]=_t[jia].shupai[15];}function _t_shupai_move(jia){var i=0;var j=0;i=0x40;while(--i>=0) _t_bipai2[i]=0;i=20;while(--i>0){j=_t[jia].shupai[i] & 0x3f;if(j>0 && j<0x38) _t_bipai2[j]++;}}function _t_jiulianbaodeng(jia){if(_t[jia].fulou_ctr>0) return(0);_t_shupai_move(jia);var i=1, j;var k=0, l;i=_t[jia].shupai[1] & 0x30;j=0;if(_t_bipai2[i+1]<3 || _t_bipai2[i+9]<3) j=1;k=_t_bipai2[i+1]+_t_bipai2[i+9];l=1;while(++l<9){k+=_t_bipai2[i+l];if(_t_bipai2[i+l]==0) j=1;}if(j==0 && k==14) return(1);return(0);}function _t_guoshiwushuang(jia){if(_t[jia].fulou_ctr>0) return(0);_t_shupai_move(jia);var i=1;var k=0;for(;;){if(_t_bipai2[i]==0) return(0);if(_t_bipai2[i]>1) ++k;i+=8; if(i==0x31) break;}for(;;){if(_t_bipai2[i]==0) return(0);if(_t_bipai2[i]>1) ++k;i++; if(i==0x38) break;}if(k!=1) return(0);return(1);}function _t_daisharin(jia){if(_t[jia].fulou_ctr>0) return(0);_t_shupai_move(jia);var i=0x10;var j=0;while(++i<0x14){j=7;while(--j>=0){if(_t_bipai2[i+j]!=2) break;}if(j<0) return(1);}return(0);}function _t_shisanbuta(jia){_t_shupai_move(jia);var i=0x38;var j=1;while(--i>0){if(_t_bipai2[i]>2 || (_t_bipai2[i]==2 && --j!=0)){ return(0); }}if(j) return(0);i=0;while(++i<0x2a){if(_t_bipai2[i]==0) continue;if(_t_bipai2[i+1]!=0 || _t_bipai2[i+2]!=0) return(0);}if(_t_yixun_flag!=0 || _t_ronghe_flag!=0) return(0);return(1);}function _t_qiduizi(jia){var i=0, m=5;if(!_t_rule.qiduizi || _t[jia].fulou_ctr>0) return(0);if(_t_gamemode==_T_GAMEMODE_GUOJI) m=1;_t_shupai_move(jia);i=-1; while(++i<_t_menzi.length) _t_menzi[i]=0;if(_t[jia].fulou_ctr>0) return(0);i=0x38; while(--i>0){if(_t_bipai2[i] & m) return(0);}return(1);}function _t_menzi1(jia){_t_shupai_move(jia);var i=0;var p=-1;var q=-1;var r=0;var s=0;_t_menzi[0]=_t_menzi[1]=_t_menzi[2]=_t_menzi[3]=_t_menzi[4]=_t_menzi[5]=0;p=-1; q=-1; r=0; s=0;while(++p<0x2a){if((p & 15)==10) p+=7;if(_t_bipai2[p]==0) continue;if(s==0  && (i=Math.min(_t_bipai2[p], Math.min(_t_bipai2[p+1], _t_bipai2[p+2])))>0){_t_bipai2[p]-=i; _t_bipai2[p+1]-=i; _t_bipai2[p+2]-=i;while(--i>=0) _t_menzi[++q]=p+1;}if(s<2 && r==0 && _t_bipai2[p]>1){_t_bipai2[p]-=2;_t_menzi[++q]=p | 0xc0;r=1;}if(_t_bipai2[p]>2){_t_bipai2[p]-=3;_t_menzi[++q]=p | 0x80;}if(_t_bipai2[p]==0){s=0;continue;}for(;;){if(q<0) return(0);i=_t_menzi[q--];if(i<0x40){p=(i-1) & 0x3f;++_t_bipai2[p];++_t_bipai2[p+1];++_t_bipai2[p+2];s=1; --p; break;}if(i>0xc0){p=i & 0x3f;_t_bipai2[p]+=2;s=2; r=0; --p; break;}_t_bipai2[i & 0x3f]+=3;}}p=0x30; while(++p<0x38){if(_t_bipai2[p]==0) continue;if(_t_bipai2[p]==3){_t_menzi[++q]=p | 0x80;continue;}if(r!=0 || _t_bipai2[p]!=2) return(0);_t_menzi[++q]=p | 0xc0;r=1;}return(1);}function _t_menzi2(jia){_t_shupai_move(jia);var i=0;var p=-1;var q=-1;var r=0;var s=0;_t_menzi[0]=_t_menzi[1]=_t_menzi[2]=_t_menzi[3]=_t_menzi[4]=_t_menzi[5]=0;p=0x2a; q=-1; r=0; s=0;while(--p>0){if(!(p & 15)) p-=7;if(_t_bipai2[p]==0) continue;if(s==0 && p>2 && (i=Math.min(_t_bipai2[p], Math.min(_t_bipai2[p-1], _t_bipai2[p-2])))>0){_t_bipai2[p]-=i; _t_bipai2[p-1]-=i; _t_bipai2[p-2]-=i;while(--i>=0) _t_menzi[++q]=p-1;}if(s<2 && r==0 && _t_bipai2[p]>1){_t_bipai2[p]-=2;_t_menzi[++q]=p | 0xc0;r=1;}if(_t_bipai2[p]>2){_t_bipai2[p]-=3;_t_menzi[++q]=p | 0x80;}if(_t_bipai2[p]==0){s=0;continue;}for(;;){if(q<0) return(0);i=_t_menzi[q--];if(i<0x40){p=(i+1) & 0x3f;++_t_bipai2[p];++_t_bipai2[p-1];++_t_bipai2[p-2];s=1; ++p; break;}if(i>0xc0){p=i & 0x3f;_t_bipai2[p]+=2;s=2; r=0; ++p; break;}_t_bipai2[i & 0x3f]+=3;}}p=0x30; while(++p<0x38){if(_t_bipai2[p]==0) continue;if(_t_bipai2[p]==3){_t_menzi[++q]=p | 0x80;continue;}if(r!=0 || _t_bipai2[p]!=2) return(0);_t_menzi[++q]=p | 0xc0;r=1;}return(1);}function _t_menzi3(jia){_t_shupai_move(jia);var i=0;var p=-1;var q=-1;var r=0;var s=0;_t_menzi[0]=_t_menzi[1]=_t_menzi[2]=_t_menzi[3]=_t_menzi[4]=_t_menzi[5]=0;p=0; q=-1; r=0; s=0;while(++p<0x2a){if((p & 15)==10) p+=7;if(_t_bipai2[p]==0) continue;if(s==0 && _t_bipai2[p]>2){_t_bipai2[p]-=3;_t_menzi[++q]=p | 0x80;}if(s<2 && r==0 && _t_bipai2[p]>1){_t_bipai2[p]-=2;_t_menzi[++q]=p | 0xc0;r=1;}if(p<0x30 && (i=Math.min(_t_bipai2[p], Math.min(_t_bipai2[p+1], _t_bipai2[p+2])))>0){_t_bipai2[p]-=i; _t_bipai2[p+1]-=i; _t_bipai2[p+2]-=i;while(--i>=0) _t_menzi[++q]=p+1;}if(_t_bipai2[p]==0){s=0;continue;}for(;;){if(q<0) return(0);i=_t_menzi[q--];if(i>0xc0){p=i & 0x3f;_t_bipai2[p]+=2;s=2; r=0; --p; break;}if(i>0x40){p=i & 0x3f;_t_bipai2[p]+=3;s=1; --p; break;}p=(i-1) & 0x3f;++_t_bipai2[p];++_t_bipai2[p+1];++_t_bipai2[p+2];}}p=0x30; while(++p<0x38){if(_t_bipai2[p]==0) continue;if(_t_bipai2[p]==3){_t_menzi[++q]=p | 0x80;continue;}if(r!=0 || _t_bipai2[p]!=2) return(0);_t_menzi[++q]=p | 0xc0;r=1;}return(1);}function tingpai_guoshiwushuang(){var i, j, k, l;i=-7; j=k=0; l=-1; while((i+=8)<0x30){if(_t_bipai2[i]<1){ l=i; continue; }++j;if(_t_bipai2[i]>1) k++;}i=0x30; while(++i<0x38){if(_t_bipai2[i]<1){ l=i; continue; }++j;if(_t_bipai2[i]>1) k++;}if(j==13 && k==0) return(-1);if(j==12 && k==1) return(l);return(0);}function _t_tingpai_judge(jia, reach_declare, dapai){var i, m=-1;var j=-1;var k=-1;var l=-1;var c, m1, j1;var dp=dapai & 0x3f;var st=new Array(4);var tmode=1; if(!reach_declare && !_t[jia].reach_flag && !_t_manned[jia]) tmode=2;m=16; while(--m>-1){ _t[jia].helepai[m]=_t[jia].helepai_wait[m]=0; }m=6; while(--m>-1){ _t[jia].gangpai[m]=0; }_t_shupai_move(jia);m=-1; j=-1;while(++m<0x38){if(_t_bipai2[m]==3) _t[jia].gangpai[++j]=m;}_t[jia].helepai_ctr=0;_t[jia].helepai_ctr2=0;_t[jia].furiten_flag=0;_t[jia].min_yifan=_t[jia].min_fan=_t[jia].min_point=0;_t[jia].max_fan=_t[jia].max_point=0;if(_t_gamemode!=_T_GAMEMODE_TAIWAN && _t[jia].fulou_ctr<1 && (i=tingpai_guoshiwushuang())!=0){if(i<0){i=-7; while((i+=8)<0x30){_t[jia].helepai[_t[jia].helepai_ctr++]=i;if(dp==i){ _t[jia].furiten_flag++; continue; }if(_t[jia].fusipai[i]) _t[jia].furiten_flag++;}i=0x30; while(++i<0x38){_t[jia].helepai[_t[jia].helepai_ctr++]=i;if(dp==i){ _t[jia].furiten_flag++; continue; }if(_t[jia].fusipai[i]) _t[jia].furiten_flag++;}}else {_t[jia].helepai[_t[jia].helepai_ctr++]=i;if(dp==i) _t[jia].furiten_flag++;else if(_t[jia].fusipai[i]) _t[jia].furiten_flag++;}}else if(_gm_bukao(jia, -1)){}else {st[0]=st[1]=st[2]=st[3]=0;i=20; while(--i>=0){if((j=_t[jia].shupai[i] & 0x3f)<1 || j>0x37) continue;st[j >> 4]++;}i=4; j=k=0; while(--i>=0){if(!(st[i]=(c=st[i] % 3))) continue;if(c==1){ j++; continue; }k++;}if(((j==1 && k==0) || (j==0 && k==2))){c=-1;while((m=_t_tilesTable[++c])!=0){ m1=m & 0x3f;if(!st[m1 >> 4]) continue;if(_t_gamemode==_T_GAMEMODE_TAIWAN){j=0; k=20; while(--k>15){if((_t[jia].shupai[k] & 0x3f)==m1) ++j;}k=15; while(--k>=0){if((_t[jia].shupai[k] & 0x3f)==m1) ++j;}k=_t[jia].fulou_ctr*5; while(--k>=0){if((_t[jia].fuloupai[k] & 0x3f)==m1) ++j;}if(j>3) continue;}else if(_t_gamemode!=_T_GAMEMODE_GUOJI){j=0; k=15; while(--k>=0){if((_t[jia].shupai[k] & 0x3f)==m1) ++j;}k=_t[jia].fulou_ctr*5; while(--k>=0){if((_t[jia].fuloupai[k] & 0x3f)==m1) ++j;}if(j>3) continue;}else if(m & 0x40) continue;_t[jia].shupai[15]=m;if(_gm_zehelong(jia, -1)){_t[jia].helepai[_t[jia].helepai_ctr++]=m;if(m<0x38) _t[jia].helepai_ctr2++;continue;}if(_t_menzi1(jia)==0) continue;_t[jia].helepai[_t[jia].helepai_ctr++]=m;if(m<0x38) _t[jia].helepai_ctr2++;if(dp==m1) _t[jia].furiten_flag++;else if(_t[jia].fusipai[m1]) _t[jia].furiten_flag++;j=-1;while(++j<6){k=_t[jia].gangpai[j];if(k!=0){k|=0x80;l=5;while(--l>=0){if(_t_menzi[l]==k) break;}if(l<0){_t[jia].gangpai[j]=0;}}}_t_menzi2(jia);j=-1; while(++j<6){k=_t[jia].gangpai[j];if(k!=0){k|=0x80;l=5;while(--l>=0){if(_t_menzi[l]==k) break;}if(l<0){_t[jia].gangpai[j]=0;}}}}_t[jia].shupai[15]=0;}if(_t[jia].helepai_ctr<1){if(!_t_rule.qiduizi || _t[jia].fulou_ctr>0) return(0);_t_shupai_move(jia);if(_t_gamemode==_T_GAMEMODE_GUOJI){j=k=0; c=-1; i=0x38; while(--i>0){if(_t_bipai2[i]==1){ ++k; c=i; continue; }if(_t_bipai2[i]==2){ ++j; continue; }if(_t_bipai2[i]==3){ ++k; j++; c=i; continue; }if(_t_bipai2[i]==4){ j+=2; continue; }}}else {j=k=0; c=-1; i=0x38; while(--i>0){if(_t_bipai2[i]==1){ ++k; c=i; continue; }if(_t_bipai2[i]==2){ ++j; continue; }if(_t_bipai2[i]) return(0);}}if(j!=6 || k!=1) return(0);_t[jia].helepai[_t[jia].helepai_ctr++]=c;if(dp==c) _t[jia].furiten_flag++;else if(_t[jia].fusipai[c]) _t[jia].furiten_flag++;if(_t_gamemode!=_T_GAMEMODE_GUOJI){i=-1; while((m=_t_tilesTable[++i])!=0){if(m==c+0x40) break;}if(m) _t[jia].helepai[_t[jia].helepai_ctr++]=m;}}}if(_t[jia].helepai_ctr<1){_t[jia].shupai[15]=0;return(0);}var reach=_t[jia].reach_flag;var double_reach=_t[jia].double_reach_flag;var open_reach=_t[jia].open_reach_flag;var reach_ippatsu=_t[jia].reach_ippatsu_flag;if(reach_declare && _t[jia].menqian_flag==0 && _t_gamemode!=_T_GAMEMODE_ARSHIAR && _t_gamemode!=_T_GAMEMODE_GUOJI){_t[jia].reach_flag=1;if(_t_reach_mahjong_rule){if(!_t_yixun_flag) _t[jia].double_reach_flag=1;if(reach_declare>1 && _t_rule.open_reach) _t[jia].open_reach_flag=1;}}_gm_wufanhe_flag[jia]=0;_t[jia].reach_ippatsu_flag=0;_t_zampai_ctr++;var ronghe=_t_ronghe_flag; _t_ronghe_flag=1;var lingshang=_t_lingshang_flag; _t_lingshang_flag=0;var yixun=_t_yixun_flag; _t_yixun_flag=1;var qianggang=_t_qianggang_flag; _t_qianggang_flag=0;i=_t[jia].helepai_ctr;_t[jia].min_yifan=_t[jia].min_point=_t[jia].min_fan=0xffff;_t[jia].max_yifan=_t[jia].max_point=_t[jia].max_fan=-1;while(--i>=0){_t[jia].helepai_heleOK[i]=0;_t[jia].shupai[15]=_t[jia].helepai[i];j=_t_yaku_judge(jia, tmode, -1);_t[jia].helepai_wait[i]=_t_yj_wait;_t[jia].shupai[15]=0;if(j<0) continue;j1=j;if(_t[jia].reach_flag) j1++;if(_t[jia].double_reach_flag) j1++;if(_t[jia].open_reach_flag) j1++;if(j1>=_t_shibari) _t[jia].helepai_heleOK[i]=1;if(_t_yakufan_result<_t[jia].min_yifan) _t[jia].min_yifan=_t_yakufan_result;if(_t_yakufan_result>_t[jia].max_yifan) _t[jia].max_yifan=_t_yakufan_result;if(j<=0 || _t[jia].zampai_table[_t[jia].helepai[i]]<1) continue;if(j>_t[jia].max_point) _t[jia].max_point=j;if(j<_t[jia].min_point) _t[jia].min_point=j;if(_t_yakufan_ctr<_t[jia].min_fan) _t[jia].min_fan=_t_yakufan_ctr;if(_t_yakufan_ctr>_t[jia].max_fan) _t[jia].max_fan=_t_yakufan_ctr;}if(_t[jia].min_yifan>1024) _t[jia].min_yifan=-1;if(_t[jia].min_fan>1024) _t[jia].min_fan=-1;if(_t[jia].min_point>1024) _t[jia].min_point=-1;i=_t[jia].helepai_ctr;if(_t_rule.kuitan_sakizuke>1 && _t[jia].menqian_flag && _t[jia].min_yifan<_t_shibari){_t[jia].min_point=_t[jia].max_point=-1;j=_t[jia].helepai_ctr; while(--j>=0) _t[jia].helepai_heleOK[j]=0;}_t_ronghe_flag=ronghe;_t_lingshang_flag=lingshang;_t_yixun_flag=yixun;_t_qianggang_flag=qianggang;_t[jia].reach_flag=reach;_t[jia].double_reach_flag=double_reach;_t[jia].open_reach_flag=open_reach;_t[jia].reach_ippatsu_flag=reach_ippatsu;_t_zampai_ctr--;_t[jia].shupai[15]=0;return(i);}function _t_keishiki_tingpai_judge(jia, dapai){var i, m=-1;var j=-1;var k=-1;var l=-1;var c, m1, j1;var dp=dapai & 0x3f;var st=new Array(4);var tmode=1; if(!reach_declare && !_t[jia].reach_flag && !_t_manned[jia]) tmode=2;m=16; while(--m>-1){ _t[jia].helepai[m]=_t[jia].helepai_wait[m]=0; }m=6; while(--m>-1){ _t[jia].gangpai[m]=0; }_t_shupai_move(jia);m=-1; j=-1;while(++m<0x38){if(_t_bipai2[m]==3) _t[jia].gangpai[++j]=m;}_t[jia].helepai_ctr=0;_t[jia].helepai_ctr2=0;_t[jia].furiten_flag=0;if(_t_gamemode!=_T_GAMEMODE_TAIWAN && _t[jia].fulou_ctr<1 && (i=tingpai_guoshiwushuang())!=0){if(i<0){i=-7; while((i+=8)<0x30){_t[jia].helepai[_t[jia].helepai_ctr++]=i;if(dp==i){ _t[jia].furiten_flag++; continue; }if(_t[jia].fusipai[i]) _t[jia].furiten_flag++;}i=0x30; while(++i<0x38){_t[jia].helepai[_t[jia].helepai_ctr++]=i;if(dp==i){ _t[jia].furiten_flag++; continue; }if(_t[jia].fusipai[i]) _t[jia].furiten_flag++;}}else {_t[jia].helepai[_t[jia].helepai_ctr++]=i;if(dp==i) _t[jia].furiten_flag++;else if(_t[jia].fusipai[i]) _t[jia].furiten_flag++;}}else if(_gm_bukao(jia, -1)) ;else {st[0]=st[1]=st[2]=st[3]=0;i=20; while(--i>=0){if((j=_t[jia].shupai[i] & 0x3f)<1 || j>0x37) continue;st[j >> 4]++;}i=4; j=k=0; while(--i>=0){if(!(st[i]=(c=st[i] % 3))) continue;if(c==1){ j++; continue; }k++;}if(((j==1 && k==0) || (j==0 && k==2))){c=-1;while((m=_t_tilesTable[++c])!=0){ m1=m & 0x3f;if(!st[m1 >> 4]) continue;if(_t_gamemode==_T_GAMEMODE_TAIWAN){j=0; k=20; while(--k>15){if((_t[jia].shupai[k] & 0x3f)==m1) ++j;}k=15; while(--k>=0){if((_t[jia].shupai[k] & 0x3f)==m1) ++j;}k=_t[jia].fulou_ctr*5; while(--k>=0){if((_t[jia].fuloupai[k] & 0x3f)==m1) ++j;}if(j>3) continue;}else if(_t_gamemode!=_T_GAMEMODE_GUOJI){j=0; k=15; while(--k>=0){if((_t[jia].shupai[k] & 0x3f)==m1) ++j;}k=_t[jia].fulou_ctr*5; while(--k>=0){if((_t[jia].fuloupai[k] & 0x3f)==m1) ++j;}if(j>3) continue;}else if(m & 0x40) continue;_t[jia].shupai[15]=m;if(_gm_zehelong(jia, -1)){_t[jia].helepai[_t[jia].helepai_ctr++]=m;if(m<0x38) _t[jia].helepai_ctr2++;continue;}if(_t_menzi1(jia)==0) continue;_t[jia].helepai[_t[jia].helepai_ctr++]=m;if(m<0x38) _t[jia].helepai_ctr2++;if(dp==m1) _t[jia].furiten_flag++;else if(_t[jia].fusipai[m1]) _t[jia].furiten_flag++;j=-1;while(++j<6){k=_t[jia].gangpai[j];if(k!=0){k|=0x80;l=5;while(--l>=0){if(_t_menzi[l]==k) break;}if(l<0){_t[jia].gangpai[j]=0;}}}_t_menzi2(jia);j=-1; while(++j<6){k=_t[jia].gangpai[j];if(k!=0){k|=0x80;l=5;while(--l>=0){if(_t_menzi[l]==k) break;}if(l<0){_t[jia].gangpai[j]=0;}}}}_t[jia].shupai[15]=0;}if(_t[jia].helepai_ctr<1){if(!_t_rule.qiduizi || _t[jia].fulou_ctr>0) return(0);_t_shupai_move(jia);if(_t_gamemode==_T_GAMEMODE_GUOJI){j=k=0; c=-1; i=0x38; while(--i>0){if(_t_bipai2[i]==1){ ++k; c=i; continue; }if(_t_bipai2[i]==2){ ++j; continue; }if(_t_bipai2[i]==3){ ++k; j++; c=i; continue; }if(_t_bipai2[i]==4){ j+=2; continue; }}}else {j=k=0; c=-1; i=0x38; while(--i>0){if(_t_bipai2[i]==1){ ++k; c=i; continue; }if(_t_bipai2[i]==2){ ++j; continue; }if(_t_bipai2[i]) return(0);}}if(j!=6 || k!=1) return(0);_t[jia].helepai[_t[jia].helepai_ctr++]=c;if(dp==c) _t[jia].furiten_flag++;else if(_t[jia].fusipai[c]) _t[jia].furiten_flag++;if(_t_gamemode!=_T_GAMEMODE_GUOJI){i=-1; while((m=_t_tilesTable[++i])!=0){if(m==c+0x40) break;}if(m) _t[jia].helepai[_t[jia].helepai_ctr++]=m;}}_t[jia].shupai[15]=0;}if(_t[jia].helepai_ctr>0) return(1);return(0);}_gm_lipai_ptn=[0x012, 0x021, 0x102, 0x201, 0x120, 0x210];function _t_lipai(jia){var i=j=0, k, k1, k2;var buff=new Array(20);i=20; while(--i>=0) buff[i]=0;var gm_ptn=new Object(), gm_maxPtn=0, gm_ptnc=0;if(_t_gamemode==_T_GAMEMODE_GUOJI && ((jia==0 && _t[0].fulou_ctr<2) || _gm_zehelong_flag[jia])){var pt=new Array(0x30);var l, m;i=0x30; while(--i>=0) pt[i]=0;i=15; if(!_gm_zehelong_flag[jia]) --i;while(--i>0){if((j=_t[jia].shupai[i] & 0x3f)<1 || j>0x29) continue;pt[j]++;}l=m=-1; i=0;if(pt[0x01]>0) i++; if(pt[0x04]>0) i++; if(pt[0x07]>0) i++; j=i;if(pt[0x12]>0) i++; if(pt[0x15]>0) i++; if(pt[0x18]>0) i++;if(pt[0x23]>0) i++; if(pt[0x26]>0) i++; if(pt[0x29]>0) i++;if(i>l){ l=i; m=0x012; }gm_ptn[''+0x012]=i;i=j;if(pt[0x13]>0) i++; if(pt[0x16]>0) i++; if(pt[0x19]>0) i++;if(pt[0x22]>0) i++; if(pt[0x25]>0) i++; if(pt[0x28]>0) i++;if(i>l){ l=i; m=0x021; }gm_ptn[''+0x021]=i;i=0;if(pt[0x02]>0) i++; if(pt[0x05]>0) i++; if(pt[0x08]>0) i++; j=i;if(pt[0x11]>0) i++; if(pt[0x14]>0) i++; if(pt[0x17]>0) i++;if(pt[0x23]>0) i++; if(pt[0x26]>0) i++; if(pt[0x29]>0) i++;if(i>l){ l=i; m=0x102; }gm_ptn[''+0x102]=i;i=j;if(pt[0x13]>0) i++; if(pt[0x16]>0) i++; if(pt[0x19]>0) i++;if(pt[0x21]>0) i++; if(pt[0x24]>0) i++; if(pt[0x27]>0) i++;if(i>l){ l=i; m=0x201; }gm_ptn[''+0x201]=i;i=0;if(pt[0x03]>0) i++; if(pt[0x06]>0) i++; if(pt[0x09]>0) i++; j=i;if(pt[0x11]>0) i++; if(pt[0x14]>0) i++; if(pt[0x17]>0) i++;if(pt[0x22]>0) i++; if(pt[0x25]>0) i++; if(pt[0x28]>0) i++;if(i>l){ l=i; m=0x120; }gm_ptn[''+0x120]=i;i=j;if(pt[0x12]>0) i++; if(pt[0x15]>0) i++; if(pt[0x18]>0) i++;if(pt[0x21]>0) i++; if(pt[0x24]>0) i++; if(pt[0x27]>0) i++;if(i>l){ l=i; m=0x210; }gm_ptn[''+0x210]=i;if(!_gm_zehelong_flag[jia]){m=0;if(_gm_lipai_sw){do {if(++_gm_lipai_mode>=6){ _gm_lipai_mode=-1; break; }} while(gm_ptn[''+_gm_lipai_ptn[_gm_lipai_mode]]<l);}if(_gm_lipai_mode>-1) m=_gm_lipai_ptn[_gm_lipai_mode];}if(m>0){l=_t[jia].fulou_ctr*3+1;j=((m >> 4) & 0x30)+1; i=3; while(--i>=0){k=14; while(--k>0){if((_t[jia].shupai[k] & 0x3f)!=j) continue;buff[l++]=_t[jia].shupai[k]; _t[jia].shupai[k]=0;break;}j+=3;}j=(m & 0x30)+2; i=3; while(--i>=0){k=14; while(--k>0){if((_t[jia].shupai[k] & 0x3f)!=j) continue;buff[l++]=_t[jia].shupai[k]; _t[jia].shupai[k]=0;break;}j+=3;}j=((m << 4) & 0x30)+3; i=3; while(--i>=0){k=14; while(--k>0){if((_t[jia].shupai[k] & 0x3f)!=j) continue;buff[l++]=_t[jia].shupai[k]; _t[jia].shupai[k]=0;break;}j+=3;}i=20; while(--i>=0) pt[i]=0;i=0; while(++i<15){if((k=_t[jia].shupai[i])==0) continue;pt[l++]=k;}i=0; while(++i<13){k1=pt[i] & 0x7f; k2=pt[i+1] & 0x7f;if((k1 & 0x3f)>(k2 & 0x3f) ||    ((k1 & 0x3f)==(k2 & 0x3f) && k2<k1)){pt[i]=k2; pt[i+1]=k1;i=0;}}i=0; while(++i<18) _t[jia].shupai[i]=buff[i] || pt[i];return;}}if(_t_gamemode==_T_GAMEMODE_TAIWAN){j=_t[jia].fulou_ctr*3+1;i=16; while(++i<20){if((k=_t[jia].shupai[i])==0) continue;buff[j++]=k;}i=0; while(++i<15){if((k=_t[jia].shupai[i])==0) continue;buff[j++]=k;}if(_t[jia].open || _t_open_mode || jia==0){i=0; while(++i<16){k1=buff[i] & 0x7f; k2=buff[i+1] & 0x7f;if((k1 & 0x3f)>(k2 & 0x3f) ||    ((k1 & 0x3f)==(k2 & 0x3f) && k2<k1)){buff[i]=k2; buff[i+1]=k1;i=0;}}}_t[jia].shupai[17]=buff[1];_t[jia].shupai[18]=buff[2];_t[jia].shupai[19]=buff[3];i=3; while(++i<18) _t[jia].shupai[i-3]=buff[i];return;}j=_t[jia].fulou_ctr*3+1;i=0; while(++i<15){if((k=_t[jia].shupai[i])==0) continue;buff[j++]=k;}if(_t[jia].open || _t_open_mode || jia==0){i=0; while(++i<13){k1=buff[i] & 0x7f; k2=buff[i+1] & 0x7f;if((k1 & 0x3f)>(k2 & 0x3f) ||    ((k1 & 0x3f)==(k2 & 0x3f) && k2<k1)){buff[i]=k2; buff[i+1]=k1;i=0;}}}i=0; while(++i<18) _t[jia].shupai[i]=buff[i];return;}_t_yakufan_result=0;function _t_yaku_judge(jia, mode, dpai){_t_dandiao=0;try {if(_t_gamemode==_T_GAMEMODE_ARSHIAR || _t_gamemode==_T_GAMEMODE_BOO){var i=_t_yaku_judge_arshiar(jia, mode);return(i);}if(_t_gamemode==_T_GAMEMODE_BEINUKI){var i=_t_yaku_judge_beinuki(jia, mode);return(i);}if(_t_gamemode==_T_GAMEMODE_TAIWAN){var i=_tm_yaku_judge(jia, 0, mode);return(i);}if(_t_gamemode==_T_GAMEMODE_GUOJI){var i=_gm_yaku_judge(jia, mode, dpai);return(i);}var i=_t_yaku_judge_reach(jia, mode);return(i);} catch(e){console.log(e);return(0);}}_t_yj_qiduizi=0;function _t_yaku_judge_reach(jia, mode){var i, j;var menzi=-1;var str, v;var yaku_menzi_fu=new Array(6);var yaku_menzi=new Array(6);var yaku_shupai2=new Array(16);var yaku_shupai_fu2=new Array(18);var yaku_name=new Array(20);var yaku_fansu=new Array(20);var yaku_name_ctr=0;var yakuman_name=new Array(10);var yakuman_name_ctr=0;var fu_ctr=0;var fan_ctr=0;var fan_ctr2=0;var yakufan_ctr=0;var yaku_fu_guide2='';_t_fu_guide='';_t_yj_qiduizi=0;_t_hp=-1;var yaku_shupai2=new Array(20);var mz=new Array(6);j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;j=-1; while(++j<20) _t_y_shupai[j]=_t[jia].shupai[j];var noMenqianqing=0;_t_babaojia=-1;_t_hp=_t[jia].shupai[15] & 0x3f;if(_t_hp==0) _t_hp=_t[jia].shupai[14] & 0x3f;_t_shupai_move(jia);j=-1; while(++j<20) yaku_shupai2[j]=_t_y_shupai[j]=_t[jia].shupai[j];j=-1; while(++j<10) yaku_shupai_fu2[j]=_t_y_shupai_fu[j]=-1;_t_bm_yakuman_jia=-1;_t_yaku_name_ctr=0;_t_yakuman_name_ctr=0;_t_fu=0;_t_fan=0;_t_yakufan_ctr=0;_t_yaku_manguan='';_t_yakufan_result=0;_t_yaku_result_point=0;_t_yaku_result_point1=0;_t_yaku_result_point2=0;_t_shisanbuta_flag=0;_t_yaku_result_point=0;_t_yaku_dora_ctr=0;_t_yaku_pay_of_sanjia=_t_yaku_pay_of_zhuangjia=0;_t_dandiao=0;_t_chip_detail.yakibuta=_t_chip_detail.gang=_t_chip_detail.ippatsu=_t_chip_detail.uradora=_t_chip_detail.akapai=_t_chip_detail.hanapai=_t_chip_detail.yakuman=0;_t_yf_daisharin=0;if(mode==0 && _t_yaojiu_furikiri>-1){if(_t_lang=='en'){str='All Terminals and Honours Discard';if(!_t_rule.unlimited){_t_yakuman_name[_t_yakuman_name_ctr++]='All Terminals';_t_yakuman_name[_t_yakuman_name_ctr++]='and Honours Discard';_t_yakufan_ctr+=128;}else {_t_yakuman_name[_t_yakuman_name_ctr++]='All Terminals';_t_yakuman_name[_t_yakuman_name_ctr]='and Honours Discard';_t_yaku_fansu[_t_yaku_name_ctr++]=5;_t_yakufan_ctr+=5;_t_fu=30;}}else {if(!_t_rule.unlimited){_t_yakuman_name[_t_yakuman_name_ctr++]='幺九振切';_t_yakufan_ctr+=128;}else {_t_yaku_name[_t_yaku_name_ctr]='幺九振切';_t_yaku_fansu[_t_yaku_name_ctr++]=5;_t_yakufan_ctr+=5;_t_fu=30;}}i=_t_common_yaku_reach2(jia, mode, -1, 1);return(i);}_t_hp=_t[jia].shupai[14] & 0x3f;if(_t_hp<1) _t_hp=_t[jia].shupai[15] & 0x3f;if(mode<3 && _t_guoshiwushuang(jia)!=0){_t_common_yaku_reach(jia, mode);i=-1; while(++i<_t_yaku_name_common_ctr){str=_t_yaku_name_common[i]; v=_t_yaku_fansu_common[i];_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}i=-1; while(++i<_t_yakuman_name_common_ctr){str=_t_yakuman_name_common[i];_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;}_t_fan=_t_fan_common;_t_fu=30;str='国士無双';if(_t_lang=='en') str='Thirteen Orphans';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;i=0x40; while(--i>=0) _t_XOO[i]=_t_OXO[i]=_t_OOX[i]=_t_OOO[i]=_t_OOOO[i]=0;_t_yj_qiduizi=1;i=_t_common_yaku_reach2(jia, mode, _t_hp, 0);return(i);}if(mode==0 && _t_shisanbuta(jia)!=0 && _t_rule.yaku.shisanbuta){str='十三不搭';if(_t_lang=='en') str='Thirteen Tiles Isolated';if(!_t_rule.unlimited){_t_yakuman_name[_t_yakuman_name_ctr++]=str;_t_yakufan_ctr+=128;_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=128;}else {_t_yaku_name[_t_yaku_name_ctr]=str;_t_yaku_fansu[_t_yaku_name_ctr++]=5;_t_yakufan_ctr+=5;_t_fu=30;}i=_t_common_yaku_reach2(jia, mode, -1, 2);return(i);}_t_common_yaku_reach(jia, mode);if(_t_menzi1(jia)!=0){menzi=-1; while(++menzi<3){_t_yaku_reach_menziType(jia, mode);if(menzi>1) break;if(menzi==0){if(mode<2){yaku_fu_guide2=_t_fu_guide;i=16; while(--i>=0) yaku_shupai2[i]=_t_y_shupai[i];i=10; while(--i>=0) yaku_shupai_fu2[i]=_t_y_shupai_fu[i];i=20; while(--i>=0){yaku_name[i]=_t_yaku_name[i];yaku_fansu[i]=_t_yaku_fansu[i];}i=10; while(--i>=0) yakuman_name[i]=_t_yakuman_name[i];yaku_name_ctr=_t_yaku_name_ctr;yakuman_name_ctr=_t_yakuman_name_ctr;}fu_ctr=_t_fu;yakufan_ctr=_t_yakufan_ctr;fan_ctr=_t_fan; _t_fan=0;if(mode>1){_t_menzi3(jia); menzi=1; continue;}_t_menzi2(jia);continue;}if(yakufan_ctr<_t_yakufan_ctr || (yakufan_ctr==_t_yakufan_ctr && fu_ctr<_t_fu)){if(mode<2){yaku_fu_guide2=_t_fu_guide;i=16; while(--i>=0) yaku_shupai2[i]=_t_y_shupai[i];i=10; while(--i>=0) yaku_shupai_fu2[i]=_t_y_shupai_fu[i];i=20; while(--i>=0){yaku_name[i]=_t_yaku_name[i];yaku_fansu[i]=_t_yaku_fansu[i];}i=10; while(--i>=0){yakuman_name[i]=_t_yakuman_name[i];}yaku_name_ctr=_t_yaku_name_ctr;yakuman_name_ctr=_t_yakuman_name_ctr;}fu_ctr=_t_fu;yakufan_ctr=_t_yakufan_ctr;fan_ctr=_t_fan; _t_fan=0;}_t_menzi3(jia);continue;}if(yakufan_ctr>_t_yakufan_ctr || (yakufan_ctr==_t_yakufan_ctr && fu_ctr>_t_fu)){if(mode<2){_t_fu_guide=yaku_fu_guide2;i=16; while(--i>=0) _t_y_shupai[i]=yaku_shupai2[i];i=10; while(--i>=0) _t_y_shupai_fu[i]=yaku_shupai_fu2[i];i=20; while(--i>=0){_t_yaku_name[i]=yaku_name[i];_t_yaku_fansu[i]=yaku_fansu[i];}i=10; while(--i>=0) _t_yakuman_name[i]=yakuman_name[i];_t_yaku_name_ctr=yaku_name_ctr;_t_yakuman_name_ctr=yakuman_name_ctr;}_t_fu=fu_ctr;_t_yakufan_ctr=yakufan_ctr;_t_fan=fan_ctr;}}else if(_t_qiduizi(jia)){_t_yj_qiduizi=1;_t_yaku_reach_qiduizi(jia, mode);}else return(-1);i=_t_common_yaku_reach2(jia, mode, _t_hp, 0);return(i);}function _t_yaku_reach_qiduizi(jia, mode){var a, b, c, i, j=-1, k=0, l, m, n, o, v, x, y, z;var str='';var ar=new Array(0x40);var dv=0;var tb=new Array(20);var noYaojiu=0;var noYaku=0;_t_yakufan_ctr=0;_t_yaku_name_ctr=0;_t_fu=0;_t_fu_guide='';_t_yakuman_name_ctr=0;_t_shupai_move(jia);if(_t[jia].fulou_ctr>0) return(0);i=0x40; while(--i>=0){if(_t_bipai2[i] & 1) return(0);}i=-1; while(++i<_t_yaku_name_common_ctr){str=_t_yaku_name_common[i]; v=_t_yaku_fansu_common[i];_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}i=-1; while(++i<_t_yakuman_name_common_ctr){str=_t_yakuman_name_common[i];_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;}_t_fan=_t_fan_common;i=20; l=0x30; j=k=0; while(--i>=0){if((m=_t[jia].shupai[i] & 0x3f)<1) continue;if(m>0x30){ j++; k++; continue; }if(l>=0x30) l=m;if(!((m ^ l) & 0x30)) k++;}if(j>13){str='字一色';if(_t_lang=='en') str='All Honors';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;noYaku=noYaojiu=1;}else {if(k>13){if(j>0){v=3; str='混一色';if(_t_lang=='en') str='Half Flush';}else {v=6; str='清一色';if(_t_lang=='en') str='Full Flush';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}if(noYaojiu<1){var zipai=0, yao=0;i=20;while(--i>=0){j=_t[jia].shupai[i] & 0x3f;if(j<1 || j>0x37) continue;if(j>0x30){ yao++; zipai++; continue; }if(!((j-1) & 7)) ++yao;}if(yao>12){str='混老頭'; v=2;if(_t_lang=='en') str='All Terminals and Honours';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if(yao<1){str='断'+String.fromCharCode(20040)+'九'; v=1;if(_t_lang=='en') str='All Simples';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}_t_fu=_t_rule.qiduizi_fu;if(!noYaku){str='七対子'; v=2;if(_t_lang=='en') str='Seven Pairs';if(_t_fu==50) --v;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}if(!mode){i=20; while(--i>=0) tb[i]=_t[jia].shupai[i];tb[14]=tb[15]=0;k=0; i=0; while(++i<14){if((tb[i] & 0x3f)==_t_hp){_t_y_shupai[13]=tb[i];tb[i]=0; break;}}i=0; while(++i<20){if(tb[i]) _t_y_shupai[++k]=tb[i];}_t_y_shupai[14]=_t[jia].shupai[14];_t_y_shupai[15]=_t[jia].shupai[15];return(1);}return(1);}function _t_yaku_reach_menziType(jia, mode){var a, b, c, i, j=-1, k=0, l, m, n, o, v, x, y, z;var str='';var ar=new Array(0x40);var zt=new Array(0x40);_t_dz=0;_t_shupai_move(jia);var noDuidui=0;var no3Lianke=0;var no3Fengzi=0;var noQuantai=0;var no2beikou=0;var tianhe=0;if(mode==0 && !_t_started_flag && !_t_ronghe_flag) tianhe=1;_t_yakufan_ctr=0;_t_yaku_name_ctr=0;_t_fu=0;_t_fu_guide='';_t_yakuman_name_ctr=0;var anke=0;var angang=0;var liangmen=-1;var gangzi=0;var qianzhang=-1;var bianzhang=-1;var dandiao=-1;var shuangpeng=-1;var yaku_menzi=[0, 0, 0, 0, 0, 0];var yaku_menzi_fu=[0, 0, 0, 0, 0, 0];i=-1; while(++i<6) yaku_menzi_fu[i]=yaku_menzi[i]=-1;j=-1; while(++j<4){if(_t_menzi[j+1]==0) break;if(_t_menzi[j]>_t_menzi[j+1]){k=_t_menzi[j]; _t_menzi[j]=_t_menzi[j+1]; _t_menzi[j+1]=k;j=-1;}}_t_fu=0;var fu2=0;var shz1=shz2=shz3=kez1=0;j=-1; while(++j<6){if((i=_t_menzi[j])<1) break;yaku_menzi_fu[j]=0; yaku_menzi[j]=i;if(i<0x30){if(i==_t_hp){if(!shz1){qianzhang=j;shz1=1;}continue;}if(i-1==_t_hp){if(!shz2){if((i & 0x0f)==8) bianzhang=j; else liangmen=j;shz2=1;continue;}}else if(i+1==_t_hp){if(!shz3){if((i & 0x0f)==2) bianzhang=j; else liangmen=j;shz3=1;continue;}}continue;}if(i<0xc0){i &= 0x3f; ++anke;k=4; if(i>0x30 || !((i-1) & 7)) k=8;if(i==_t_hp){if(_t_bipai2[_t_hp]<4){shuangpeng=j;if(_t_ronghe_flag){ --anke; k >>= 1; }kez1=1;}}yaku_menzi_fu[j]=k; _t_fu+=k;continue;}k=0;if((i &= 0x3f)==_t_hp){dandiao=j;}if(i>0x34 || _t_zhuangfeng[0]==i || _t_zhuangfeng[1]==i) k=2;if(_t[jia].menfeng==i) k+=2;yaku_menzi_fu[j]=k; fu2+=k;_t_dz=i;}j=-1; k=-5; i=4;while(++j<_t[jia].fulou_ctr){k+=5; l=_t[jia].fuloupai[k] & 0x3f;if(l!=(_t[jia].fuloupai[k+1] & 0x3f)){l=Math.floor(l+(_t[jia].fuloupai[k+1] & 0x3f)+(_t[jia].fuloupai[k+2] & 0x3f))/3;_t_menzi[i--]=l;continue;}_t_menzi[i--]=l | 0x80; m=2;if(_t[jia].fuloupai[k+4]){ m=16; ++anke; ++gangzi; ++angang; }if(_t[jia].fuloupai[k+3]){ m=8; ++gangzi; }if(l>0x30 || !((l-1) & 7)) m+=m;_t_fu+=m; _t[jia].fulou_fu[j]=m;}if(_t_rule.chip.gang) _t_chip_detail.gang=gangzi;if(mode<2){i=-1; while(++i<_t_yaku_name_common_ctr){str=_t_yaku_name_common[i]; v=_t_yaku_fansu_common[i];_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v;;}i=-1; while(++i<_t_yakuman_name_common_ctr){str=_t_yakuman_name_common[i];_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;}}_t_yakufan_ctr=_t_yakufan_ctr_common;_t_fan=_t_fan_common;if(_t_fu+fu2==0 && liangmen>-1 &&(_t_rule.fulou_pinghe || !_t[jia].menqian_flag) &&        (_t_rule.mo8pinghe || _t_ronghe_flag || mode)){str='平和'; v=1;if(_t_lang=='en') str='Pinfu';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;dandiao=bianzhang=qianzhang=shuangpeng=-1;_t_dandiao=0;if(_t_lang=='en'){_t_fu_guide='For Pung/Kong            0\n';if(_t_ronghe_flag==0){ _t_fu_guide+='Self-Draw                0\n            (due to Pinfu)\n'; }}else {_t_fu_guide='門子     0符\n両門     0符\n';if(_t_ronghe_flag==0){ _t_fu_guide+='摸和\n(平和)   0符\n'; }else {_t_fu_guide+='栄和     0符\n';}}}else {_t_dandiao=0; if(dandiao>-1 && liangmen<0 && (qianzhang>-1 || bianzhang>-1)) _t_dandiao=1;if(_t_lang=='en'){if(_t_fu>99){ _t_fu_guide='For Pung/Kong          '+_t_fu+'\n'; }else if(_t_fu>9){ _t_fu_guide='For Pung/Kong           '+_t_fu+'\n'; }else { _t_fu_guide='For Pung/Kong            '+_t_fu+'\n'; }_t_fu+=fu2;if(fu2>0){ _t_fu_guide+='For Pair                 '+fu2+'\n'; }if(dandiao>-1){ _t_fu+=2; _t_fu_guide+=       'Single Wait              2\n'; }else if(bianzhang>-1){ _t_fu+=2; _t_fu_guide+='Edge Wait                2\n'; }else if(qianzhang>-1){ _t_fu+=2; _t_fu_guide+='Closed Wait              2\n'; }if(_t_ronghe_flag==0){ _t_fu+=2; _t_fu_guide+='Self-Draw                2\n'; }if(_t_fu==0){ _t_fu=10; _t_fu_guide+=         'Open Pinfu               2\n'; }}else {_t_fu+=fu2;if(_t_fu>99){ _t_fu_guide='門子   '+_t_fu+'符\n'; }else if(_t_fu>9){ _t_fu_guide='門子    '+_t_fu+'符\n'; }else { _t_fu_guide='門子     '+_t_fu+'符\n'; }if(dandiao>-1){ _t_fu+=2; _t_fu_guide+='単吊     2符\n'; }else if(bianzhang>-1){ _t_fu+=2; _t_fu_guide+='辺張     2符\n'; }else if(qianzhang>-1){ _t_fu+=2; _t_fu_guide+='嵌張     2符\n'; }else if(liangmen>-1){ _t_fu_guide+='両門     0符\n'; }else { _t_fu_guide+='双ポン   0符\n'; }if(_t_ronghe_flag==0){ _t_fu+=2; _t_fu_guide+='摸和     2符\n'; }else { _t_fu_guide+='栄和     0符\n'; }if(_t_fu==0){ _t_fu=10; _t_fu_guide+='喰い平和10符\n'; }}}m=20; if(!_t[jia].menqian_flag && _t_ronghe_flag!=0) m=30;_t_fu+=m;if(_t_lang=='en'){_t_fu_guide='Minipoints:\nFor Winning             '+m+'\n'+_t_fu_guide;if(_t_fu>99) _t_fu_guide+='Total Minipoints       '+_t_fu+'\n';else _t_fu_guide+='\nTotal Minipoints        '+_t_fu+'\n';}else {if(_t_fu>99) _t_fu_guide='副底    '+m+'符\n'+_t_fu_guide+'\n合計   '+_t_fu+'符';else _t_fu_guide='副底    '+m+'符\n'+_t_fu_guide+'\n合計    '+_t_fu+'符';}if(!mode) yj_menzisort(jia, yaku_menzi, yaku_menzi_fu, dandiao, bianzhang, qianzhang, shuangpeng, liangmen);if(bianzhang>-1) bianzhang=_t_menzi[bianzhang];if(qianzhang>-1) qianzhang=_t_menzi[qianzhang];j=-1; while(++j<4){if(_t_menzi[j+1]==0) break;if(_t_menzi[j]>_t_menzi[j+1]){k=_t_menzi[j]; _t_menzi[j]=_t_menzi[j+1]; _t_menzi[j+1]=k;j=-1;}}z=0;if(_t_menzi[0]>0xb0 && _t_dz>0x30){str='字一色';if(_t_lang=='en') str='All Honors';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];noDuidui=noQuantai=1;z=1;}else if(_t[jia].fulou_ctr<1 && (i=_t_hp & 0x30)<0x30 &&    _t_bipai2[i+1]>2 && _t_bipai2[i+2]>0 && _t_bipai2[i+3]>0 && _t_bipai2[i+4]>0 && _t_bipai2[i+5]>0 && _t_bipai2[i+6]>0 && _t_bipai2[i+7]>0 && _t_bipai2[i+8]>0 && _t_bipai2[i+9]>2){str='九蓮宝燈';if(_t_lang=='en') str='Nine Gates';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t_gamemode!=_T_GAMEMODE_PENGLI && !_t_rule.unlimited){j=-1; while(++j<20) _t_y_shupai[j]=_t[jia].shupai[j];}z=1;}else if(_t[jia].fulou_ctr<1 && (_t_hp & 0x30)==0x10 && _t_menzi[0]==_t_menzi[1] && _t_menzi[0]+3==_t_menzi[2] && _t_menzi[2]==_t_menzi[3]  && _t_dz+2==_t_menzi[0]){if(_t_rule.yaku.daisharin){str='大車輪';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;j=-1; while(++j<20) _t_y_shupai[j]=_t[jia].shupai[j];if(_t_gamemode!=_T_GAMEMODE_PENGLI && !_t_rule.unlimited){j=-1; while(++j<20) _t_y_shupai[j]=_t[jia].shupai[j];}no2beikou=1;z=1;}}else {l=0; i=4; while(--i>=0){j=(_t_menzi[i] & 0x3f)-0x20; if(j<0 || j>10) break;l+=j*3;}if(i<0 && (j=_t_dz-0x20)>0 && j<10){l+=j+j;k=-5; i=_t[jia].fulou_ctr; while(--i>=0){k+=5;if((j=_t[jia].fuloupai[k+4] & 0x3f)>0 || (j=_t[jia].fuloupai[k+3] & 0x3f)>0) l+=j & 0x0f;}if(l>99 && _t_rule.yaku.hyakumangoku){str='百万石';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;z++;}}}if(!z){i=5; k=0; while(--i>=0){if((j=_t_menzi[i])<0x30){if(j==0x03) ++k;continue;}if((j &= 0x3f)==0x36 || j==0x03 || !(j & 0x31)) ++k;}if(k>4){str='緑一色';if(_t_lang=='en') str='All Green';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];z=1;}}if(!z){i=4; k=0; while(--i>=0){if((j=_t_menzi[i])<0x30){if(j==0x03) ++k;continue;}if((j &= 0x3f)==0x03 || !(j & 0x31)) ++k;}if(k>3 && _t_dz==0x37 && _t_rule.yaku.wanlusouzhoungyidianhong){str='万緑叢中一点紅';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];z=1;}}if(!z){i=5; while(--i>=0){if((j=_t_menzi[i])<0x30) break;if((j &= 0x3f)==0x37) continue;if((j & 0x30) || j==0x03) break;if(!(j & 1)) break;}if(i<0 && _t_rule.yaku.benikujaku){str='紅孔雀';if(_t_lang=='en') str='All Red';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];z=1;}}if(!z){i=4; j=0x30; l=0; while(--i>=0){if((k=_t_menzi[i] & 0x30)>0x20){ l++; continue; }if(j==0x30){ j=k; continue; }if(j!=k) break;}if(i<0 && j<0x30){v=1; if(_t_dz>0x30 || !((_t_dz ^ j) & 0x30)){if(l>0 || _t_dz>0x30){v=3; str='混一色';if(_t_lang=='en') str='Half Flush';}else {v=6; str='清一色';if(_t_lang=='en') str='Full Flush';}if(_t[jia].menqian_flag) --v;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}}var dui=yao=zipai=0;i=5; while(--i>=0){j=_t_menzi[i];if(j<1) continue;if(j<0x30){if(!(j & 5)) yao++;continue;}if(j<0xc0) dui++;if((j & 0x3f)>0x30){ zipai++; yao++; continue; }if(!((j-1) & 7)) yao++;}if(!noQuantai && yao>4 && dui>3){if(zipai>0){str='混老頭'; v=2;if(_t_lang=='en') str='All Terminals and Honours';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else {str='清老頭';if(_t_lang=='en') str='All Terminals';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;noDuidui=1;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];}noQuantai=1;}if(anke>3){str='四暗刻';if(_t_lang=='en') str='All Closed Triplets';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;noDuidui=1;}if(gangzi>3){str='四槓子';if(_t_lang=='en') str='Four Kongs';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;_t_babaojia=_t_sigangzi_babao;noDuidui=1;}if(_t_menzi[0]==0x91 && _t_menzi[1]==0x95 && _t_menzi[3]==0xb5 && (_t_menzi[2] & 0x3f)==_t[jia].menfeng){str='風花雪月';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;noDuidui=1;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];}else if((i=_t_menzi[0])>0x80 && (j=_t_menzi[3])<0xb0 && i+3==j){if(_t_rule.yaku.silianke){str='四連刻';if(_t_lang=='en') str='Four Step Pung';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];noDuidui=1;no3Lianke=1;}}else if(_t_menzi[0]>0xb0 && _t_menzi[3]<0xb5){str='四喜和';if(_t_lang=='en') str='Four Winds';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];no3Fengzi=1;}else if(!noDuidui && _t_menzi[0]>0x80){str='対々和'; v=2;if(_t_lang=='en') str='All Pungs';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}if(anke==3){str='三暗刻'; v=2;if(_t_lang=='en') str='Three Concealed Pungs';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}if(!no3Fengzi){if(((_t_menzi[0]>0xb0 && _t_menzi[2]<0xb5) || (_t_menzi[1]>0xb0 && _t_menzi[3]<0xb5))){if(_t_dz>0x30 && _t_dz<0x35){str='四喜和';if(_t_lang=='en') str='Four Winds';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;}else {if(_t_rule.yaku.sanfengzi){str='三風子'; v=2;if(_t_lang=='en') str='Three Winds';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}}i=-1; while(++i<4){if((k=_t_menzi[i] & 0x3f)<0x30) continue;v=0;if(k==_t_zhuangfeng[0] || k==_t_zhuangfeng[1]) ++v;if(k==_t[jia].menfeng) ++v;if(v<1) continue;if(_t_lang=='en'){str='East';if(k==0x32) str='South';if(k==0x33) str='West';if(k==0x34) str='North';str+=' Wind Pung';}else {str='東';if(k==0x32) str='南';if(k==0x33) str='西';if(k==0x34) str='北';if(v>1) str+='連';str+='風';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}if(_t_menzi[1]>0xb4){str='大三元';if(_t_lang=='en') str='Big Three Dragons';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;k=-5; i=-1; j=3; while(++i<_t[jia].fulou_ctr){k+=5;if((_t[jia].fuloupai[k] & 0x3f)>0x34 && --j==0) _t_babaojia=_t[jia].fulou_dajia[i];}}else if(_t_menzi[2]>0xb4 && _t_dz>0x34){str='小三元'; v=4;if(_t_lang=='en') str='Little Three Dragons';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else {v=1; i=-1; while(++i<4){if((k=_t_menzi[i] & 0x3f)<0x35) continue;if(_t_lang=='en'){str='Red';if(k==0x36) str='Green';if(k==0x35) str='White';str+=' Dragon Pung';}else {str='紅中';if(k==0x36) str='緑発';if(k==0x35) str='白板';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}if(gangzi==3){str='三槓子'; v=2;if(_t_lang=='en') str='Three Kongs';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}if(yao<1){if(!_t[jia].menqian_flag || _t_rule.kuitan_sakizuke>-1){str='断'+String.fromCharCode(20040)+'九'; v=1;if(_t_lang=='en') str='All Simples';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;if(_t[jia].menqian_flag && _t_rule.kuitan_sakizuke) ++_t_fan;}}else if(!noQuantai && yao>4){str='混全帯'+String.fromCharCode(20040); v=2;if(_t_lang=='en') str='Outside Hand';if(zipai<1){str='純全帯'+String.fromCharCode(20040); v=3;if(_t_lang=='en') str='Terminals in All Sets';}if(_t[jia].menqian_flag) --v;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}if(!no3Lianke &&(((i=_t_menzi[0])>0x80 && (j=_t_menzi[2])<0xb0 && i+2==j) ||        ((i=_t_menzi[1])>0x80 && (j=_t_menzi[3])<0xb0 && i+2==j))){if(_t_rule.yaku.sanlianke){str='三連刻'; v=2;if(_t_lang=='en') str='Three Step Pung';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}l=1;}else if(((i=_t_menzi[0])+3==_t_menzi[1] && (i+6==_t_menzi[2] || i+6==_t_menzi[3])) ||    ((i=_t_menzi[3])-3==_t_menzi[2] && (i-6==_t_menzi[1] || i-6==_t_menzi[0]))){    shyk=1;if(i<0x80){str='一気通貫'; v=2;if(_t_lang=='en') str='Pure Straight';if(_t[jia].menqian_flag) --v;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if(i<0xb0){str='筋牌刻'; v=2;if(_t_lang=='en') str='Three 3-step Pungs';if(_t_rule.yaku.sujipaike){_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}}else if(((l=_t_menzi[0])+0x10==_t_menzi[1] && (l+0x20==_t_menzi[2] || l+0x20==_t_menzi[3]) && !(l & 0x30)) ||    ((((j=_t_menzi[3]) & 0x30)<0x30) && j-0x10==_t_menzi[2] && (j-0x20==(l=_t_menzi[1]) || j-0x20==(l=_t_menzi[0])))){    shyk=1;if(l & 0x80){str='三色同刻'; v=2;if(_t_lang=='en') str='Triple Pung';}else {str='三色同順'; v=2;if(_t_lang=='en') str='Mixed Triple Chow';if(_t[jia].menqian_flag) --v;}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if(_t_menzi[3]<0x30 &&    _t_menzi[0]+3==_t_menzi[1] &&    _t_menzi[0]+0x20==_t_menzi[2] &&    _t_menzi[1]+0x20==_t_menzi[3] &&    (_t_menzi[4] & 0x30)==0x10){if((k=_t_rule.yaku.shuanglongzhengzhu)>0){str='双竜争珠'; v=5;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}if(_t_menzi[0]==_t_menzi[3] && _t_rule.yaku.yisesishun){str='一色四順';if(_t_lang=='en') str='Pure Quad Chows';_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;if(_t[jia].fulou_ctr==4) _t_babaojia=_t[jia].fulou_dajia[3];}else if(!no2beikou && _t_menzi[0]==_t_menzi[1] && _t_menzi[2]==_t_menzi[3] && !_t[jia].menqian_flag){str='両盃口'; v=3;if(_t_lang=='en') str='Twice Pure Double Chows';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if((_t_menzi[0]==_t_menzi[2] ||_t_menzi[1]==_t_menzi[3]) && _t_rule.yaku.yisesanshun){str='一色三順'; v=2;if(_t_lang=='en') str='Pure Triple Chows';if(_t[jia].menqian_flag) --v;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if((j=_t_menzi[1])==_t_menzi[0] || j==_t_menzi[2] || (j=_t_menzi[2])==_t_menzi[3]){if(!_t[jia].menqian_flag){str='一盃口'; v=1;if(_t_lang=='en') str='Pure Double Chows';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}if(_t_menzi[0]>0x80 && !(_t_menzi[0] & 0x30) && (_t_menzi[1] & 0x30)==0x10 && (_t_menzi[2] & 0x30)==0x20 && _t_menzi[3]>0xb4 && _t_dz==_t[jia].menfeng && _t_rule.yaku.wumenqi){str='五門斎'; v=5;if(_t_lang=='en') str='Five Types';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}j=-1; k=-5; l=0;while(++j<_t[jia].fulou_ctr){k+=5;if(_t[jia].fuloupai[k+4]) continue;i=_t[jia].fuloupai[k] & 0x3f; m=0;if(i>0x34 || i==_t_zhuangfeng[0] || i==_t_zhuangfeng[1]) ++m;if(i==_t[jia].menfeng) ++m;if(m==0 && _t_rule.kuitan_sakizuke>1){ l=1; continue; }if(l) _t_fan+=m;}i=_t_hp; m=0;if(i>0x34 || i==_t_zhuangfeng[0] || i==_t_zhuangfeng[1]) ++m;if(i==_t[jia].menfeng) ++m;if((_t_menzi[4] & 0x3f)!=i && l!=0) _t_fan+=m;return(1);}_t_renhe_flag=0;function _t_common_yaku_reach (jia, mode){var p, i, j, k, l, c=4, pcode=(_t[jia].shupai[14] || _t[jia].shupai[15]) & 0x3f;var tb=new Array(0x40);var sz= tz= wz= fp= sy=0, laotou=1, duanyao=1, green=1;var str, strE, v;_t_yaku_name_common_ctr=0;_t_yakuman_name_common_ctr=0;_t_fan_common=0;_t_yakufan_ctr_common=0;_t_renhe_flag=0;if(mode==0 && !_t_yixun_flag && (!_t[jia].nukidora_ctr || _t[jia].nukidora[0]>0x37)){_t_renhe_flag=-1;str='地和'; strE='Blessing of Earth';if(!_t_started_flag){if(!_t_ronghe_flag){ str='天和'; strE='Blessing of Heaven'; }}else {if(_t_ronghe_flag) _t_renhe_flag=1;}if(_t_renhe_flag<1){if(_t_lang=='en') str=strE;_t_yakuman_name_common[_t_yakuman_name_common_ctr++]=str; _t_yakufan_ctr_common+=256;}}if(_t_renhe_flag>-1){if(_t[jia].reach_flag!=0){if(_t[jia].open_reach_flag){str='公開立直'; v=1;if(_t_lang=='en') str='Opened Riichi';_t_yaku_name_common[_t_yaku_name_common_ctr]=str; _t_yaku_fansu_common[_t_yaku_name_common_ctr++]=v; _t_yakufan_ctr_common+=v;}str='立直'; v=1;if(_t_lang=='en') str='Riichi';if(_t[jia].double_reach_flag){str='二重立直'; v=2;if(_t_lang=='en') str='Daburu Riichi';}_t_yaku_name_common[_t_yaku_name_common_ctr]=str; _t_yaku_fansu_common[_t_yaku_name_common_ctr++]=v; _t_yakufan_ctr_common+=v;if(_t[jia].reach_ippatsu_flag!=0 && mode==0){str='一発'; v=1;if(_t_lang=='en'){str='Riichi Ippatsu';}_t_yaku_name_common[_t_yaku_name_common_ctr]=str; _t_yaku_fansu_common[_t_yaku_name_common_ctr++]=v; _t_yakufan_ctr_common+=v;_t_fan_common+=v;}}if(_t[jia].menqian_flag==0){if((_t_gamemode==_T_GAMEMODE_CHIP_MAHJONG && _t_rule.menqianqing) || _t_gamemode==_T_GAMEMODE_PENGLI){str='門前清'; v=1;if(_t_lang=='en') str='Concealed Hand';_t_yaku_name_common[_t_yaku_name_common_ctr]=str; _t_yaku_fansu_common[_t_yaku_name_common_ctr++]=v; _t_yakufan_ctr_common+=v;_t_fan_common+=1;}if((mode!=1 && _t_ronghe_flag==0) || mode==2){str='門前摸和'; v=1;if(_t_lang=='en') str='Fully Concealed Hand';_t_yaku_name_common[_t_yaku_name_common_ctr]=str; _t_yaku_fansu_common[_t_yaku_name_common_ctr++]=v; _t_yakufan_ctr_common+=v;}}}else _t_renhe_flag=0;}function _t_common_yaku_reach2 (jia, mode, _t_hp, ytype){var str, v, u;var i, j, k, l, m, n;var ym=0, yf;ym=_t_yakufan_ctr >> 8;var yakuname=new Array(20);var yakufansu=new Array(20);var yakuCtr=0;if(_t_gamemode==_T_GAMEMODE_PENGLI || _t_rule.unlimited){_t_yakufan_ctr &= 127;v=15; if(_t_gamemode!=_T_GAMEMODE_PENGLI && _t_rule.unlimited==2) v=13;i=-1; while(++i<_t_yakuman_name_ctr){yakuname[yakuCtr]=_t_yakuman_name[i];yakufansu[yakuCtr++]=v;_t_yakufan_ctr+=v;}i=-1; while(++i<_t_yaku_name_ctr){yakuname[yakuCtr]=_t_yaku_name[i];yakufansu[yakuCtr++]=_t_yaku_fansu[i];}_t_yaku_name_ctr=0; i=-1; while(++i<yakuCtr){_t_yaku_name[i]=yakuname[i];_t_yaku_fansu[i]=yakufansu[i];_t_yaku_name_ctr++;}_t_yakuman_name_ctr=0;}yf=_t_yakufan_ctr;if(_t_lingshang_flag!=0 && !_t_ronghe_flag){_t_yaku_fansu[_t_yaku_name_ctr]=1;str='嶺上開花'; v=1;if(_t_lang=='en') str='After a Kong';if(_t_hp==0x15 && _t_rule.yaku.yitongmoyue){str='五筒開花'; v=5;if(_t_lang=='en') str='After a Kong with Five Circles';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if(_t_qianggang_flag!=0){_t_yaku_fansu[_t_yaku_name_ctr]=1;str='搶槓和'; v=1;if(_t_lang=='en') str='Robbing the Kong';if(_t_hp==0x02 && _t_rule.yaku.yitongmoyue){str='両索槍槓'; v=5;if(_t_lang=='en') str='Robbing the Kong with Two Bamboos';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if(_t_yaojiu_furikiri<0){if(_t_zampai_ctr<1 && !_t_ronghe_flag){str='海底摸月'; v=1;if(_t_lang=='en') str='Under the Sea';if(_t_hp==0x11 && _t_rule.yaku.yitongmoyue){str='一筒摸月'; v=5;if(_t_lang=='en') str='Under the Sea with One Circle';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else if(_t_zampai_ctr<1 && _t_ronghe_flag){str='河底撈魚'; v=1;if(_t_lang=='en') str='Under the Sea';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}}if(_t_lingshang_flag && _t_ronghe_flag && _t_rule.yaku.gang_buri){str='槓振和'; v=1;if(_t_lang=='en') str='Discard after a Kong';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}if(mode>-1 && ytype!=1){i=16; v=0;while(--i>0){ if((_t[jia].shupai[i] & 0x40)!=0) ++v; }_t_shupai_move(jia);i=_t[jia].nukidora_ctr;while(--i>=0){if((j=_t[jia].nukidora[i])>0x37) _t_bipai2[0x38]++;else _t_bipai2[j & 0x3f]++;if(j & 0x40) ++l;}i=_t[jia].fulou_ctr*5;while(--i>=0){if((j=_t[jia].fuloupai[i])==0) continue;if(j & 0x40) ++v;_t_bipai2[j & 0x3f]++;}if(_t_rule.chip.akapai) _t_chip_detail.akapai=v;if(v && _t_lang=='en'){str='Red Five Tile';if(v>1) str+='s';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;_t_fan+=v;v=0;}else if(v && _t_rule.akapai_deal){str='赤牌';if(_t_lang=='en'){str='Red Tile';if(v>1) str+='s';}_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;v=0;}if((i=_t[jia].nukidora_ctr)==4 && _t_nukidora[0]<0){str='花槓'; v=5;if(_t_lang=='en') str='Four of Flower Tiles';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}else v+=i;if(_t_rule.chip.hanapai) _t_chip_detail.hanapai=_t[jia].nukidora_ctr;j=-1; k=_t_dora_disp_ctr;while(++j<=k) v+=_t_bipai2[_t_dora[j]];if(_t[jia].reach_flag && _t_rule.uradora){u=0; j=-1; k=_t_uradora_disp_ctr;while(++j<=k){u+=_t_bipai2[_t_uradora[j]];}if(_t_rule.chip.uradora) _t_chip_detail.uradora=u;v+=u;}if(_t_players==3 && (_t_gamemode==_T_GAMEMODE_CHIP_MAHJONG && _t_rule.lingshang_dora) || _t_gamemode==_T_GAMEMODE_PENGLI){j=_t_lingshang_dora_ctr; while(--j>=0) v+=_t_bipai2[_t_lingshang_dora[j]];}_t_yaku_dora=v;if(v>0){str='ドラ';if(_t_lang=='en') str='Dora';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;_t_fan+=v;}if(_t_gamemode==_T_GAMEMODE_CHIP_MAHJONG){if(_t[jia].nukidora_ctr<1){if(_t_rule_sel['M3_nogara']){v=6;if(_t_rule_sel['M3_nogara']!=1){v=20;if(_t_rule_sel['M3_nogara']==3 && !_t[jia].menqian_flag) v=30;}str='ノーガラ';if(_t_lang=='en') str='No Gara';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;_t_fan+=v;}}else {v=0; n=4; if(_t_rule_sel['M3_garaset']==1) n=6;i=4; while(--i>=0){if((j=_t_nukidora[i])<0x21) continue;m=_t[jia].nukidora_ctr; k=0;while(--m>=0){if(_t[jia].nukidora[m]==j) ++k;}if(k>3) v+=n;}if(v && _t_rule_sel['M3_garaset']){str='セット';if(_t_lang=='en') str='Completed Four of a Gara';_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;_t_fan+=v;}}}}if(_t[jia].liangzhuang_ctr>7 && _t_rule.yaku.balianzhuang){str='八連荘';if(_t_lang=='en') str='Eight Continuous Winning';if(_t_gamemode!=_T_GAMEMODE_PENGLI && !_t_rule.unlimited){_t_yakuman_name[_t_yakuman_name_ctr++]=str; _t_yakufan_ctr+=256;}else {v=15; if(_t_gamemode!=_T_GAMEMODE_PENGLI && _t_rule.unlimited==2) v=13;_t_yaku_name[_t_yaku_name_ctr]=str; _t_yaku_fansu[_t_yaku_name_ctr++]=v; _t_yakufan_ctr+=v;}ym++;}if(mode==0){if(_t[jia].reach_flag && _t[jia].reach_ippatsu_flag && _t_rule.chip.ippatsu) _t_chip_detail.ippatsu=1;i=16; l=0;while(--i>0){ if((_t[jia].shupai[i] & 0x40)!=0) ++l; }i=_t[jia].nukidora_ctr;while(--i>=0){if(j & 0x40) ++l;}i=_t[jia].fulou_ctr*5;while(--i>=0){if((j=_t[jia].fuloupai[i])==0) continue;if(j & 0x40) ++l;}if(_t_rule.chip.akapai) _t_chip_detail.akapai=l;if(_t_rule.chip.hanapai) _t_chip_detail.hanapai=_t[jia].nukidora_ctr;if(_t[jia].reach_flag && _t_rule.uradora && _t_rule.chip.uradora){l=0; j=-1; k=_t_uradora_disp_ctr;while(++j<=k){l+=_t_bipai2[_t_uradora[j]];}_t_chip_detail.uradora=l;}if(ym && _t_rule.chip.yakuman) _t_chip_detail.yakuman=20;}if(_t_gamemode==_T_GAMEMODE_PENGLI){if(!_t[jia].reach_flag) return(0);if((j=_t_yakufan_ctr)>30){_t_yaku_manguan='満貫';if(_t_lang=='en') _t_yaku_manguan='Limited';j=30;}i=1; while(--j>0) i+=i;_t_yaku_result_point=i;_t_fu=0;_t_fu_guide=''; j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;_t_yaku_pay_of_sanjia=_t_yaku_pay_of_zhuangjia=i;return(i);}_t_yakufan_result=_t_yakufan_ctr-_t_fan;if(_t_yakufan_result<_t_shibari && _t_renhe_flag<1){return(0);}i=8; if(_t_gamemode==_T_GAMEMODE_CHIP_MAHJONG) i=50;if(_t_renhe_flag>0 && (_t_rule.unlimited || _t_yakufan_ctr<i || _t_yakufan_result<_t_shibari)){str='人和';if(_t_lang=='en') str='Blessing of Man';if(!_t_rule.unlimited){_t_yakuman_name[0]=str; _t_yakufan_ctr=192;_t_yakuman_name_ctr=1;}else {v=8;i=_t_yaku_name_ctr; while(--i>-1){_t_yaku_name[i+1] =  _t_yaku_name[i];_t_yaku_fansu[i+1]=_t_yaku_fansu[i];}_t_yaku_name_ctr++;_t_yaku_name[0]=str; _t_yaku_fansu[0]=v; _t_yakufan_ctr+=v;}}if(_t_gamemode==_T_GAMEMODE_CHIP_MAHJONG){if(_t_yakufan_ctr>194){_t_yaku_manguan='役満貫';if(_t_lang=='en') _t_yaku_manguan='Yakuman';i=_t_yaku_result_point=100;}else {i=(_t_yakufan_ctr+=2);if(_t_zhuangjia==jia){++i; _t_yaku_manguan='荘家 ';if(_t_lang=='en') _t_yaku_manguan='Dealer';}if(i>49){_t_yaku_manguan='満貫';if(_t_lang=='en') _t_yaku_manguan='Limited';_t_yaku_result_point=50;}else _t_yaku_result_point=i;}_t_fu=0;_t_fu_guide=''; j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;_t_yaku_pay_of_sanjia=_t_yaku_pay_of_zhuangjia=i;return(i);}if(_t_rule.unlimited==1){_t_yakufan_ctr+=2;if(_t_rule.noFu){_t_fu_guide=''; j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;k=-5; l=m=0; i=_t[jia].fulou_ctr; while(--i>=0){k+=5;if(_t[jia].fuloupai[k+4]) l++;else if(_t[jia].fuloupai[k+3]) m++;}j=_t_yakufan_ctr;if(l>0){ j+=l; _t_fu_guide+='暗槓'+l+'組  '+l+'翻\n'; }if(m>1){ j+=(m >> 1); _t_fu_guide+='明槓'+m+'組  '+(m >> 1)+'翻\n'; }if(_t_fu_guide!=''){k=' '+_t_yakufan_ctr; if(_t_yakufan_ctr>9) k=_t_yakufan_ctr;l=' '+j; if(j>9) l=j;_t_fu_guide='追加翻数\n-------------\n'+_t_fu_guide;_t_yakufan_ctr=j;}j-=2; i=25;while(--j>0){i+=i;if(i>=250000000){i=250000000; break;}}_t_fu=-1;}else {j=_t_yakufan_ctr;if(_t_fu==25){ j--; i=5; }else { i=Math.ceil((_t_fu-1)/10); _t_fu=i*10; }while(--j>=0){i+=i;if(i>=250000000){i=250000000; break;}}}}else if(_t_yakuman_name_ctr!=0){_t_yakufan_result=256;if(_t_gamemode==_T_GAMEMODE_EASTERN_BOO){_t_yaku_manguan='役満貫';if(_t_lang=='en') _t_yaku_manguan='Yakuman';i=200;_t_bm_yakuman_jia=jia;}else {if(_t_yakufan_ctr>194){_t_yaku_manguan='役満貫';if(_t_lang=='en') _t_yaku_manguan='Yakuman';i=800;}else if(_t_yakufan_ctr>130){_t_yaku_manguan='倍満貫';if(_t_lang=='en') _t_yaku_manguan='Baiman';i=400;}else  {_t_yaku_manguan='満貫';if(_t_lang=='en') _t_yaku_manguan='Mangan';i=200;}}_t_fu_guide=''; j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;}else {_t_yakufan_ctr+=2;if(_t_yakufan_ctr>=8 && _t_gamemode!=_T_GAMEMODE_EASTERN_BOO){_t_fu=0; _t_fu_guide=''; j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;if(_t_rule.unlimited==2 && _t_yakufan_ctr>=17){j=((_t_yakufan_ctr-15) >> 1)+4;i=200*j;if(_t_lang=='en') _t_yaku_manguan=j+' times of Mangan';else {if(j>19) _t_yaku_manguan=_t_wasuji[Math.floor(j / 10)];if(j>9){ _t_yaku_manguan='十'; j=j % 10; }_t_yaku_manguan+=_t_wasuji[j]+'倍満貫';}}else if(_t_yakufan_ctr>=15){_t_yaku_manguan='四倍満貫';if(_t_lang=='en') _t_yaku_manguan='Yakuman';i=800;}else if(_t_yakufan_ctr>=13){_t_yaku_manguan='三倍満貫';if(_t_lang=='en') _t_yaku_manguan='Sambaiman';i=600;}else if(_t_yakufan_ctr>=10){_t_yaku_manguan='倍満貫';if(_t_lang=='en') _t_yaku_manguan='Baiman';i=400;}else {_t_yaku_manguan='跳満貫';if(_t_lang=='en') _t_yaku_manguan='Haneman';i=300;}}else if(_t_rule.noFu){_t_fu_guide=''; j=-1; while(++j<10) _t_y_shupai_fu[j]=-1;k=-5; l=m=0; i=_t[jia].fulou_ctr; while(--i>=0){k+=5;if(_t[jia].fuloupai[k+4]) l++;else if(_t[jia].fuloupai[k+3]) m++;}j=_t_yakufan_ctr;k=0;if(l>0){ j+=l; _t_fu_guide+='暗槓'+l+'組  '+l+'翻\n'; }if(m>1){ j+=(m >> 1); _t_fu_guide+='明槓'+m+'組  '+(m >> 1)+'翻\n'; }if(j>7){j=7; _t_fu_guide+='※満貫まで加算\n';}if(_t_fu_guide!=''){k=' '+_t_yakufan_ctr; if(_t_yakufan_ctr>9) k=_t_yakufan_ctr;l=' '+j; if(j>9) l=j;_t_fu_guide='追加翻数\n-------------\n'+_t_fu_guide;_t_yakufan_ctr=j;}j-=2; i=25;while(--j>0){i+=i;if(i>=200){_t_yaku_manguan='満貫';if(_t_lang=='en') _t_yaku_manguan='Mangan';i=200; break;}}_t_fu=-1;}else {j=_t_yakufan_ctr;if(_t_fu==25){ j--; i=5; }else { i=Math.ceil((_t_fu-1)/10); _t_fu=i*10; }i <<= j;if(i>=200 || (_t_rule.kiriage_manguan && i>=192)){_t_yaku_manguan='満貫';if(_t_lang=='en') _t_yaku_manguan='Mangan';i=200;}}}j=Math.ceil((i-1)/10);_t_yaku_pay_of_sanjia=j;i*=2;j=Math.ceil((i-1)/10);_t_yaku_pay_of_zhuangjia=j;if(jia==_t_zhuangjia){_t_yaku_pay_of_sanjia=j;i*=3;}else i*=2;_t_yaku_result_point=Math.ceil((i-1)/10);if(_t_players==3){if(_t_rule.mohe_payment==1){if(jia==_t_zhuangjia) _t_yaku_pay_of_sanjia=((_t_yaku_result_point-1) >> 1)+1;else {i=Math.floor((_t_yaku_result_point-1) / 3)+1;_t_yaku_pay_of_zhuangjia=i << 1;_t_yaku_pay_of_sanjia=i;}}else if(_t_rule.mohe_payment==2){_t_yaku_pay_of_zhuangjia=_t_yaku_pay_of_sanjia=((_t_yaku_result_point-1) >> 1)+1;}else {if(jia==_t_zhuangjia) _t_yaku_pay_of_sanjia=((_t_yaku_result_point-1) >> 1)+1;else _t_yaku_pay_of_zhuangjia+=_t_yaku_pay_of_sanjia;}}if(!_t_rule.bao || _t_players!=4) _t_babaojia=-1;return(_t_yaku_result_point);}
