function AFTER_MOPAI(){var i, j, k;_t[_t_jia].declare_command=0;_t[_t_jia].declare_param1=14;if((_t[_t_jia].shupai[14] & 0x3f)>0x37){_t[_t_jia].declare_command=-1;_t_h5_next=setTimeout('DAPAI(); ', 10);return;}_t_hele_str='-';_t_keishiki_hele_flag=0;_t_gang_str='';_t_gangpai_ctr=0;i=4; while(--i>=0) _t_gangpai[i]=0;_t_chi_ctr=0;_t_peng_ok=0;_t_daopai_ok=0;_t_reach_str='';_t_ronghe_flag=0;_t_gang_pos=-1;_t_shupai_move(_t_jia);_t_init_balance();_gm_zehelong_flag[_t_jia]=0;if(_t_gamemode==_T_GAMEMODE_TAIWAN){if(_t_gamemode==_T_GAMEMODE_TAIWAN && _t_pengchi_flag==0 && _tm_baxianguohai_flag[_t_jia]){_t_keishiki_hele_flag=2;_tm_baxianguohai=_tm_baxianguohai_flag[_t_jia];_tm_baxianguohai_flag[_t_jia]=0;}}if(_gm_zehelong(_t_jia, 0)) _gm_zehelong_flag[_t_jia]=1;if(_t_guoshiwushuang(_t_jia) || _t_qiduizi(_t_jia) || _t_menzi1(_t_jia) || _gm_zehelong_flag[_t_jia] || _gm_bukao(_t_jia, 0))_t_keishiki_hele_flag=3;if((_t_rule.yaku.shisanbuta && _t_shisanbuta(_t_jia)) || _t_keishiki_hele_flag){_t_hele_str='';if(_t_gamemode!=_T_GAMEMODE_TAIWAN){k=_t_yaku_judge(_t_jia, 0, -1);if(k<0) _t_hele_str='-';else if(_t_reach_mahjong_rule){if(k<1){_t_hele_str='役がないので和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win because you do not have any required <i>yaku</i>s.';}if(_t_rule.kuitan_sakizuke>1 && _t[_t_jia].menqian_flag!=0){i=_t[_t_jia].min_yifan;if(_t_zampai_ctr<1) ++i;if(_t_yixun_flag==0) i=255;if(_t_lingshang_flag!=0) ++i;if(i<_t_shibari){_t_hele_str='完全先付では門前でない片和了の手では和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win because you cannot have any yaku for some waiting tiles.';}}}else if(_t_gamemode==_T_GAMEMODE_GUOJI){if(k==0){_t_hele_str='役が 8分に満たないので和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win because you have less than 8 points except flower tiles.';}}else {_t_hele_balance(_t_jia, _t_dajia);_t_result_after_balance();if(_t_gamemode==_T_GAMEMODE_BOO || _t_gamemode==_T_GAMEMODE_EASTERN_BOO){var s='';if(_t_ko_flag || _t[_t_top_jia].score_after_balance>=_t_genten+_t_genten || (_t_jushou_ctr>=_t_players*2-1 && _t_jia!=_t_zhuangjia)){if(_t_shizumi_ctr<2) s='マルＣ終了になるような和了は';if(_t[_t_jia].score<_t_genten && _t[_t_jia].score_after_balance<_t_genten) s='浮けないのに半荘終了になる和了は';if(_t[_t_jia].score>=_t_genten && _t_jia!=_t_top_jia) s='一位になれないのに半荘終了になる和了は';if(s!=''){if(_t_rule.bm_yakuman || _t_gamemode==_T_GAMEMODE_EASTERN_BOO) s=s+'役満貫でない限り';s=s+'出来ません。';}}if(_t_bm_yakuman_jia>-1 && (_t_rule.bm_yakuman || _t_gamemode==_T_GAMEMODE_EASTERN_BOO)) s='';if(_t_hele_str=='') _t_hele_str=s;}}if(_t_gamemode==_T_GAMEMODE_PENGLI){if(!_t[_t_jia].reach_flag) _t_hele_str='ポンリーでは立直を掛けないと和了出来ません。';}}else {k=_tm_yaku_judge(_t_jia, _tm_baxianguohai, 0);if(k<0) _t_hele_str='-';else {_t_hele_balance(_t_jia, _t_dajia);_t_result_after_balance();if(_tm_minggang_flag) _t_hele_str='台湾麻将では、明槓後には和了出来ません。';if(_tm_guoshui_flags[_t_jia][_t[_t_jia].shupai[14] & 0x3f] & 2) _t_hele_str='台湾麻将では、同巡内に打たれた牌では摸和も出来ません(過水)。';}}}else _t_hele_str='-';_t_shupai_move(_t_jia);if((!_t_yixun_flag) && _t_gamemode!=_T_GAMEMODE_TAIWAN && _t_gamemode!=_T_GAMEMODE_GUOJI){j=0; i=-7; while((i+=8)<=0x29){if(_t_bipai2[i]) ++j;}i=0x30; while(++i<0x38){if(_t_bipai2[i]) ++j;}if(j>8) _t_daopai_ok=1;}i=0;if(_t[_t_jia].reach_flag==0){i=0;while(++i<0x38){if(_t_players==3 && (_t_nukidora[0]==i || _t_nukidora[1]==i || _t_nukidora[2]==i || _t_nukidora[3]==i)) continue;if(_t_bipai2[i]==4) _t_gangpai[_t_gangpai_ctr++]=i;if(_t_bipai2[i]!=1) continue;j=_t[_t_jia].fulou_ctr; k=-5;while(--j>=0){k+=5;if((_t[_t_jia].fuloupai[k] & 0x3f)==i && (_t[_t_jia].fuloupai[k+1] & 0x3f)==i) _t_gangpai[_t_gangpai_ctr++]=i;}}}else if(_t_bipai2[_t[_t_jia].shupai[14] & 0x3f]==4){i=6;while(--i>=0){if(_t[_t_jia].gangpai[i]==(_t[_t_jia].shupai[14] & 0x3f)) break;}if(i>=0 && _t_nukidora[0]!=(j=_t[_t_jia].shupai[14] & 0x3f) && _t_nukidora[1]!=j && _t_nukidora[2]!=j && _t_nukidora[3]!=j){_t_gangpai[_t_gangpai_ctr++]=_t[_t_jia].shupai[14] & 0x3f;}}else if(_t_gamemode==_T_GAMEMODE_PENGLI && _t_bipai2[_t[_t_jia].shupai[14] & 0x3f]==1){i=_t[_t_jia].shupai[14] & 0x3f;j=_t[_t_jia].fulou_ctr; k=-5;while(--j>=0){k+=5;if((_t[_t_jia].fuloupai[k] & 0x3f)==i && (_t[_t_jia].fuloupai[k+1] & 0x3f)==i) _t_gangpai[_t_gangpai_ctr++]=i;}}if(_t_gangpai_ctr<1) _t_gang_str='カン出来ません。';else {if(_t_zampai_ctr<=0) _t_gang_str='海底でのカンは出来ません。';else if(_t_players==3 && _t_nukidora[1]>-1 && _t_zampai_ctr<2) _t_gang_str='三人麻雀で万子を抜きドラとしている場合は、海底前でもカン出来ません。';if(_t_gang_ctr>=4 && _t_gamemode!=_T_GAMEMODE_PENGLI && _t_gamemode!=_T_GAMEMODE_GUOJI) _t_gang_str='五つ目のカンは出来ません。';if(_t_gamemode==_T_GAMEMODE_TAIWAN && _t[_t_jia].reach_flag) _t_gang_str='台湾麻将では天聴/地聴宣言後のカンは一切出来ません。';}if(_t_gang_str!='') _t_gangpai_ctr=0;if(_t_zampai_ctr<_t_players) _t_reach_str='次の摸牌が残っていない状況での立直は出来ません。';if(_t[_t_jia].score<10 && _t_gamemode==_T_GAMEMODE_REACH && _t_rule.knockOut) _t_reach_str='立直料が払えない場合の立直は出来ません。';if(_t[_t_jia].menqian_flag && _t_gamemode!=_T_GAMEMODE_PENGLI) _t_reach_str='門前でないと立直出来ません。';if(_t[_t_jia].reach_flag) _t_reach_str='既に立直をかけております。';if(_t_gamemode==_T_GAMEMODE_ARSHIAR) _t_reach_str='アルシァルには立直はありません。';if(_t_gamemode==_T_GAMEMODE_TAIWAN && _t_yixun_flag!=0) _t_reach_str='台湾麻将には立直はありません。';if(_t_gamemode==_T_GAMEMODE_GUOJI) _t_reach_str='中共麻将には立直はありません。';_t_h5_next=setTimeout('AFTER_PENGCHI(); ', 10);}function AFTER_PENGCHI(){var i, j, k, l;_t[_t_jia].mopai_ctr++;_t_forDebug='';if(_t[_t_jia].reach_flag && _t_hele_str!='' && _t_gang_str!=''){_t[_t_jia].declare_param1=14;_t[_t_jia].declare_command=0;_t_h5_next=setTimeout('DAPAI(); ', 10);return;}else if(_t_jia){_t_h5_next=setTimeout('DAPAI_BY_CPU(); ', 10);return;}i='';if(_t_hele_str!='-' && _t_hele_str!='') i='\n※'+_t_hele_str;str='打牌を選んで下さい。'+i+_t_forDebug;if(_t_lang=='en'){str='Click/Tap your tile to discard.'+_t_forDebug;;if(_t_hele_str!='-' && _t_hele_str!='') str+='\n*'+_t_hele_str;}_t_status_disp(str);_t_h5_next=setTimeout('DAPAI_INPUT_1(); ', 10);}function DAPAI_INPUT_1(){var i, j, k;i=0; if(_t_hele_str=='') i++;j=0; if(_t_gang_str=='') ++j;k=0; if(_t_reach_str=='') ++k;_t_console_disp(j, 0, 0, k, i, _t_daopai_ok, 1);_h5_makeHandClickable();inputKey=0;_t_h5_next=setTimeout('DAPAI_INPUT_2(); ', 10);}function DAPAI_INPUT_2(){var i, j, k, l;var str;i=Math.random();if(inputKey==25){if(_t_hele_str==''){_t[_t_jia].declare_command=25;_t_console_erase();_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('MOHE(); ', 10);return;}if(_t_hele_str=='-'){_t_hele_str='和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win.';}str=_t_hele_str+'\n打牌を選んで下さい。';if(_t_lang=='en') str=_t_hele_str+'\nClick/Tap your tile to discard.';_t_status_disp(str);inputKey=0;_t_h5_next=setTimeout('DAPAI_INPUT_2(); ', 10);return;}if(inputKey==21){if(_t_gangpai_ctr){_t[_t_jia].declare_command=21;_t_h5_next=setTimeout('MOGANG_PLAYER(); ', 10);return;}str=_t_gang_str+'\n打牌を選んで下さい。';if(_t_lang=='en') str=_t_hele_str+'\nClick/Tap your tile to discard.';_t_status_disp(str);inputKey=0;_t_h5_next=setTimeout('DAPAI_INPUT_2(); ', 10);return;}if(inputKey==24){i='打牌を選んで下さい。';if(_t_lang=='en') i='Click/Tap your tile to discard.';if(_t_reach_str==''){if(_t_reach_declare_flag==0){_t_reach_declare_flag=1;i='立直の打牌を選んで下さい。';if(_t_rule.open_reach){i+='\nオープン立直はもう一度立直ボタンを押して下さい。';}if(_t_lang=='en') i='Click/Tap your tile to declare <i>riichi</i>.';}else if(_t_reach_declare_flag==1){if(_t_rule.open_reach){_t_reach_declare_flag=2;i='オープン立直の打牌を選んで下さい。';}else {_t_reach_declare_flag=0;}}else _t_reach_declare_flag=0;}else i=_t_reach_str+'\n'+i;_t_status_disp(i);inputKey=0;_t_h5_next=setTimeout('DAPAI_INPUT_2(); ', 10);return;}if(inputKey==26){if(_t_daopai_ok){_t[_t_jia].declare_command=26;_t_console_erase();_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('DAOPAI(); ', 10);return;}if(_t_yixun_flag) str='九種幺九倒牌は開局一巡内でのみ可能です。\n打牌を選んで下さい。';else str='幺九牌が九種ありません。\n打牌を選んで下さい。';if(_t_lang=='en') i='You cannot make abortive draw now.\nClick/Tap your tile to discard.';_t_status_disp(str);inputKey=0;_t_h5_next=setTimeout('DAPAI_INPUT_2(); ', 10);return;}if(inputKey>0 && inputKey<20){if(!_t_rule.furiten_reach && _t[_t_jia].reach_flag && _t_hele_str==''){_t[_t_jia].declare_command=25;_t_console_erase();_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('MOHE(); ', 10);return;}if(_t[_t_jia].reach_flag){if(inputKey==14){_t[_t_jia].declare_param1=14;_t_h5_next=setTimeout('DAPAI_INPUT_3(); ', 10);return;}inputKey=0;}else {i=_t[_t_jia].shupai[inputKey] & 0x3f;if(_t_pengchi_flag || _t_reach_declare_flag){if(i<1 || i>0x37 || i==_t_cannot_dapai_pai1 || i==_t_cannot_dapai_pai2 ||    i==_t_nukidora[0] || i==_t_nukidora[1] || i==_t_nukidora[2] || i==_t_nukidora[3]){str='その牌は打てません。\n打牌を選んで下さい。';if(_t_lang=='en') str='You cannot discard it.\nClick/Tap another tile to discard.';_t_status_disp(str);inputKey=0;}else {_t[_t_jia].declare_param1=inputKey;_t_h5_next=setTimeout('DAPAI_INPUT_3(); ', 10);return;}}else if(i>0 && i<0x38){_t[_t_jia].declare_param1=inputKey;inputKey=0;_t_h5_next=setTimeout('DAPAI_INPUT_3(); ', 10);return;}}}_t_h5_next=setTimeout('DAPAI_INPUT_2(); ', 10);}function DAPAI_INPUT_3(){_t_console_erase();_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('DAPAI(); ', 10);}function DAPAI_BY_CPU(){if(_t_hele_str==''){_t[_t_jia].declare_command=25;_t_h5_next=setTimeout('MOHE(); ', 10);return;}if(_t[_t_jia].reach_flag){if(_t_gangpai_ctr){_t[_t_jia].declare_command=21;_t[_t_jia].declare_param1=_t[_t_jia].shupai[14];_t_h5_next=setTimeout('MOGANG(); ', 10);return;}_t[_t_jia].declare_command=0;_t[_t_jia].declare_param1=14;_t_h5_next=setTimeout('DAPAI(); ', 10);return;}if(_t_daopai_ok && _t[_t_jia].score>_t_genten && _t_current_top==_t_jia){_t_h5_next=setTimeout('DAOPAI(); ', 10);return;}_t_reach_declare_flag=0;a0099(_t_jia);if(_t[_t_jia].declare_command==21){_t_h5_next=setTimeout('MOGANG(); ', 10);return;}if(_t_reach_declare_flag && _t_rule.open_reach && _t_players-_t_reach_jia_ctr<3) _t_reach_declare_flag=2;_t_h5_next=setTimeout('DAPAI(); ', 10);}function MOGANG_PLAYER(){inputKey=0;if(_t_gangpai_ctr==1){_t[_t_jia].declare_param1=_t_gangpai[0];_t_console_erase();_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('MOGANG(); ', 10);return;}if(_t_gangpai_ctr==0){_t_h5_next=setTimeout('DAPAI_INPUT2(); ', 10);return;}str='カン牌を選んで下さい。';if(_t_lang=='en') str='Select a tile for kong.';_t_status_disp(str);_t_console_erase();_t_h5_next=setTimeout('MOGANG_PLAYER_2(); ', 10);}function MOGANG_PLAYER_2(){var i=Math.random();if(inputKey==21){_t_h5_next=setTimeout('DAPAI_INPUT_1(); ', 10);return;}if(inputKey>0 && inputKey<20 && (i=_t[_t_jia].shupai[inputKey] & 0x3f)>0 && i<0x38){j=_t_gangpai_ctr;while(--j>=0){if(_t_gangpai[j]==i) break;}if(j>=0){_t_status_erase();_t[_t_jia].declare_param1=i;_t_h5_next=setTimeout('MOGANG(); ', 10);return;}}_t_h5_next=setTimeout('MOGANG_PLAYER_2(); ', 10);}function MOHE(){_t_dapai_buff=_t[_t_jia].shupai[14];if(!_t_started_flag && !_t_lingshang_flag){_t_h5_next=setTimeout('MOHE_DECLARE(); ', 10);return;}_t[_t_jia].shupai[14]=0;_t_shupai_disp(_t_jia);_t_from_shupai_to_di(_t_jia, _t_dapai_buff);_t_h5_next=setTimeout('WAIT_MOVIE("MOHE_DECLARE"); ', 10);}function MOHE_DECLARE(){var str='mohe';var txt='ツモ！';if(_t_lang=='en') txt='Mahjong!';if(_t_gamemode==_T_GAMEMODE_GUOJI){str='he';txt='フー！';if(_t_lang=='en') txt='Hu!';}SPEECH_BALOON(txt, str+_t_player_code[_t_jia], _t_jia);if(_t[_t_jia].reach_ippatsu_flag) setTimeout('AUDIO_OUTPUT("ippatsu'+_t_player_code[_t_jia]+'", false); ', 360);i=_t_players;while(--i>=0){if(i!=_t_jia) _t[i].declare_command=0;else _t[i].declare_command=25;}if(_t_dajia>-1){_t_score_disp(_t_dajia, '#0ff');}_t_score_disp(_t_jia, '#ff0');_t_h5_next=setTimeout('MOHE_DECLARE_1(); ', 360);}function MOHE_DECLARE_1(){var i;_t[_t_jia].open=1;i=_t[_t_jia].shupai[14];_t[_t_jia].shupai[14]=0;_t_lipai(_t_jia);_t[_t_jia].shupai[14]=i;_t_shupai_disp(_t_jia);_t[_t_jia].shupai[14]=_t_dapai_buff;i=_t_seat[_t_jia];j='摸和';if(_t_lingshang_flag) j='嶺上開花';if(_t_gamemode==_T_GAMEMODE_TAIWAN && _tm_baxianguohai==3) j='八仙過海';_t_dora_disp();str=i+'の'+j+'です。';if(_t_lang=='en'){if(_t_players==2 && _t_jia) str='I won on salf-drawing.';else if(!_t_jia) str='You won on salf-drawing.';else str=_t_seat[_t_jia]+' won on salf-drawing.';}_t_status_disp(str);if(_t_ox>-1){if(_t_jia==0){_t_imageRate=1.2;_t_pai_V(_t_dapai_buff & 0x7f, _t_ox, _t_oy);_t_imageRate=1;}else if((_t_jia==2 && _t_players==4) || _t_players==2){_t_pai_V((_t_dapai_buff & 0x7f) | 0x80, _t_ox, _t_oy);}else if(_t_jia==1){_t_pai_H(_t_dapai_buff & 0x7f, _t_ox, _t_oy);}else  {_t_pai_H((_t_dapai_buff & 0x7f) | 0x80, _t_ox, _t_oy);}}_t_h5_next=setTimeout('HELE(); ', 360);}function DAOPAI(){var i, j, k;i=16; while(--i>=0) _t_bipai2[i]=0;_t[_t_jia].open=1;_t_lipai(_t_jia);i=-7; k=0;while((i+=8)<=0x29){j=15; while(--j>=0){if((_t[_t_jia].shupai[j] & 0x3f)==i){_t_bipai2[++k]=_t[_t_jia].shupai[j] & 0x7f;_t[_t_jia].shupai[j]=0;break;}}}i=0x30; while(++i<0x38){j=15; while(--j>=0){if((_t[_t_jia].shupai[j] & 0x3f)==i){_t_bipai2[++k]=_t[_t_jia].shupai[j] & 0x7f;_t[_t_jia].shupai[j]=0;break;}}}j=0; while(++j<16){if(_t[_t_jia].shupai[j] & 0x3f){_t_bipai2[++k]=_t[_t_jia].shupai[j] & 0x7f;}}i=16; while(--i>=0) _t[_t_jia].shupai[i]=_t_bipai2[i];_t_shupai_disp(_t_jia);_t_dajia_buff=_t_jia;_t_game_status='九種'+String.fromCharCode(0x4e48)+'九倒牌';if(_t_lang=='en') _t_game_status='Nine Kinds of Terminals & Honours';_t_score_disp(_t_jia, '#0ff');_t_h5_next=setTimeout('PINGJU(); ', 10);}function MOGANG(){var txt='カン';if(_t_lang=='en') txt='Kong.';SPEECH_BALOON(txt, 'gang'+_t_player_code[_t_jia], _t_jia);var txt='カン';if(_t_lang=='en') txt='Kong.';SPEECH_BALOON(txt, 'gang'+_t_player_code[_t_jia], _t_jia);_t_h5_next=setTimeout('MOGANG_H5_1(); ', 770);}function MOGANG_H5_1(){var i, j;i=20; k=4; j=(_t[_t_jia].declare_param1 &= 0x3f);while(--i>0){if((_t[_t_jia].shupai[i] & 0x3f)==j) --k;}if(k!=0){_t_h5_next=setTimeout('JIAGANG(); ', 10);return;}_t_dapai_flag=1;var l=0x100;if(_t_gamemode==_T_GAMEMODE_TAIWAN || _t_gamemode==_T_GAMEMODE_GUOJI) l=0x1000;var fp=new Array();var fq=new Array();var i, j, k, fpp=0;var p=_t[_t_jia].declare_param1 & 0x3f;j=p | 0x40;i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==j){ fp[fpp]=j; fq[fpp++]=i; }}i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==p){ fp[fpp]=p; fq[fpp++]=i; }}if(fpp!=4){_t[_t_jia].declare_command=0;i=15; while(--i>=0){j=_t[_t_jia].shupai[i] & 0x3f;if(j>0 && j<0x38 && j!=_t_cannot_dapai_pai1 && j!=_t_cannot_dapai_pai2) break;}_t[_t_jia].declare_param1=(j>0) ?  j : 14;_t_h5_next=setTimeout('DAPAI(); ', 10);return;}i=-1; while(++i<4){_t[_t_jia].shupai[fq[i]] |= l;if(_t_gamemode!=_T_GAMEMODE_TAIWAN || _t_gamemode!=_T_GAMEMODE_GUOJI){j=_t_players;while(--j>=0){if(j==_t_jia) continue;_t[j].zampai_table[fp[i]]--;}}}_t_zampai_table4all[fp[0] & 0x3f]=0;_t_shupai_disp(_t_jia);i=-1; while(++i<4) _t[_t_jia].shupai[fq[i]]=0;_t[_t_jia].shupai[fq[0]]=_t[_t_jia].shupai[14];_t[_t_jia].shupai[14]=0;_t_gang_pos=_t[_t_jia].fulou_ctr;i=-1; fpp=0; k=_t[_t_jia].fulou_ctr*5;while(++i<3){_t[_t_jia].fuloupai[k++]=fp[fpp++];}_t[_t_jia].fuloupai[k++]=0;_t_dapai_buff=_t[_t_jia].fuloupai[k++]=fp[fpp] | 0x10000;_t_dajia=_t_jia;i=_t[_t_jia].fulou_ctr++;_t[_t_jia].fulou_gang_ctr++;_t[_t_jia].fulou_jiagang[i]=0;_t[_t_jia].fulou_dajia[i]=-1;_t[_t_jia].yaojiu_furikiri_flag=1;_t_sigangzi_babao=-1;_t_lipai(_t_jia);if(!_t_gang_ctr) _t_gang_jia=_t_jia;else if(_t_gang_jia!=_t_jia) _t_gang_jia=-1;_tm_minggang_flag=0;_t_h5_next=setTimeout('MOGANG_H5_2(); ', 400);}function MOGANG_H5_2(){_t_shupai_disp(_t_jia);_t_nukidora_flag=0;_t_pengchi_flag=0;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;_t_ronghe_flag=1;_t_qianggang_flag=1;_t_angang_flag=1;_t_tingpai_judge(_t_jia, 0, -1);_t_dapai_flag=0;_t[_t_jia].tingpai_dori=0;_tm_baxianguohai=-1;_t_h5_next=setTimeout('AFTER_DAPAI(); ', 10);}function JIAGANG(){_t_dapai_flag=1;var fp=new Array();var fq=new Array();var i, j, k, fpp=0, l;var p=_t[_t_jia].declare_param1 & 0x3f;i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x3f)==p){ fp[fpp]=_t[_t_jia].shupai[i] & 0x7f; fq[fpp++]=i; }}k=-5; i=_t[_t_jia].fulou_ctr; l=-1;while(--i>=0){k+=5; ++l;if((_t[_t_jia].fuloupai[k] & 0x3f)==p && (_t[_t_jia].fuloupai[k+1] & 0x3f)==p) break;}if(fpp!=1 || i<0){_t[_t_jia].declare_command=0;i=15; while(--i>=0){j=_t[_t_jia].shupai[i] & 0x3f;if(j>0 && j<0x38 && j!=_t_cannot_dapai_pai1 && j!=_t_cannot_dapai_pai2) break;}_t[_t_jia].declare_param1=(j>0) ?  j : 14;_t_h5_next=setTimeout('DAPAI(); ', 10);return;}_t_gang_pos=l;_t[_t_jia].shupai[fq[0]] |= 0x100;j=_t_players;while(--j>=0){if(j==_t_jia) continue;_t[j].zampai_table[fp[0]]--;}_t_zampai_table4all[fp[0] & 0x3f]=0;_t_shupai_disp(_t_jia);_t[_t_jia].shupai[fq[0]]=_t[_t_jia].shupai[14];_t[_t_jia].shupai[14]=0;_t_dapai_buff=_t[_t_jia].fuloupai[k+3]=fp[0] | 0x10000;_t_lipai(_t_jia);_t_dajia=_t_jia;_t[_t_jia].fulou_jiagang[l]=1;_t[_t_jia].yaojiu_furikiri_flag=1;_t[_t_jia].fulou_gang_ctr++;_t_sigangzi_babao=-1;if(!_t_gang_ctr) _t_gang_jia=_t_jia;else if(_t_gang_jia!=_t_jia) _t_gang_jia=-1;if(_t_gamemode==_T_GAMEMODE_TAIWAN){i=0x40; while(--i>=0) _tm_guoshui_flags[_t_jia][i]=0;_tm_minggang_flag=0;}_t_h5_next=setTimeout('JIAGANG_H5_1(); ', 320);}function JIAGANG_H5_1(){_t_shupai_disp(_t_jia);_t_nukidora_flag=0;_t_pengchi_flag=0;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;_t_ronghe_flag=1;_t_qianggang_flag=1;_t_angang_flag=0;_t_tingpai_judge(_t_jia, 0, -1);_t_dapai_flag=0;_t[_t_jia].tingpai_dori=0;_tm_baxianguohai=-1;_t_h5_next=setTimeout('AFTER_DAPAI(); ', 320);}function DAPAI(){var i, j, k;_t_dapai_flag=1;j=_t[_t_jia].shupai[_t[_t_jia].declare_param1] & 0x7f;_t[_t_jia].shupai[_t[_t_jia].declare_param1]=0;_t_dapai_buff=j;_t_shupai_disp(_t_jia);k=_t_players;while(--k>=0){if(k!=_t_jia) _t[k].zampai_table[j]--;}if(_t[_t_jia].declare_param1==14 && _t_pengchi_flag==0) _t[_t_jia].tsumogiri_ctr=0;else _t[_t_jia].tsumogiri_ctr++;k=j & 0x3f;_t_zampai_table4all[k]--;if(k>0x37 || _t_nukidora[0]==k || _t_nukidora[1]==k || _t_nukidora[2]==k || _t_nukidora[3]==k){if((_t_gamemode!=_T_GAMEMODE_GUOJI && _t_gamemode!=_T_GAMEMODE_REACH) || _t_zampai_ctr>0){_t_h5_next=setTimeout('NUKIDORA(); ', 100);return;}}_t_h5_next=setTimeout('DAPAI_H5_1(); ', 10);}function DAPAI_H5_1(){var i, j, k, l;_t[_t_jia].shupai[_t[_t_jia].declare_param1]=_t[_t_jia].shupai[14];_t[_t_jia].shupai[14]=0;_t_lipai(_t_jia);i=_t_dapai_buff & 0x3f;if(i<0x30 && ((i-1) & 7)!=0) _t[_t_jia].yaojiu_furikiri_flag=-1;if(!_t_diyi_dapai && i>0x30 && i<0x35) _t_diyi_dapai=i;else if(_t_diyi_dapai!=i) _t_diyi_dapai=-1;if(_t_gamemode==_T_GAMEMODE_TAIWAN){i=0x40; while(--i>=0) _tm_guoshui_flags[_t_jia][i]=0;_tm_guoshui_flags[_t_jia][_t_dapai_buff & 0x3f]=1;_tm_minggang_flag=0;}if(_t[_t_jia].reach_flag){_t[_t_jia].reach_ippatsu_flag=0;_t_reach_declare_flag=0;if(_t_keishiki_hele_flag) _t[_t_jia].reach_minogashi_flag=_t[_t_jia].furiten_flag=1;}else {if(_t_reach_declare_flag){i='';if(_t_tingpai_judge(_t_jia, _t_reach_declare_flag, _t_dapai_buff & 0x3f)==0){i='不聴のため立直出来ません。';if(_t_lang=='en') i='You can not call <i>riichi</i> because your hand is not ready to win.';if(_t_gamemode==_T_GAMEMODE_TAIWAN) i='不聴のため聴牌宣言出来ません。';}if(_t_gamemode==_T_GAMEMODE_ARSHIAR) i='アルシァルには立直はありません。';if(_t_gamemode==_T_GAMEMODE_GUOJI) i='中共麻将には立直はありません。';if(_t_zampai_ctr<_t_players) i='次の摸牌がない状態での立直は出来ません。';if(_t_gamemode==_T_GAMEMODE_TAIWAN && _t_yixun_flag) i='台湾麻将では開局一巡内でないと聴牌宣言出来ません。';if(_t[_t_jia].menqian_flag && _t_gamemode!=_T_GAMEMODE_PENGLI) i='門前でない手での立直は出来ません。';if(_t_gamemode==_T_GAMEMODE_REACH && _t[_t_jia].score<10 && _t_rule.knockOut) i='立直代が払えないので立直出来ません。';if(!_t_rule.furiten_reach && _t[_t_jia].furiten_flag) i='振聴立直は出来ません。';if(_t_rule.kuitan_sakizuke>1 && _t[_t_jia].helepai_ctr>0  && _t[_t_jia].min_yifan<_t_shibari) i='完全先付では役のない待ちがある立直は出来ません。';if(!_t_rule.furiten_reach && _t[_t_jia].min_yifan<_t_shibari) i='振聴立直なしでは役のない待ちがある立直は出来ません。';if(i!=''){_t_reach_declare_flag=0;if(_t_jia==0) _t_status_disp(i);}}}i=_t_dapai_buff2=_t_dapai_buff & 0x7f;_t[_t_jia].fusipai[i & 0x3f]++;if(_t[_t_jia].declare_param1==14 && _t_started_flag && !_t_pengchi_flag) i|=0x1000;if(_t_reach_declare_flag) i |= 0x100;_t[_t_jia].fusipai2[_t[_t_jia].fusipai_ctr++]=i;_t_tingpai_judge(_t_jia, _t_reach_declare_flag, -1);i=_t[0].max_yifan;if((_t_gamemode==_T_GAMEMODE_REACH || _t_gamemode==_T_GAMEMODE_CHIP_MAHJONG) && _t_rule.kuitan_sakizuke>1) i=_t[0].min_yifan;if(_t_jia==0 && _t[_t_jia].helepai_ctr>0  && i>=_t_shibari && !_t[0].furiten_flag && _t[0].max_fan>4){_t_takingCare=1;}_t[_t_jia].furiten_flag+=_t[_t_jia].reach_minogashi_flag;if(_t[_t_jia].reach_flag) _t[_t_jia].toripai[j & 0x3f]++;else {i=0x40; while(--i>=0) _t[_t_jia].toripai[i]=_t[_t_jia].fusipai[i];}var s='';var txt='';if(_t_gamemode==_T_GAMEMODE_TAIWAN && _t_reach_declare_flag==1){s='tingpai';var txt='テンパイ！';if(_t_lang=='en') txt='Ready!';}else if(_t_reach_declare_flag==1){s='reach';var txt='リーチ！';if(_t_lang=='en') txt='Riichi!';}else if(_t_reach_declare_flag==2){s='open_reach';txt='オープンリーチ';if(_t_lang=='en') txt='Open Riichi!';}if(s!='') SPEECH_BALOON(txt, s+_t_player_code[_t_jia], _t_jia);_t_get_dapai_coords(_t_jia);_t_h5_next=setTimeout('DAPAI_H5_2(); ', 10);}function DAPAI_H5_2(){var i, j, k, l;_t_from_shupai_to_he(_t_jia, _t[_t_jia].declare_param1, _t_dapai_buff2, 10);_t_h5_next=setTimeout('WAIT_MOVIE("DAPAI_3"); ', 10);}function DAPAI_3(){_t_nukidora_flag=0;_t_angang_flag=0;_t_qianggang_flag=0;_t_dapai_flag=0;_tm_baxianguohai=-1;_t_pengchi_flag=0;_t_dora_disp();_t_shupai_disp(_t_jia);_t_dapai_disp(_t_jia);AUDIO_OUTPUT('dapai', false);_t_h5_next=setTimeout('DAPAI_4(); ', 10);}function DAPAI_4(){if(!_t_dora_disp()){_t_h5_next=setTimeout('AFTER_DAPAI(); ', 10);return;}_t_h5_next=setTimeout('DAPAI_4(); ', 10);}function NUKIDORA(){_t[_t_jia].nukidora[_t[_t_jia].nukidora_ctr++]=(_t_dapai_buff & 0x7f) | 0x10000;_tm_minggang_flag=0;_t_get_nukidora_coords(_t_jia);_t[_t_jia].shupai[_t[_t_jia].declare_param1]=_t[_t_jia].shupai[14];_t[_t_jia].shupai[14]=0;_t_lipai(_t_jia);_t_reach_declare_flag=0;_t_tingpai_judge(_t_jia, 0, _t_dapai_buff & 0x3f);_t[_t_jia].furiten_flag+=_t[_t_jia].reach_minogashi_flag;_t_from_shupai_to_he(_t_jia, _t[_t_jia].declare_param1, _t_dapai_buff & 0x7f, -1);_t_h5_next=setTimeout('WAIT_MOVIE("NUKIDORA_3"); ', 10);}function NUKIDORA_3(){_t_shupai_disp(_t_jia);_t_nukidora_flag=1;_t_angang_flag=0;_t_qianggang_flag=1;_t_pengchi_flag=0;_tm_baxianguohai=-1;_t_h5_next=setTimeout('AFTER_DAPAI(); ', 10);}function AFTER_DAPAI(){var i;_t_helejia_ctr=0;_t_command_jia=-1;_t_command=-1;_t_helejia=-1;_t_helejia_ctr=0;_t_dajia=_t_jia;_t_ronghe_flag=1;_t_loop=1;_t_cannot_dapai_pai1=0;_t_cannot_dapai_pai2=0;_t_init_balance();i=4; while(--i>=0){_t[i].declare_command=-1;_t[i].declare_param1=_t[i].declare_param2=0;}_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);}function AFTER_DAPAI_2(){var i, j, k, l;for(;;){if(--_t_jia<0) _t_jia=_t_players-1;if(_t_jia==_t_dajia){if(--_t_loop<0){_t_h5_next=setTimeout('AFTER_DAPAI4(); ', 10);return;break;}else continue;}if((_t_loop>0 && !_t_manned[_t_jia]) || (_t_loop<1 && _t_manned[_t_jia])){if(_t[_t_jia].declare_command<0) break;}}_t_init_balance2();_t_hele_str='-';_t_keishiki_hele_flag=0;_t_gang_str='カン出来ません。';_t_chi_ctr=0;_t_peng_ok=0;_t_daopai_ok=0;_tm_baxianguohai=0;_t[_t_jia].declare_command=_t[_t_jia].declare_param1=_t[_t_jia].declare_param2=0;_gm_zehelong_flag[_t_jia]=0;i=0; j=_t_dajia;for(;;){if(++j>=_t_players) j=0;if(j==_t_jia) break;if(_t[j].declare_command==25) i++;}if(i && !_t_rule.liangjiahe && !(_t_rule.sanjiahe_pingju && _t_helejia_ctr==2) && !j){_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);return;}if((_t_dapai_buff & 0x3f)>0x37){_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);return;}if(_t_angang_flag && _t_qianggang_flag){if(_t_gamemode==_T_GAMEMODE_TAIWAN || _t_gamemode==_T_GAMEMODE_GUOJI || (!_t_rule.angang_guoshi)){_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);return;}_t[_t_jia].shupai[15]=_t_dapai_buff;i=_t_guoshiwushuang(_t_jia);_t[_t_jia].shupai[15]=0;if(!i){_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);return;}_t_hele_str='';_t_keishiki_hele_flag=1;}else {_t[_t_jia].shupai[15]=_t_dapai_buff;if(_gm_zehelong(_t_jia, 0)) _gm_zehelong_flag[_t_jia]=1;if((_t_k=_t_guoshiwushuang(_t_jia)) || _t_menzi1(_t_jia) || _t_qiduizi(_t_jia) ||    _gm_zehelong_flag[_t_jia] || _gm_bukao(_t_jia, 0)){_t_hele_str='';_t_keishiki_hele_flag=1;k=_t_yaku_judge(_t_jia, 0, -1);if(k>0){_t_hele_balance(_t_jia, _t_dajia);_t_result_after_balance();}else if(_t_gamemode==_T_GAMEMODE_GUOJI){if(k==0){_t_hele_str='役が 8分に満たないので和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win because you have less than 8 points.';}}else if(k==0){_t_hele_str='役がないので和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win because you do not have any required <i>yaku</i>s.';}if(_t_reach_mahjong_rule || _t_gamemode==_T_GAMEMODE_BEINUKI){if(_t_k && _t_rule.furiten_guoshi){if(_t[_t_jia].fusipai[_t_dapai_buff & 0x3f]){_t_hele_str='国士無双は捨てた牌での栄和は出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win Thirteen Orphans because the discarded tile is one you also discarded';}}else if(_t[_t_jia].furiten_flag || (_t[_t_jia].reach_minogashi_flag && _t[_t_jia].reach_flag)){_t_hele_str='振聴では栄和出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win on a discard because you are <i>furiten</i>.';}if(_t_gamemode!=_T_GAMEMODE_BEINUKI  && _t_rule.kuitan_sakizuke>1){i=_t[_t_jia].min_yifan;if(_t_zampai_ctr<1) ++i;if(_t_qianggang_flag!=0) ++i;if(_t_lingshang_flag!=0) ++i;if(_t_yixun_flag==0) i=255;if(i<_t_shibari){_t_hele_str='完全先付では片和了となる手での栄和は出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win because you cannot have any yaku for some waiting tiles.';}}}else if(_t_gamemode!=_T_GAMEMODE_GUOJI && _t[_t_jia].fusipai[_t_dapai_buff & 0x3f]) _t_hele_str='捨てた牌での栄和は出来ません。';if(_t_gamemode==_T_GAMEMODE_BOO || _t_gamemode==_T_GAMEMODE_EASTERN_BOO){var s='';if(_t_ko_flag || _t[_t_top_jia].score_after_balance>=_t_genten+_t_genten || (_t_jushou_ctr>=_t_players*2-1 && _t_jia!=_t_zhuangjia)){if(_t_shizumi_ctr<2) s='マルＣ終了になるような和了は';if(_t[_t_jia].score<_t_genten && _t[_t_jia].score_after_balance<_t_genten) s='浮けないのに半荘終了になる和了は';if(_t[_t_jia].score>=_t_genten && _t_jia!=_t_top_jia) s='一位になれないのに半荘終了になる和了は';if(s!=''){if(_t_rule.bm_yakuman || _t_gamemode==_T_GAMEMODE_EASTERN_BOO) s=s+'役満貫でない限り';s=s+'出来ません。';}}if(_t_bm_yakuman_jia>-1 && (_t_rule.bm_yakuman || _t_gamemode==_T_GAMEMODE_EASTERN_BOO)) s='';if(_t_gamemode==_T_GAMEMODE_BOO && _t[_t_jia].toripai[_t_dapai_buff & 0x3f] && _t_rule.minogashiNG) s='同巡内に見送った牌では栄和出来ません。';if(_t_hele_str=='') _t_hele_str=s;}if(_t_gamemode==_T_GAMEMODE_PENGLI){if(!_t[_t_jia].reach_flag) _t_hele_str='ポンリーでは立直を掛けないと和了出来ません。';}if(_t_gamemode==_T_GAMEMODE_TAIWAN){_t_hele_str='';if(_tm_guoshui_flags[_t_jia][_t_dapai_buff & 0x3f] & 2) _t_hele_str='台湾麻将では、見送った牌での和了は次の打牌が済むまで出来ません(過水)。';}}_t[_t_jia].shupai[15]=0;if(!_t_qianggang_flag && !_t_nukidora_flag && !_t[_t_jia].reach_flag && (_t_command_jia<0 || _t_command==23) && _t_zampai_ctr>0){_t_shupai_move(_t_jia);i=_t_dapai_buff & 0x3f;if(_t_bipai2[i]==3){_t_gang_str='';if(_t_players==3 && _t_nukidora[1]>-1 && _t_zampai_ctr<2) _t_gang_str='三人麻雀で万子を抜きドラとしている場合は、海底前でもカン出来ません。';if(_t_gang_ctr>=4 && _t_gamemode!=_T_GAMEMODE_PENGLI && _t_gamemode!=_T_GAMEMODE_GUOJI) _t_gang_str='五つ目のカンは出来ません。';}if(_t_bipai2[i]>1){_t_peng_ok=0;j=0x38; while(--j>0){if(j==_t_nukidora[0] || j==_t_nukidora[1] || j==_t_nukidora[2] || j==_t_nukidora[3]) continue;if(j==i){if(_t_rule.kuinaoshi || _t_bipai2[j]==2) continue;break;}if(_t_bipai2[j]>0) break;}if(j>0) _t_peng_ok=1;if(_t_gamemode==_T_GAMEMODE_TAIWAN && _tm_guoshui_flags[_t_jia][i]) _t_peng_ok=0;}if(_t_players!=3 && i<0x30 && (_t_players==2 || ((_t_dajia+1) & 3)==_t_jia)){if(_t_rule.kuinaoshi) _t_bipai2[i]=0;if(i>2 && _t_bipai2[i-2]>0 && _t_bipai2[i-1]>0){--_t_bipai2[i-2]; --_t_bipai2[i-1];if(i>3){ l=_t_bipai2[i-3]; if(_t_rule.kuinaoshi>1) _t_bipai2[i-3]=0; }j=0x38; while(--j>=0){if(_t_bipai2[j]>0) break;}if(j>0){var pb=pr=qb=qr=0;j=20; while(--j>0){k=_t[_t_jia].shupai[j];if((k & 0x3f)==i-2){if(k & 0x40) pr++; else pb++;}if((k & 0x3f)==i-1){if(k & 0x40) qr++; else qb++;}}if(pb && qb){_t_chi1[_t_chi_ctr]=i-2;_t_chi2[_t_chi_ctr]=i-1;_t_chiN[_t_chi_ctr++]=i-3;}if(pb && qr){_t_chi1[_t_chi_ctr]=i-2;_t_chi2[_t_chi_ctr]=(i-1) | 0x40;_t_chiN[_t_chi_ctr++]=i-3;}if(pr && qb){_t_chi1[_t_chi_ctr]=(i-2) | 0x40;_t_chi2[_t_chi_ctr]=i-1;_t_chiN[_t_chi_ctr++]=i-3;}if(pr && qr){_t_chi1[_t_chi_ctr]=(i-2) | 0x40;_t_chi2[_t_chi_ctr]=(i-1) | 0x40;_t_chiN[_t_chi_ctr++]=i-3;}}++_t_bipai2[i-2]; ++_t_bipai2[i-1];if(i>3 && _t_rule.kuinaoshi>1) _t_bipai2[i-3]=l;;}if(_t_bipai2[i-1]>0 && _t_bipai2[i+1]>0){--_t_bipai2[i-1]; --_t_bipai2[i+1];j=0x38; while(--j>=0){if(_t_bipai2[j]>0) break;}if(j>0){var pb=pr=qb=qr=0;j=20; while(--j>0){k=_t[_t_jia].shupai[j];if((k & 0x3f)==i-1){if(k & 0x40) pr++; else pb++;}if((k & 0x3f)==i+1){if(k & 0x40) qr++; else qb++;}}if(pb && qb){_t_chi1[_t_chi_ctr]=i-1;_t_chi2[_t_chi_ctr]=i+1;_t_chiN[_t_chi_ctr++]=i;}if(pb && qr){_t_chi1[_t_chi_ctr]=i-1;_t_chi2[_t_chi_ctr]=(i+1) | 0x40;_t_chiN[_t_chi_ctr++]=i;}if(pr && qb){_t_chi1[_t_chi_ctr]=(i-1) | 0x40;_t_chi2[_t_chi_ctr]=i+1;_t_chiN[_t_chi_ctr++]=i;}if(pr && qr){_t_chi1[_t_chi_ctr]=(i-1) | 0x40;_t_chi2[_t_chi_ctr]=(i+1) | 0x40;_t_chiN[_t_chi_ctr++]=i;}}++_t_bipai2[i-1]; ++_t_bipai2[i+1];}if(_t_bipai2[i+1]>0 && _t_bipai2[i+2]>0){--_t_bipai2[i+2]; --_t_bipai2[i+2];if(_t_rule.kuinaoshi>1) _t_bipai2[i+3]=0;j=0x38; while(--j>=0){if(_t_bipai2[j]>0) break;}if(j>0){var pb=pr=qb=qr=0;j=20; while(--j>0){k=_t[_t_jia].shupai[j];if((k & 0x3f)==i+1){if(k & 0x40) pr++; else pb++;}if((k & 0x3f)==i+2){if(k & 0x40) qr++; else qb++;}}if(pb && qb){_t_chi1[_t_chi_ctr]=i+1;_t_chi2[_t_chi_ctr]=i+2;_t_chiN[_t_chi_ctr++]=i+3;}if(pb && qr){_t_chi1[_t_chi_ctr]=i+1;_t_chi2[_t_chi_ctr]=(i+2) | 0x40;_t_chiN[_t_chi_ctr++]=i+3;}if(pr && qb){_t_chi1[_t_chi_ctr]=(i+1) | 0x40;_t_chi2[_t_chi_ctr]=i+2;_t_chiN[_t_chi_ctr++]=i+3;}if(pr && qr){_t_chi1[_t_chi_ctr]=(i+1) | 0x40;_t_chi2[_t_chi_ctr]=(i+2) | 0x40;_t_chiN[_t_chi_ctr++]=i+3;}}}}if(_t_gamemode==_T_GAMEMODE_TAIWAN && (_tm_guoshui_flags[_t_jia][_t_dapai_buff & 0x3f] & 1)) _t_peng_ok=0;}if(_t_hele_str!='' && _t_gang_str!='' && _t_peng_ok==0 && _t_chi_ctr<1){_t[_t_jia].toripai[_t_dapai_buff & 0x3f]++;if(_t_keishiki_hele_flag){_t[_t_jia].declare_command=_t[_t_jia].declare_param1=_t[_t_jia].declare_param2=0;_t[_t_jia].furiten_flag=1;if(_t[_t_jia].reach_flag) _t[_t_jia].reach_minogashi_flag=1;}if(_t_hele_str!='-' && _t_jia==0) _t_status_disp(_t_hele_str);_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);return;}}if(_t_jia){_t_h5_next=setTimeout('AFTER_DAPAI_BY_CPU(); ', 10);return;}inputKey=0;i='';if(_t_hele_str!='-' && _t_hele_str!='') i='\n※'+_t_hele_str;str='操作を選んで下さい。';if(_t_lang=='en'){i='';if(_t_hele_str!='-' && _t_hele_str!='') i='\n*'+_t_hele_str;str='Click/Tap any command.';}_t_status_disp(str+i);i=0; if(_t_hele_str=='') ++i;j=0; if(_t_gang_str=='') ++j;_t_console_disp(j, _t_peng_ok, _t_chi_ctr, 0, i, 0, 1);_t_h5_arrow(1, _t_h5_arrowD, _t_h5_arrowX, _t_h5_arrowY);_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_2(); ', 10);}function AFTER_DAPAI_BY_PLAYER_2(){var i, j, k, l;i=Math.random();if(inputKey==25){if(_t_hele_str==''){_t[_t_jia].declare_command=25;_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_3(); ', 10);return;}if(_t_hele_str=='-'){_t_hele_str='和了出来ません。';if(_t_lang=='en') _t_hele_str='You cannot win now.';}str=_t_hele_str+'\n操作を選んで下さい。';if(_t_lang=='en') str=_t_hele_str+'\nClick/Tap any command.';_t_status_disp(str);inputKey=0;_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_3(); ', 10);return;}if(inputKey==21){if(_t_gang_str==''){_t[_t_jia].declare_command=21;_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_3(); ', 10);return;}else {str=_t_gang_str+'\n操作を選んで下さい。';if(_t_lang=='en') str=_t_gang_str+'\nClick/Tap any command.';_t_status_disp(str);inputKey=0;}}if(inputKey==22){if(_t_peng_ok){_t[_t_jia].declare_command=22;_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_3(); ', 10);return;}inputKey=0;}if(inputKey==23){if(_t_chi_ctr>0){if(_t_chi_ctr==1){_t[_t_jia].declare_param1=_t_chi1[0];_t[_t_jia].declare_param2=_t_chi2[0];}_t[_t_jia].declare_command=23;_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_3(); ', 10);return;}inputKey=0;}if(inputKey==14){_t[_t_jia].declare_command=0;_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_3(); ', 10);return;}_t_h5_next=setTimeout('AFTER_DAPAI_BY_PLAYER_2(); ', 10);}function AFTER_DAPAI_BY_PLAYER_3(){_t_cursor_erase();_t_console_erase();_t_status_erase();_t_h5_next=setTimeout('AFTER_DAPAI3(); ', 10);}function AFTER_DAPAI_BY_CPU(){var i, j, k, l, m, n, p, i1, i2;if((_t_gamemode==_T_GAMEMODE_BOO || _t_gamemode==_T_GAMEMODE_EASTERN_BOO) && _t_hele_str==''){try {i=_t_players; k=0; while(--i>-1){if(_t[i].score<_t_genten) ++k;}i=_t[0].score;j=_t[0].score_after_balance;if((i<_t[1].score || i<_t[2].score || i<_t[3].score) &&    j>_t[1].score_after_balance &&    j>_t[2].score_after_balance &&    j>_t[3].score_after_balance){_t_hele_str='*';}else if(i>_t[1].score && i>_t[2].score && i>_t[3].score &&    j>_t[1].score_after_balance &&    j>_t[2].score_after_balance &&    j>_t[3].score_after_balance &&    k<_t_shizumi_ctr){_t_hele_str='*';}} catch(e){ console.log(e); }}if(_t_hele_str=='') _t[_t_jia].declare_command=25;else if(!_t_qianggang_flag && _t_zampai_ctr>0){_t[_t_jia].declare_command=0;if(_t_gamemode==_T_GAMEMODE_GUOJI) a0051(_t_jia);if(_t[_t_jia].declare_command<1){p=_t_dapai_buff & 0x3f;if(_t_chi_ctr>0 && (i=_t[_t_jia].nq[p])!=0){_t_shupai_move(_t_jia);j=k=0;if(i==1 && _t_bipai2[p+1]>0 && _t_bipai2[p+2]>0){j=p+1; k=p+2;i1=20; while(--i1>0){ if((_t[_t_jia].shupai[i1] & 0x3f)==j) break; }i2=20; while(--i2>0){ if((_t[_t_jia].shupai[i2] & 0x3f)==k) break; }if(i1>0 && i2>0){i=20; while(--i>0){if(i==i1 || i==i2) continue;if((m=_t[_t_jia].shupai[i] & 0x3f)<1 || m>0x37) continue;if(_t_rule.kuinaoshi<1) break;if(_t_rule.kuinaoshi>1 && m==p+3) continue;if(m!=p) break;}if(i<1) j=k=0;}else j=k=0;}if(i==2 && _t_bipai2[p-1]>0 && _t_bipai2[p+1]>0){j=p-1; k=p+1;i1=20; while(--i1>0){ if((_t[_t_jia].shupai[i1] & 0x3f)==j) break; }i2=20; while(--i2>0){ if((_t[_t_jia].shupai[i2] & 0x3f)==k) break; }if(i1>0 && i2>0){i=20; while(--i>0){if(i==i1 || i==i2) continue;if((m=_t[_t_jia].shupai[i] & 0x3f)<1 || m>0x37) continue;if(_t_rule.kuinaoshi<1) break;if(m!=p) break;}if(i<1) j=k=0;}else j=k=0;}if(i==3 && (p & 0x0f)>2 && _t_bipai2[p-2]>0 && _t_bipai2[p-1]>0){j=p-2; k=p-1;i1=20; while(--i1>0){ if((_t[_t_jia].shupai[i1] & 0x3f)==j) break; }i2=20; while(--i2>0){ if((_t[_t_jia].shupai[i2] & 0x3f)==k) break; }if(i1>0 && i2>0){i=20; while(--i>0){if(i==i1 || i==i2) continue;if((m=_t[_t_jia].shupai[i] & 0x3f)<1 || m>0x37) continue;if(_t_rule.kuinaoshi<1) break;if(_t_rule.kuinaoshi>1 && m==p-3) continue;if(m!=p) break;}if(i<1) j=k=0;}else j=k=0;}if(j>0 && k>0){_t[_t_jia].declare_command=23;_t[_t_jia].declare_param1=j; _t[_t_jia].declare_param2=k;}}else if(_t_gang_str=='' && _t[_t_jia].nq[p]==5){_t[_t_jia].declare_command=21;}else if(_t_peng_ok>0 && _t[_t_jia].nq[p]==4){if((p==_t_zhuangfeng[0] || p==_t_zhuangfeng[1] || p==_t[_t_jia].menfeng || p>0x34) &&    _t[_t_jia].rm_2naki && _t[_t_jia].zampai_table[p]+_t[_t_jia].zampai_table[p+0x40]>0) ;else {_t[_t_jia].declare_command=22;_t[_t_jia].declare_param1=_t[_t_jia].declare_param2=p;}}if(_t[_t_jia].declare_command==22 || _t[_t_jia].declare_command==23){i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==(_t[_t_jia].declare_param1 | 0x40)){_t[_t_jia].declare_param1 |= 0x40; break;}}j=20; while(--j>0){if(i==j) continue;if((_t[_t_jia].shupai[j] & 0x7f)==(_t[_t_jia].declare_param2 | 0x40)){_t[_t_jia].declare_param2 |= 0x40; break;}}}}}_t_h5_next=setTimeout('AFTER_DAPAI3(); ', 10);}function AFTER_DAPAI3(){var i;i=_t[_t_jia].declare_command;if(i==25 && _t_hele_str==''){var str='rong';var txt='ロン！';if(_t_lang=='en') txt='Mahjong!';if(_t_gamemode==_T_GAMEMODE_GUOJI){str='he';txt='フー！';if(_t_lang=='en') txt='Hu!';}SPEECH_BALOON(txt, str+_t_player_code[_t_jia], _t_jia);if(_t[_t_jia].reach_ippatsu_flag) setTimeout('AUDIO_OUTPUT("ippatsu'+_t_player_code[_t_jia]+'", false); ', 360);_t_score_disp(_t_jia, '#ff0');_t[_t_jia].open=1;_t_lipai(_t_jia);_t_shupai_disp(_t_jia);_t[_t_jia].shupai[15]=_t_dapai_buff;_t_helejia_ctr++;_t_command=25;_t_command_jia=_t_helejia=_t_jia;_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 360);return;}_t[_t_jia].toripai[_t_dapai_buff & 0x3f]++;if(_t_keishiki_hele_flag){_t[_t_jia].furiten_flag=1;if(_t[_t_jia].reach_flag) _t[_t_jia].reach_minogashi_flag=1;}if(i>20){_t_command=i;_t_command_jia=_t_jia;}if(_t_gamemode==_T_GAMEMODE_TAIWAN){_tm_guoshui_flags[_t_jia][_t_dapai_buff & 0x3f] |= 3;_tm_baxianguohai=0;}_t_h5_next=setTimeout('AFTER_DAPAI_2(); ', 10);}function AFTER_DAPAI4(){var i, j, k, l;_t_jia=_t_dajia;_t_dajia_buff=_t_dajia;if(_t_helejia_ctr){if(_t_rule.sanjiahe_pingju && _t_helejia_ctr==3){_t_game_status='三家和';if(_t_lang=='en') _t_game_status='Three Players Declared to Win.';i=_t_players; while(--i>=0){if(_t[i].declare_command==25) _t_score_disp(i, '#ccc');}_t_h5_next=setTimeout('PINGJU(); ', 10);return;}else {_t_h5_next=setTimeout('RONGHE(); ', 10);return;}}_t_h5_next=setTimeout('PINGJU_CHECK(); ', 10);}function PINGJU_CHECK(){var i, j, k, l, st=0;_t_jia=_t_dajia;if(_t_nukidora_flag){_t_dajia=-1;_t_qianggang_flag=0;if((_t_dapai_buff & 0x3f)<0x38) _t_lingshang_flag=1;if(_t_gamemode==_T_GAMEMODE_TAIWAN){_tm_minggang_flag=0;_t_lingshang_flag=1;--_t_zampai_ctr;_tm_baxianguohai=0;if(_t[_t_jia].nukidora_ctr==8) _tm_baxianguohai_flag[_t_jia]=3;}else if(_t_gamemode!=_T_GAMEMODE_CHIP_MAHJONG && _t_nukidora[2]<1) --_t_zampai_ctr;if(_t_zampai_ctr<0){_t_h5_next=setTimeout('HUANGPAI(); ', 10);return;}_t_h5_next=setTimeout('LINGSHANG_MOPAI(); ', 10);return;}if(_t_qianggang_flag){_t_started_flag=_t_yixun_flag=1;i=_t_players; while(--i>=0) _t[i].reach_ippatsu_flag=0;++_t_gang_ctr;if(_t_rule.gangdora) ++_t_dora_ctr;if(_t_angang_flag || _t_rule.gangdora>1) _t_dora_disp();_t_qianggang_flag=0;_t_angang_flag=0;_t_lingshang_flag=1;_t_dajia=-1;--_t_zampai_ctr;_tm_minggang_flag=0;if(_t_players==3 && _t_nukidora[1]>0) --_t_zampai_ctr;_t_h5_next=setTimeout('LINGSHANG_MOPAI(); ', 10);return;}_t_movie_ctr=0;if(_t_reach_declare_flag){_t[_t_dajia].reach_flag=1;if(_t_gamemode==_T_GAMEMODE_TAIWAN) _t_score_disp(_t_dajia, '#fff');if(_t_reach_mahjong_rule){if(!_t_yixun_flag) _t[_t_dajia].double_reach_flag=1;if(_t_rule.ippatsu) _t[_t_dajia].reach_ippatsu_flag=1;if(_t_gamemode==_T_GAMEMODE_REACH || _t_gamemode==_T_GAMEMODE_EASTERN_BOO){_t[_t_dajia].score-=10;_t_reach_bo_ctr+=10;_t_reach_stick_disp(_t_dajia);_t_score_disp(_t_dajia, '#fff');st=1;}}if(_t_rule.open_reach && _t_reach_declare_flag==2){_t[_t_dajia].open_reach_flag=1;_t[_t_dajia].open=1;i=15;while(--i>0){if((j=_t[_t_dajia].shupai[i] & 0x7f)<1 || i>0x37) continue;k=_t_players;while(--k>=0){if(k==_t_dajia) continue;_t[k].zampai_table[j]--;}}_t_lipai(_t_dajia);_t_shupai_disp(_t_dajia);}if(_t_rule.chip.ippatsu) _t[_t_dajia].reach_ippatsu_flag=1;if(_t[_t_dajia].furiten_flag) _t[_t_dajia].reach_minogashi_flag=1;if(st){_t_reach_stick_disp(_t_dajia);_t_h5_next=setTimeout('WAIT_MOVIE("PINGJU_CHECK_2_H5"); ', 10);return;}}_t_h5_next=setTimeout('PINGJU_CHECK_3(); ', 10);}function PINGJU_CHECK_2_H5(){_t_dapai_disp(_t_dajia);_t_h5_next=setTimeout('PINGJU_CHECK_3(); ', 10);}function PINGJU_CHECK_3(){if(_t_reach_declare_flag){_t_reach_declare_flag=0;_t_reach_jia_ctr++;if(_t_reach_jia_ctr==4 && _t_rule.sijia_reach){_t_game_status='四家立直';if(_t_lang=='en') _t_game_status='Four <i>Riichi</i> Declarations.';_t_h5_next=setTimeout('PINGJU(); ', 10);return;}}if((i=_t_dajia+1)>=_t_players) i=0;if(i==_t_zhuangjia){_t_yixun_flag=1;if(_t_diyi_dapai>0){_t_game_status='四風子連打';if(_t_lang=='en') _t_game_status='The Same Wind Discarded in the First Uninterrupted set of Turns.';_t_h5_next=setTimeout('PINGJU(); ', 10);return;}}if(_t_gamemode!=_T_GAMEMODE_PENGLI && _t_gamemode!=_T_GAMEMODE_GUOJI){if((_t_gamemode==_T_GAMEMODE_TAIWAN && _t_gang_ctr>=4) ||    (_t_rule.sigangsuanle && _t_gang_ctr>=4 && _t_gang_jia<0)){_t_game_status='四槓算了';if(_t_lang=='en') _t_game_status='Four Kongs by Multiple Players.';_t_h5_next=setTimeout('PINGJU(); ', 10);return;}}if(_t_zampai_ctr<=0){_t_h5_next=setTimeout('HUANGPAI(); ', 10);return;}if(_t_command==21){_t_h5_next=setTimeout('MINGGANG(); ', 10);return;}if(_t_command==22){_t_h5_next=setTimeout('PENG(); ', 10);return;}if(_t_command==23){_t_h5_next=setTimeout('CHI(); ', 10);return;}_t_h5_next=setTimeout('MOPAI(); ', 10);}function MOPAI(){if(_t_gamemode!=_T_GAMEMODE_TAIWAN){_t_h5_next=setTimeout('MOPAI_1(); ', 10);return;}_tm_dapai_erase(_t_jia);_tm_dapai2he(_t_jia);_t_h5_next=setTimeout('WAIT_MOVIE("MOPAI_TM2"); ', 10);}function MOPAI_TM2(){_t_h5_next=setTimeout('MOPAI_1(); ', 60);}function MOPAI_1(){var i, j, k, l;if(++_t_jia>=_t_players) _t_jia=0;_t_dajia=-1;--_t_zampai_ctr;_t_lingshang_flag=0;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;_t_ronghe_flag=0;_t_qianggang_flag=0;_t_pengchi_flag=0;_t_started_flag=1;_t_dapai_flag=0;_tm_minggang_flag=0;k=_t_players; while(--k>=0){l=32; while(--l>=0){if(_t_bipai4disp[k][l]<0) break;}if(l>-1) break;}if(k>-1){do {if(!(_t_mopai_pos & 1)) ++_t_mopai_pos; else _t_mopai_pos-=3;if(_t_mopai_pos<0){_t_mopai_pos=30;if(--_t_mopai_jia<0) _t_mopai_jia=_t_players-1;}} while(_t_bipai4disp[_t_mopai_jia][_t_mopai_pos]==0);}_t_dapai_buff=_t_bipai[_t_mopai_ptr++] & 0x7f;_t[_t_jia].shupai[14]=_t_dapai_buff;_t[_t_jia].mopai_ctr++;--_t[_t_jia].zampai_table[_t[_t_jia].shupai[14]];_t_bipai4disp[_t_mopai_jia][_t_mopai_pos]=0;_t_bipai_disp();_t_from_bipai_to_shupai(_t_mopai_jia, _t_mopai_pos, _t_jia, 0);i=0;_t_h5_next=setTimeout('WAIT_MOVIE("MOPAI_3"); ', 10);}function MOPAI_3(){if(!_t_jia) AUDIO_OUTPUT('mopai', false);_t_shupai_disp(_t_jia);_t_h5_next=setTimeout('AFTER_MOPAI(); ', 10);}function CHI(){_t_jia=_t_command_jia;var txt='チー';if(_t_lang=='en') txt='Chow.';SPEECH_BALOON(txt, 'chi'+_t_player_code[_t_jia], _t_jia);_t_h5_next=setTimeout('CHI_H5_1(); ', 720);}function CHI_H5_1(){var i, j, k, l;if(_t[_t_jia].declare_param1!=0 && _t[_t_jia].declare_param2!=0){_t_h5_next=setTimeout('CHI_3(); ', 10);return;}_t_chi_ctr=0;_t_shupai_move(_t_jia);i=_t_dapai_buff & 0x3f;if(_t_rule.kuinaoshi) _t_bipai2[i]=0;if(i>2 && _t_bipai2[i-2]>0 && _t_bipai2[i-1]>0){--_t_bipai2[i-2]; --_t_bipai2[i-1];if(i>3){ l=_t_bipai2[i-3]; if(_t_rule.kuinaoshi>1) _t_bipai2[i-3]=0; }j=0x38; while(--j>=0){if(_t_bipai2[j]>0) break;}if(j>0){var pb=pr=qb=qr=0;j=20; while(--j>0){k=_t[_t_jia].shupai[j];if((k & 0x3f)==i-2){if(k & 0x40) pr++; else pb++;}if((k & 0x3f)==i-1){if(k & 0x40) qr++; else qb++;}}if(pb && qb){_t_chi1[_t_chi_ctr]=i-2;_t_chi2[_t_chi_ctr]=i-1;_t_chiN[_t_chi_ctr++]=i-3;}if(pb && qr){_t_chi1[_t_chi_ctr]=i-2;_t_chi2[_t_chi_ctr]=(i-1) | 0x40;_t_chiN[_t_chi_ctr++]=i-3;}if(pr && qb){_t_chi1[_t_chi_ctr]=(i-2) | 0x40;_t_chi2[_t_chi_ctr]=i-1;_t_chiN[_t_chi_ctr++]=i-3;}if(pr && qr){_t_chi1[_t_chi_ctr]=(i-2) | 0x40;_t_chi2[_t_chi_ctr]=(i-1) | 0x40;_t_chiN[_t_chi_ctr++]=i-3;}}++_t_bipai2[i-2]; ++_t_bipai2[i-1];if(i>3 && _t_rule.kuinaoshi>1) _t_bipai2[i-3]=l;}if(_t_bipai2[i-1]>0 && _t_bipai2[i+1]>0){--_t_bipai2[i-1]; --_t_bipai2[i+1];j=0x38; while(--j>=0){if(_t_bipai2[j]>0) break;}if(j>0){var pb=pr=qb=qr=0;j=20; while(--j>0){k=_t[_t_jia].shupai[j];if((k & 0x3f)==i-1){if(k & 0x40) pr++; else pb++;}if((k & 0x3f)==i+1){if(k & 0x40) qr++; else qb++;}}if(pb && qb){_t_chi1[_t_chi_ctr]=i-1;_t_chi2[_t_chi_ctr]=i+1;_t_chiN[_t_chi_ctr++]=i;}if(pb && qr){_t_chi1[_t_chi_ctr]=i-1;_t_chi2[_t_chi_ctr]=(i+1) | 0x40;_t_chiN[_t_chi_ctr++]=i;}if(pr && qb){_t_chi1[_t_chi_ctr]=(i-1) | 0x40;_t_chi2[_t_chi_ctr]=i+1;_t_chiN[_t_chi_ctr++]=i;}if(pr && qr){_t_chi1[_t_chi_ctr]=(i-1) | 0x40;_t_chi2[_t_chi_ctr]=(i+1) | 0x40;_t_chiN[_t_chi_ctr++]=i;}}++_t_bipai2[i-1]; ++_t_bipai2[i+1];}if(_t_bipai2[i+1]>0 && _t_bipai2[i+2]>0){--_t_bipai2[i+2]; --_t_bipai2[i+2];if(_t_rule.kuinaoshi>1) _t_bipai2[i+3]=0;j=0x38; while(--j>=0){if(_t_bipai2[j]>0) break;}if(j>0){var pb=pr=qb=qr=0;j=20; while(--j>0){k=_t[_t_jia].shupai[j];if((k & 0x3f)==i+1){if(k & 0x40) pr++; else pb++;}if((k & 0x3f)==i+2){if(k & 0x40) qr++; else qb++;}}if(pb && qb){_t_chi1[_t_chi_ctr]=i+1;_t_chi2[_t_chi_ctr]=i+2;_t_chiN[_t_chi_ctr++]=i+3;}if(pb && qr){_t_chi1[_t_chi_ctr]=i+1;_t_chi2[_t_chi_ctr]=(i+2) | 0x40;_t_chiN[_t_chi_ctr++]=i+3;}if(pr && qb){_t_chi1[_t_chi_ctr]=(i+1) | 0x40;_t_chi2[_t_chi_ctr]=i+2;_t_chiN[_t_chi_ctr++]=i+3;}if(pr && qr){_t_chi1[_t_chi_ctr]=(i+1) | 0x40;_t_chi2[_t_chi_ctr]=(i+2) | 0x40;_t_chiN[_t_chi_ctr++]=i+3;}}}var str='一枚目のチー牌を指定して下さい。';if(_t_lang=='en') str='Click/Tap your tile for the first tile of a melded chow.';_t_status_disp(str);_h5_makeHandClickable();inputKey=0;_t_h5_next=setTimeout('CHI_2_2(); ', 10);}function CHI_2_2(){var i, j, k, l, str;i=Math.random();if(inputKey>0 && inputKey<20 && (i=_t[_t_jia].shupai[inputKey] & 0x7f)!=0){_t[_t_jia].declare_param1=i;j=_t_chi_ctr; k=0;while(--j>=0){if(_t_chi1[j]==i) _t_chiS[k++]=_t_chi2[j];if(_t_chi2[j]==i) _t_chiS[k++]=_t_chi1[j];}if(k==1){_t[_t_jia].shupai[inputKey] |= 0x100;inputKey=0;_t[_t_jia].declare_param2=_t_chiS[0];_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('CHI_3(); ', 10);return;}if(k>1){_t[_t_jia].shupai[inputKey] |= 0x100;_t_shupai_disp(_t_jia);inputKey=0;_t[_t_jia].declare_param2=k;str='二枚目のチー牌を指定して下さい。';if(_t_lang=='en') str='Click/Tap your tile for the second tile of a melded chow.';_t_status_disp(str);_t_h5_next=setTimeout('CHI_2_3(); ', 10);return;}str='その牌は指定出来ません。\n一枚目のチー牌を指定して下さい。';if(_t_lang=='en') str='You cannot make a melded chow with it.\nClick/Tap another tile for the first tile of a melded chow.';_t_status_disp(str);}inputKey=0;_t_h5_next=setTimeout('CHI_2_2(); ', 10);}function CHI_2_3(){var i, j, k, l, str;i=Math.random();if(inputKey>0 && inputKey<20 && (i=_t[_t_jia].shupai[inputKey] & 0x7f)!=0){j=_t[_t_jia].declare_param2;while(--j>=0){if(_t_chiS[j]==i) break;}if(j>=0){_t_status_disp('');_t[_t_jia].declare_param2=i;_t[_t_jia].shupai[inputKey] |= 0x100;inputKey=0;_h5_makeHandUnclickable();_t_h5_next=setTimeout('CHI_3(); ', 10);return;}str='その牌は指定出来ません。\n二枚目のチー牌を指定して下さい。';if(_t_lang=='en') str='You cannot make a melded chow with it.\nClick/Tap another tile for the second tile of a melded chow.';_t_status_disp(str);}inputKey=0;_t_h5_next=setTimeout('CHI_2_3(); ', 10);}function CHI_3(){var fp=new Array();var fq=new Array();var i, j, k, fpp=0;var p;_t_dapai_flag=1;if(_t[_t_jia].declare_param1>_t[_t_jia].declare_param2){i=_t[_t_jia].declare_param1;_t[_t_jia].declare_param1=_t[_t_jia].declare_param2;_t[_t_jia].declare_param2=i;}i=20; j=_t[_t_jia].declare_param1; while(--i>0){if((_t[_t_jia].shupai[i] & 0x100) && (_t[_t_jia].shupai[i] & 0x7f)==j){ fp[0]=j; fq[0]=i; fpp++; break;}}if(i<1){i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==j){ fp[0]=j; fq[0]=i; fpp++; break;}}}i=20; j=_t[_t_jia].declare_param2; while(--i>0){if((_t[_t_jia].shupai[i] & 0x100) && (_t[_t_jia].shupai[i] & 0x7f)==j){ fp[1]=j; fq[1]=i; fpp++; break; }}if(i<1){i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==j){ fp[1]=j; fq[1]=i; fpp++; break; }}}if(fpp<2){_t_jia=_t_dajia;_t_h5_next=setTimeout('MOPAI(); ', 10);return;}i=-1; while(++i<2){_t[_t_jia].shupai[fq[i]] |= 0x100;j=_t_players;while(--j>=0){if(j==_t_jia) continue;_t[j].zampai_table[fp[i]]--;}_t_zampai_table4all[fp[i] & 0x3f]--;}_t_shupai_disp(_t_jia);i=-1; while(++i<2) _t[_t_jia].shupai[fq[i]]=0;_t_lipai(_t_jia);if(_t_players==2) j=1;else j=0;i=-1; fpp=0; k=_t[_t_jia].fulou_ctr*5;while(++i<3){if(i==j){_t[_t_jia].fuloupai[k++]=(_t_dapai_buff & 0x7f) | 0x80;continue;}_t[_t_jia].fuloupai[k++]=fp[fpp++];}_t[_t_jia].fuloupai[k++]=0;_t[_t_jia].fuloupai[k++]=0;_t[_t_jia].fusipai2[_t[_t_jia].fusipai_ctr++]=-(_t_dapai_buff & 0x3f);i=_t[_t_jia].fulou_ctr++;_t[_t_jia].fulou_jiagang[i]=0;_t[_t_jia].fulou_dajia[i]=_t_dajia;_t[_t_jia].menqian_flag=1;_t[_t_jia].yaojiu_furikiri_flag=_t[_t_dajia].yaojiu_furikiri_flag=1;i=_t_players; while(--i>=0) _t[i].reach_ippatsu_flag=0;_t_started_flag=_t_yixun_flag=1;_t[_t_dajia].fusipai2[_t[_t_dajia].fusipai_ctr-1] |= 0x200;if(_t_gamemode==_T_GAMEMODE_TAIWAN) _tm_dapai_erase(_t_dajia);else _t_dapai_disp(_t_dajia);_t_lipai(_t_jia);_tm_minggang_flag=0;_t_pengchi_flag=1;_t_dapai_flag=1;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;if(_t_rule.kuinaoshi) _t_cannot_dapai_pai1=_t_dapai_buff & 0x3f;fp[0] &= 0x3f; fp[1] &= 0x3f;if(_t_rule.kuinaoshi>1){if(fp[0]+1==fp[1]){_t_cannot_dapai_pai1=fp[0]-1;_t_cannot_dapai_pai2=fp[1]+1;}else if(fp[0]-1==fp[1]){_t_cannot_dapai_pai1=fp[1]-1;_t_cannot_dapai_pai2=fp[0]+1;}}_t_ronghe_flag=0;_t_qianggang_flag=0;_t_lingshang_flag=0;_t_angang_flag=0;_t_dajia=-1;_t_hele_str='チー直後の和了は出来ません。';_t_gang_str='チー直後の槓は出来ません。';_t_reach_str='門前でない手での立直は出来ません。';if(_t_lang=='en'){_t_hele_str='You cannot win after you made a melded chow.';_t_gang_str='You cannot make a kong after you made a melded chow.';}_t_keishiki_hele_flag=0;_t_gangpai_ctr=0;i=4; while(--i>=0) _t_gangpai[i]=0;_t_chi_ctr=0;_t_peng_ok=0;_t_daopai_ok=0;_t_gang_pos=-1;_t_init_balance();_t[_t_jia].tingpai_dori=0;_tm_baxianguohai=-1;_t_h5_next=setTimeout('CHI_3_H5(); ', 320);}function CHI_3_H5(){_t_shupai_disp(_t_jia);_t_h5_next=setTimeout('AFTER_PENGCHI(); ', 10);}function PENG(){_t_jia=_t_command_jia;var txt='ポン';if(_t_lang=='en') txt='Pung.';SPEECH_BALOON(txt, 'peng'+_t_player_code[_t_jia], _t_jia);_t_h5_next=setTimeout('PENG_H5_1(); ', 720);}function PENG_H5_1(){var i, r= b=0, dp=_t_dapai_buff & 0x3f;_t[_t_jia].declare_param1=0;_t[_t_jia].declare_param2=0;i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x3f)!=dp) continue;if(_t[_t_jia].shupai[i] & 0x40) ++r; else ++b;if(_t[_t_jia].declare_param1==0){_t[_t_jia].declare_param1=_t[_t_jia].shupai[i] & 0x7f;continue;}_t[_t_jia].declare_param2=_t[_t_jia].shupai[i] & 0x7f;}i=0;if(b>1) i++;if(b && r) i++;if(r>1) i++;if(i==1){_t_h5_next=setTimeout('PENG_3(); ', 10);return;}if(_t_jia){_t[_t_jia].declare_param1=0;_t[_t_jia].declare_param2=0;i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)!=(dp | 0x40)) continue;if(_t[_t_jia].declare_param1==0){_t[_t_jia].declare_param1=_t[_t_jia].shupai[i] & 0x7f;continue;}if(_t[_t_jia].declare_param2) break;_t[_t_jia].declare_param2=_t[_t_jia].shupai[i] & 0x7f;}i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)!=dp) continue;if(_t[_t_jia].declare_param1==0){_t[_t_jia].declare_param1=_t[_t_jia].shupai[i] & 0x7f;continue;}if(_t[_t_jia].declare_param2) break;_t[_t_jia].declare_param2=_t[_t_jia].shupai[i] & 0x7f;}_t_h5_next=setTimeout('PENG_3(); ', 10);return;}str='一枚目のポン牌を指定して下さい。';if(_t_lang=='en') str='Click/Tap your tile for the first tile of a melded pung.';_t_status_disp(str);_h5_makeHandClickable();inputKey=0;_t_h5_next=setTimeout('PENG_2_2(); ', 10);}function PENG_2_2(){var i, j, k, l, str;i=Math.random();if(inputKey>0 && inputKey<20 && (_t[_t_jia].shupai[inputKey] & 0x3f)==(_t_dapai_buff & 0x3f)){var i, r= b=0, dp=_t_dapai_buff & 0x3f;_t_jia=_t_command_jia;_t[_t_jia].declare_param1=_t[_t_jia].shupai[inputKey] & 0x7f;_t[_t_jia].declare_param2=0;i=20; while(--i>=0){if(inputKey==i) continue;if((_t[_t_jia].shupai[i] & 0x3f)!=dp) continue;if(_t[_t_jia].shupai[i] & 0x40) ++r; else ++b;_t[_t_jia].declare_param2=_t[_t_jia].shupai[i] & 0x7f;}i=0;if(b) i++;if(r) i++;if(i==1){_t[_t_jia].shupai[inputKey] |= 0x100;_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('PENG_3(); ', 10);return;}_t[_t_jia].shupai[inputKey] |= 0x100;_t_shupai_disp(_t_jia);inputKey=0;_t[_t_jia].declare_param2=k;str='二枚目のポン牌を指定して下さい。';if(_t_lang=='en') str='Click/Tap your tile for the second tile of a melded pung.';_t_status_disp(str);_t_h5_next=setTimeout('PENG_2_3(); ', 10);return;}inputKey=0;_t_h5_next=setTimeout('PENG_2_2(); ', 10);}function PENG_2_3(){var i, j, k, l, str;i=Math.random();if(inputKey>0 && inputKey<20  && _t[_t_jia].shupai[inputKey]<0x100 && (_t[_t_jia].shupai[inputKey] & 0x3f)==(_t_dapai_buff & 0x3f)){_t[_t_jia].declare_param2=_t[_t_jia].shupai[inputKey] & 0x7f;_t[_t_jia].shupai[inputKey] |= 0x100;_t_status_erase();_h5_makeHandUnclickable();_t_h5_next=setTimeout('PENG_3(); ', 10);return;}if(inputKey>0 && inputKey<20  && (_t[_t_jia].shupai[inputKey] & 0x3f)<0){str='その牌は指定出来ません。\n二枚目のポン牌を指定して下さい。';if(_t_lang=='en') str='You cannot make a melded pung with it.\nClick/Tap another tile for the second tile of a melded pung.';_t_status_disp(str);}inputKey=0;_t_h5_next=setTimeout('PENG_2_3(); ', 10);}function PENG_3(){var fp=new Array();var fq=new Array();var i, j, k, fpp=0;var p;_t_dapai_flag=1;if(_t[_t_jia].declare_param1>_t[_t_jia].declare_param2){i=_t[_t_jia].declare_param1;_t[_t_jia].declare_param1=_t[_t_jia].declare_param2;_t[_t_jia].declare_param2=i;}i=20; j=_t[_t_jia].declare_param1; while(--i>0){if((_t[_t_jia].shupai[i] & 0x100) && (_t[_t_jia].shupai[i] & 0x7f)==j){ fp[0]=j; fq[0]=i; fpp++; break;}}if(i<1){i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==j){ fp[0]=j; fq[0]=i; fpp++; break;}}}i=20; j=_t[_t_jia].declare_param2; while(--i>0){if(i==fq[0]) continue;if((_t[_t_jia].shupai[i] & 0x100) && (_t[_t_jia].shupai[i] & 0x7f)==j){ fp[1]=j; fq[1]=i; fpp++; break; }}if(i<1){i=20; while(--i>0){if(i==fq[0]) continue;if((_t[_t_jia].shupai[i] & 0x7f)==j){ fp[1]=j; fq[1]=i; fpp++; break; }}}if(fpp<2){_t_jia=_t_dajia;_t_h5_next=setTimeout('MOPAI(); ', 10);return;}i=-1; while(++i<2){_t[_t_jia].shupai[fq[i]] |= 0x100;j=_t_players;while(--j>=0){if(j==_t_jia) continue;_t[j].zampai_table[fp[i]]--;}_t_zampai_table4all[fp[i] & 0x3f]--;}_t_shupai_disp(_t_jia);i=-1; while(++i<2) _t[_t_jia].shupai[fq[i]]=0;_t_lipai(_t_jia);if(_t_players==2) j=1;else {j=((_t_jia-_t_dajia) & 3)-1;if(_t_players==3){if(_t_jia==0){j=0; if(_t_dajia==1) j=2;}else {j=1;if(_t_dajia==0){j=0; if(_t_jia==2) j=2;}}}}i=-1; fpp=0; k=_t[_t_jia].fulou_ctr*5;while(++i<3){if(i==j){_t[_t_jia].fuloupai[k++]=(_t_dapai_buff & 0x7f) | 0x80;continue;}_t[_t_jia].fuloupai[k++]=fp[fpp++];}_t[_t_jia].fuloupai[k++]=0;_t[_t_jia].fuloupai[k++]=0;_t[_t_jia].fusipai2[_t[_t_jia].fusipai_ctr++]=-(_t_dapai_buff & 0x3f);i=_t[_t_jia].fulou_ctr++;_t[_t_jia].fulou_jiagang[i]=0;_t[_t_jia].fulou_dajia[i]=_t_dajia;_t[_t_jia].menqian_flag=1;_t[_t_jia].yaojiu_furikiri_flag=_t[_t_dajia].yaojiu_furikiri_flag=1;i=_t_players; while(--i>=0) _t[i].reach_ippatsu_flag=0;_t_started_flag=_t_yixun_flag=1;_t[_t_dajia].fusipai2[_t[_t_dajia].fusipai_ctr-1] |= 0x200;if(_t_gamemode==_T_GAMEMODE_TAIWAN) _tm_dapai_erase(_t_dajia);else _t_dapai_disp(_t_dajia);_t_lipai(_t_jia);_tm_minggang_flag=0;_t_pengchi_flag=1;_t_dapai_flag=1;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;if(_t_rule.kuinaoshi) _t_cannot_dapai_pai1=_t_dapai_buff & 0x3f;_t_ronghe_flag=0;_t_qianggang_flag=0;_t_lingshang_flag=0;_t_angang_flag=0;_t_dajia=-1;_t_hele_str='ポン直後の和了は出来ません。';if(_t_lang=='en'){_t_hele_str='You cannot win after you made a melded pung.';}_t_keishiki_hele_flag=0;_t_gang_str='ポン直後の槓は出来ません。';_t_gangpai_ctr=0;i=4; while(--i>=0) _t_gangpai[i]=0;_t_chi_ctr=0;_t_peng_ok=0;_t_daopai_ok=0;_t_reach_str='門前でない手での立直は出来ません。';_t_gang_pos=-1;_t_init_balance();_t[_t_jia].tingpai_dori=0;_tm_baxianguohai=-1;if(_t_gamemode==_T_GAMEMODE_PENGLI && _t_zampai_ctr>=_t_players) _t_reach_str='';_t_h5_next=setTimeout('PENG_3_H5(); ', 320);}function PENG_3_H5(){_t_shupai_disp(_t_jia);_t_h5_next=setTimeout('AFTER_PENGCHI(); ', 10);}function MINGGANG(){_t_jia=_t_command_jia;var txt='カン';if(_t_lang=='en') txt='Kong.';SPEECH_BALOON(txt, 'gang'+_t_player_code[_t_jia], _t_jia);_t_h5_next=setTimeout('MINGGANG_H5_1(); ', 720);}function MINGGANG_H5_1(){var fp=new Array();var fq=new Array();var i, j, k, fpp=0;var p=_t_dapai_buff & 0x3f;j=p | 0x40;i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==j){ fp[fpp]=j; fq[fpp++]=i; }}i=20; while(--i>0){if((_t[_t_jia].shupai[i] & 0x7f)==p){ fp[fpp]=p; fq[fpp++]=i; }}if(fpp<3){_t_jia=_t_dajia;_t_h5_next=setTimeout('MOPAI(); ', 10);return;}i=-1; while(++i<3){_t[_t_jia].shupai[fq[i]] |= 0x100;j=_t_players;while(--j>=0){if(j==_t_jia) continue;_t[j].zampai_table[fp[i]]--;}}_t_zampai_table4all[fp[0] & 0x3f]=0;_t_shupai_disp(_t_jia);i=-1; while(++i<3) _t[_t_jia].shupai[fq[i]]=0;_t_lipai(_t_jia);if(_t_players==2) j=2;else if(_t_gamemode==_T_GAMEMODE_TAIWAN) j=((_t_jia-_t_dajia) & 3)-1;else {j=((_t_jia-_t_dajia) & 3)-1;if(j!=0) j++;if(_t_players==3){if(_t_jia==0){j=0; if(_t_dajia==1) j=3;}else {j=2;if(_t_dajia==0){j=0; if(_t_jia==2) j=3;}}}}i=-1; fpp=3; k=_t[_t_jia].fulou_ctr*5;while(++i<4){if(i==j){_t[_t_jia].fuloupai[k++]=(_t_dapai_buff & 0x7f) | 0x80;continue;}_t[_t_jia].fuloupai[k++]=fp[--fpp];}_t[_t_jia].fuloupai[k++]=0;_t[_t_jia].fusipai2[_t[_t_jia].fusipai_ctr++]=-(_t_dapai_buff & 0x3f);i=_t[_t_jia].fulou_ctr++;_t[_t_jia].fulou_gang_ctr++;_t[_t_jia].fulou_jiagang[i]=0;_t[_t_jia].fulou_dajia[i]=_t_dajia & 3;_t[_t_jia].menqian_flag=1;_t[_t_jia].yaojiu_furikiri_flag=_t[_t_dajia].yaojiu_furikiri_flag=1;i=_t_players; while(--i>=0) _t[i].reach_ippatsu_flag=0;_t_started_flag=_t_yixun_flag=1;_t_sigangzi_babao=-1;if(_t[_t_jia].fulou_gang_ctr==4) _t_sigangzi_babao=_t_dajia & 3;if(!_t_gang_ctr) _t_gang_jia=_t_jia;else if(_t_gang_jia!=_t_jia) _t_gang_jia=-1;++_t_gang_ctr;if(_t_rule.gangdora) ++_t_dora_ctr;_t[_t_dajia].fusipai2[_t[_t_dajia].fusipai_ctr-1] |= 0x200;if(_t_gamemode==_T_GAMEMODE_TAIWAN) _tm_dapai_erase(_t_dajia);else _t_dapai_disp(_t_dajia);_tm_minggang_flag=1;_t_h5_next=setTimeout('MINGGANG_H5_2(); ', 320);}function MINGGANG_H5_2(){_t_pengchi_flag=0;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;_t_ronghe_flag=0;_t_qianggang_flag=0;_t_lingshang_flag=1;_t_angang_flag=0;--_t_zampai_ctr;if(_t_players==3 && _t_nukidora[1]>0) --_t_zampai_ctr;if(!_t_rule.shengpaibao) _t_dajia=-1;_t_tingpai_judge(_t_jia, 0, -1);_t_shupai_disp(_t_jia);_t[_t_jia].tingpai_dori=0;if(_t_rule.gangdora>1) _t_dora_disp();_tm_baxianguohai=-1;_t_h5_next=setTimeout('LINGSHANG_MOPAI(); ', 10);}function LINGSHANG_MOPAI(){var i, j, k, l;_t_cannot_dapai_pai1=_t_cannot_dapai_pai2=0;_t_ronghe_flag=0;_t_qianggang_flag=0;_t_pengchi_flag=0;_t_dapai_flag=0;_t_dapai_buff=_t_bipai[_t_mopai_ptr++] & 0x7f;_t[_t_jia].shupai[14]=_t_dapai_buff;_t_bipai4disp[_t_lingshang_jia][_t_lingshang_pos]=0;--_t[_t_jia].zampai_table[_t[_t_jia].shupai[14]];k=_t_players; while(--k>=0){l=_t_bipai4disp[k].length; while(--l>=0){if(_t_bipai4disp[k][l]) break;}if(l>-1) break;}i=_t_lingshang_jia;j=_t_lingshang_pos;if(k>-1){do {++_t_lingshang_pos;if(_t_lingshang_pos>30){_t_lingshang_pos=0;if(++_t_lingshang_jia>=_t_players) _t_lingshang_jia=0;}} while(!_t_bipai4disp[_t_lingshang_jia][_t_lingshang_pos]);}_t_bipai_disp();_t_from_bipai_to_shupai(i, j, _t_jia, 0);_t_h5_next=setTimeout('WAIT_MOVIE("LINGSHANG_MOPAI_3"); ', 10);}function LINGSHANG_MOPAI_3(){AUDIO_OUTPUT('mopai', false);_t_shupai_disp(_t_jia);_t_h5_next=setTimeout('AFTER_MOPAI(); ', 10);}
